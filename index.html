<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Driven Properties - Off-Plan Investment</title>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&display=swap" rel="stylesheet">
    <!-- Leaflet CSS & JS for interactive maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        cream: {
                            50: '#fdfcfb',
                            100: '#faf8f5',
                            200: '#f5f2ed',
                            300: '#ede7dd',
                            400: '#e0d5c7',
                            500: '#d4c4b0'
                        },
                        warm: {
                            50: '#fafaf9',
                            100: '#f5f5f4',
                            200: '#e7e5e4',
                            300: '#d6d3d1',
                            400: '#a8a29e',
                            500: '#78716c',
                            600: '#57534e',
                            700: '#44403c',
                            800: '#292524',
                            900: '#1c1917'
                        },
                        accent: {
                            gold: '#d4a574',
                            'gold-dark': '#b8935f',
                            green: '#2d5f3f',
                            'green-dark': '#1f4229'
                        },
                        driven: {
                            dark: '#1c1917',
                            text: '#292524',
                            muted: '#78716c',
                            border: '#e7e5e4',
                            card: '#ffffff',
                            highlight: '#faf8f5',
                            button: '#292524',
                            green: '#2d5f3f'
                        }
                    },
                    fontFamily: {
                        lato: ['Lato', 'sans-serif']
                    },
                    boxShadow: {
                        'card': '0 1px 3px rgba(0,0,0,0.04), 0 4px 16px rgba(0,0,0,0.06)',
                        'card-hover': '0 4px 12px rgba(0,0,0,0.08), 0 12px 32px rgba(0,0,0,0.1)',
                        'soft': '0 2px 8px rgba(0,0,0,0.05)'
                    },
                    borderRadius: {
                        'xl': '1rem',
                        '2xl': '1.25rem'
                    }
                }
            }
        }
    </script>
    <style>
        /* UAE Dirham Symbol Font */
        @font-face {
            font-family: 'DirhamSymbol';
            src: url('https://cdn.jsdelivr.net/gh/abdulrysrr/new-dirham-symbol@main/font/font.woff2') format('woff2'),
                url('https://cdn.jsdelivr.net/gh/abdulrysrr/new-dirham-symbol@main/font/font.woff') format('woff');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        .dirham-symbol {
            font-family: 'DirhamSymbol', sans-serif;
            font-style: normal;
            line-height: 1;
            display: inline-block;
            vertical-align: baseline;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            font-family: 'Lato', sans-serif;
            background: #fdfcfb;
            color: #292524;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: clip;
        }

        .btn-primary {
            background: #292524;
            color: #ffffff;
            border-radius: 0.5rem;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .btn-primary:hover {
            background: #44403c;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .btn-green {
            background: #2d5f3f;
            color: #ffffff;
            border-radius: 0.5rem;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .btn-green:hover {
            background: #1f4229;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(45, 95, 63, 0.25);
        }

        .card-driven {
            background: #ffffff;
            border: 1px solid #e7e5e4;
            border-radius: 1rem;
            transition: all 0.25s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);
        }

        .card-driven:hover {
            border-color: #d4a574;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
            transform: translateY(-2px);
        }

        .tab-active {
            background: #292524;
            color: #ffffff;
        }

        .tab-inactive {
            background: #ffffff;
            color: #78716c;
            border: 1px solid #e7e5e4;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #d4a574;
            box-shadow: 0 0 0 3px rgba(212, 165, 116, 0.2);
        }

        button:focus-visible {
            outline: 2px solid #d4a574;
            outline-offset: 2px;
        }

        /* Loading states */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid #d4a574;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        @keyframes fade-in {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes scale-in {
            from { opacity: 0; transform: scale(0.95); }
            to   { opacity: 1; transform: scale(1); }
        }

        @keyframes slideUpDrawer {
            from { transform: translateY(100%); }
            to   { transform: translateY(0); }
        }
        @keyframes fadeInBackdrop {
            from { opacity: 0; }
            to   { opacity: 1; }
        }
        .filter-drawer-backdrop {
            animation: fadeInBackdrop 0.25s ease-out forwards;
        }
        .filter-drawer-sheet {
            animation: slideUpDrawer 0.32s cubic-bezier(0.32, 0.72, 0, 1) forwards;
        }

        .animate-fade-in {
            animation: fade-in 0.2s ease-out;
        }

        .animate-scale-in {
            animation: scale-in 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }

        /* Hide scrollbar but keep scroll functionality */
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        /* Improved touch targets for mobile */
        @media (max-width: 768px) {

            .btn-primary,
            .btn-green {
                padding: 0.875rem 1.75rem;
                min-height: 44px;
            }
        }

        /* Property card — container query for horizontal layout */
        .property-card-wrap {
            container-type: inline-size;
        }

        /* Map list panel: always force vertical card layout regardless of container width */
        .map-list-card .property-card-inner {
            flex-direction: column !important;
        }
        .map-list-card .property-card-inner .card-image-area {
            width: 100% !important;
            height: 220px !important;
            min-height: 220px !important;
            border-radius: 14px !important;
        }
        .map-list-card .property-card-inner .card-image-area img {
            position: absolute !important;
            inset: 0 !important;
            width: 100% !important;
            height: 100% !important;
        }
        .map-list-card .property-card-inner .card-content-area {
            padding: 6px 2px 2px !important;
            flex: unset !important;
        }
        .map-list-card .property-card-wrap-inner {
            padding: 8px !important;
            border-radius: 20px !important;
        }

        /* When card is wide (single-column), switch to horizontal layout */
        @container (min-width: 480px) {
            .property-card-wrap-inner {
                max-width: 640px;
            }

            .property-card-inner {
                flex-direction: row !important;
            }

            .property-card-inner .card-image-area {
                width: 42%;
                flex-shrink: 0;
                height: auto !important;
                min-height: 100%;
                border-radius: 16px 0 0 16px !important;
            }

            .property-card-inner .card-image-area img {
                position: absolute;
                inset: 0;
                width: 100%;
                height: 100%;
            }

            .property-card-inner .card-content-area {
                flex: 1;
                min-width: 0;
                padding: 8px 12px;
            }
        }

        /* Price compact/full toggle via container query on .property-card-wrap */
        .price-compact { display: none; }
        .price-full    { display: inline; }

        @container (max-width: 340px) {
            .price-compact { display: inline; }
            .price-full    { display: none; }
        }

        /* Filter modal entrance animation */
        @keyframes filterModalIn {
            from { opacity: 0; transform: translate(-50%, -50%) scale(0.95) translateY(20px); }
            to   { opacity: 1; transform: translate(-50%, -50%) scale(1) translateY(0); }
        }

        /* Airbnb-style Map Markers */
        .leaflet-container {
            font-family: 'Lato', sans-serif !important;
            z-index: 1;
        }

        .leaflet-marker-icon {
            background: none !important;
            border: none !important;
        }

        .airbnb-marker {
            background: #222222;
            color: #fff;
            font-size: 13px;
            font-weight: 700;
            padding: 6px 10px;
            border-radius: 28px;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.15s ease;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
            border: 2px solid #222222;
            user-select: none;
            line-height: 1;
        }

        .airbnb-marker:hover,
        .airbnb-marker.hovered {
            background: #222222;
            transform: scale(1.08);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            z-index: 999 !important;
        }

        .airbnb-marker.selected {
            background: #ffffff;
            color: #222222;
            border-color: #222222;
            transform: scale(1.12);
            box-shadow: 0 4px 14px rgba(0, 0, 0, 0.35);
            z-index: 1000 !important;
        }

        .airbnb-marker.trending {
            background: #e31c5f;
            border-color: #e31c5f;
        }

        .airbnb-marker.trending:hover,
        .airbnb-marker.trending.hovered {
            background: #c91854;
            border-color: #c91854;
        }

        .airbnb-marker.trending.selected {
            background: #ffffff;
            color: #e31c5f;
            border-color: #e31c5f;
        }

        /* Mobile: white pill markers — Airbnb mobile pattern */
        @media (max-width: 1023px) {
            .airbnb-marker {
                background: white;
                color: #222222;
                border-color: rgba(0, 0, 0, 0.12);
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.18);
            }
            .airbnb-marker:hover,
            .airbnb-marker.hovered {
                background: white;
                transform: scale(1.1);
                box-shadow: 0 4px 16px rgba(0, 0, 0, 0.25);
            }
            .airbnb-marker.selected {
                background: #222222;
                color: white;
                border-color: #222222;
            }
            .airbnb-marker.trending {
                background: #e31c5f;
                color: white;
                border-color: #e31c5f;
            }
        }

        /* Airbnb-style popup */
        .leaflet-popup-content-wrapper {
            border-radius: 12px !important;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2) !important;
            padding: 0 !important;
            overflow: hidden;
        }

        .leaflet-popup-content {
            margin: 0 !important;
            width: 280px !important;
        }

        .leaflet-popup-tip {
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15) !important;
        }

        .leaflet-popup-close-button {
            right: 8px !important;
            top: 8px !important;
            width: 28px !important;
            height: 28px !important;
            font-size: 20px !important;
            line-height: 28px !important;
            color: #fff !important;
            background: rgba(0, 0, 0, 0.4) !important;
            border-radius: 50% !important;
            text-align: center;
            z-index: 10;
        }

        .leaflet-popup-close-button:hover {
            background: rgba(0, 0, 0, 0.6) !important;
            color: #fff !important;
        }

        .map-popup-card {
            font-family: 'Lato', sans-serif;
        }

        .map-popup-card .popup-image {
            width: 100%;
            height: 160px;
            object-fit: cover;
            display: block;
        }

        .map-popup-card .popup-body {
            padding: 12px 14px;
        }

        .map-popup-card .popup-title {
            font-size: 15px;
            font-weight: 700;
            color: #222;
            margin-bottom: 2px;
            line-height: 1.3;
        }

        .map-popup-card .popup-location {
            font-size: 13px;
            color: #717171;
            margin-bottom: 6px;
        }

        .map-popup-card .popup-details {
            display: flex;
            gap: 10px;
            font-size: 12px;
            color: #717171;
            margin-bottom: 8px;
        }

        .map-popup-card .popup-price {
            font-size: 16px;
            font-weight: 700;
            color: #222;
        }

        .map-popup-card .popup-badge {
            display: inline-block;
            background: #e31c5f;
            color: white;
            font-size: 10px;
            font-weight: 700;
            padding: 2px 8px;
            border-radius: 4px;
            position: absolute;
            top: 10px;
            left: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Map control overrides for Airbnb look */
        .leaflet-control-zoom {
            border: none !important;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15) !important;
            border-radius: 12px !important;
            overflow: hidden;
        }

        .leaflet-control-zoom a {
            width: 40px !important;
            height: 40px !important;
            line-height: 40px !important;
            font-size: 18px !important;
            color: #222 !important;
            border-bottom: 1px solid #e7e5e4 !important;
        }

        .leaflet-control-zoom a:hover {
            background: #f5f5f4 !important;
        }

        .leaflet-control-zoom a:last-child {
            border-bottom: none !important;
        }

        /* Carousel styles */
        .carousel-container {
            overflow-x: auto;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            -ms-overflow-style: none;
            -webkit-mask-image: linear-gradient(to right, transparent, black 60px, black calc(100% - 60px), transparent);
            mask-image: linear-gradient(to right, transparent, black 60px, black calc(100% - 60px), transparent);
        }

        .carousel-container::-webkit-scrollbar {
            display: none;
        }

        .carousel-track {
            display: flex;
            gap: 20px;
        }

        .carousel-track>* {
            flex: 0 0 auto;
        }

        /* Carousel cards in home — fixed width for consistency */
        .carousel-property-card {
            width: 300px;
        }

        /* Override container query inside carousel to keep vertical layout */
        .carousel-property-card .property-card-wrap {
            container-type: normal;
        }

        .carousel-blog-card {
            width: 340px;
        }

        /* Blog card styles */
        .blog-card {
            border-radius: 16px;
            overflow: hidden;
            background: #fff;
            transition: all 0.25s ease;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .blog-card:hover {
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }

        .blog-card .blog-image-wrapper {
            position: relative;
            width: 100%;
            aspect-ratio: 16/10;
            overflow: hidden;
        }

        .blog-card .blog-image-wrapper img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.4s ease;
        }

        .blog-card:hover .blog-image-wrapper img {
            transform: scale(1.05);
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect, useCallback, useId } = React;



        // Icons
        const Icon = ({ name, className = "w-5 h-5" }) => {
            const icons = {
                search: <svg className={className} fill="none" stroke="currentColor" strokeWidth="1.5" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8" /><path d="m21 21-4.35-4.35" /></svg>,
                heart: <svg className={className} fill="none" stroke="currentColor" strokeWidth="1.5" viewBox="0 0 24 24"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" /></svg>,
                heartFilled: <svg className={className} fill="currentColor" viewBox="0 0 24 24"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" /></svg>,
                building: <svg className={className} fill="none" stroke="currentColor" strokeWidth="1.5" viewBox="0 0 24 24"><rect width="16" height="20" x="4" y="2" rx="2" /><path d="M9 22v-4h6v4M8 6h.01M16 6h.01M12 6h.01M12 10h.01M12 14h.01M16 10h.01M16 14h.01M8 10h.01M8 14h.01" /></svg>,
                mapPin: <svg className={className} fill="none" stroke="currentColor" strokeWidth="1.5" viewBox="0 0 24 24"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z" /><circle cx="12" cy="10" r="3" /></svg>,
                shield: <svg className={className} fill="none" stroke="currentColor" strokeWidth="1.5" viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" /></svg>,
                trendingUp: <svg className={className} fill="none" stroke="currentColor" strokeWidth="1.5" viewBox="0 0 24 24"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17" /><polyline points="16 7 22 7 22 13" /></svg>,
                chevronRight: <svg className={className} fill="none" stroke="currentColor" strokeWidth="1.5" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6" /></svg>,
                chevronDown: <svg className={className} fill="none" stroke="currentColor" strokeWidth="1.5" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9" /></svg>,
                arrowLeft: <svg className={className} fill="none" stroke="currentColor" strokeWidth="1.5" viewBox="0 0 24 24"><path d="m12 19-7-7 7-7M19 12H5" /></svg>,
                arrowRight: <svg className={className} fill="none" stroke="currentColor" strokeWidth="1.5" viewBox="0 0 24 24"><path d="M5 12h14M12 5l7 7-7 7" /></svg>,
                check: <svg className={className} fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12" /></svg>,
                clock: <svg className={className} fill="none" stroke="currentColor" strokeWidth="1.5" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" /><polyline points="12 6 12 12 16 14" /></svg>,
                filter: <svg className={className} fill="none" stroke="currentColor" strokeWidth="1.5" viewBox="0 0 24 24"><line x1="4" y1="21" x2="4" y2="14" /><line x1="4" y1="10" x2="4" y2="3" /><line x1="12" y1="21" x2="12" y2="12" /><line x1="12" y1="8" x2="12" y2="3" /><line x1="20" y1="21" x2="20" y2="16" /><line x1="20" y1="12" x2="20" y2="3" /><line x1="1" y1="14" x2="7" y2="14" /><line x1="9" y1="8" x2="15" y2="8" /><line x1="17" y1="16" x2="23" y2="16" /></svg>,
                map: <svg className={className} fill="none" stroke="currentColor" strokeWidth="1.5" viewBox="0 0 24 24"><polygon points="3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21" /><line x1="9" y1="3" x2="9" y2="18" /><line x1="15" y1="6" x2="15" y2="21" /></svg>,
                list: <svg className={className} fill="none" stroke="currentColor" strokeWidth="1.5" viewBox="0 0 24 24"><line x1="8" y1="6" x2="21" y2="6" /><line x1="8" y1="12" x2="21" y2="12" /><line x1="8" y1="18" x2="21" y2="18" /><line x1="3" y1="6" x2="3.01" y2="6" /><line x1="3" y1="12" x2="3.01" y2="12" /><line x1="3" y1="18" x2="3.01" y2="18" /></svg>,
                play: <svg className={className} fill="none" stroke="currentColor" strokeWidth="1.5" viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3" /></svg>,
                layers: <svg className={className} fill="none" stroke="currentColor" strokeWidth="1.5" viewBox="0 0 24 24"><polygon points="12 2 2 7 12 12 22 7 12 2" /><polyline points="2 17 12 22 22 17" /><polyline points="2 12 12 17 22 12" /></svg>,
                x: <svg className={className} fill="none" stroke="currentColor" strokeWidth="1.5" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></svg>,
                phone: <svg className={className} fill="none" stroke="currentColor" strokeWidth="1.5" viewBox="0 0 24 24"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 22 16.92z" /></svg>,
                whatsapp: <svg className={className} fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z" /></svg>,
                calendar: <svg className={className} fill="none" stroke="currentColor" strokeWidth="1.5" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" /><line x1="16" y1="2" x2="16" y2="6" /><line x1="8" y1="2" x2="8" y2="6" /><line x1="3" y1="10" x2="21" y2="10" /></svg>,
                calculator: <svg className={className} fill="none" stroke="currentColor" strokeWidth="1.5" viewBox="0 0 24 24"><rect x="4" y="2" width="16" height="20" rx="2" /><line x1="8" y1="6" x2="16" y2="6" /><line x1="8" y1="10" x2="8" y2="10.01" /><line x1="12" y1="10" x2="12" y2="10.01" /><line x1="16" y1="10" x2="16" y2="10.01" /><line x1="8" y1="14" x2="8" y2="14.01" /><line x1="12" y1="14" x2="12" y2="14.01" /><line x1="16" y1="14" x2="16" y2="14.01" /><line x1="8" y1="18" x2="8" y2="18.01" /><line x1="12" y1="18" x2="12" y2="18.01" /><line x1="16" y1="18" x2="16" y2="18.01" /></svg>,
                navigation: <svg className={className} fill="none" stroke="currentColor" strokeWidth="1.5" viewBox="0 0 24 24"><polygon points="3 11 22 2 13 21 11 13 3 11" /></svg>,
                car: <svg className={className} fill="none" stroke="currentColor" strokeWidth="1.5" viewBox="0 0 24 24"><path d="M14 16H9m10 0h3v-3.15a1 1 0 0 0-.84-.99L16 11l-2.7-3.6a1 1 0 0 0-.8-.4H5.24a2 2 0 0 0-1.8 1.1l-.8 1.63A6 6 0 0 0 2 12.42V16h2" /><circle cx="6.5" cy="16.5" r="2.5" /><circle cx="16.5" cy="16.5" r="2.5" /></svg>,
                train: <svg className={className} fill="none" stroke="currentColor" strokeWidth="1.5" viewBox="0 0 24 24"><rect x="4" y="3" width="16" height="16" rx="2" /><path d="M4 11h16M12 3v8M8 19l-2 3M16 19l2 3M9 15h.01M15 15h.01" /></svg>,
                bed: <svg className={className} fill="none" stroke="currentColor" strokeWidth="1.5" viewBox="0 0 24 24"><path d="M2 4v16M2 8h18a2 2 0 0 1 2 2v10M2 17h20M6 8v9" /></svg>,
                bath: <svg className={className} fill="none" stroke="currentColor" strokeWidth="1.5" viewBox="0 0 24 24"><path d="M9 6 6.5 9h11L15 6" /><path d="M20 12v7a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-7" /><path d="M2 12h20" /></svg>,
                area: <svg className={className} fill="none" stroke="currentColor" strokeWidth="1.5" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2" /><path d="M3 9h18M9 21V9" /></svg>,
                user: <svg className={className} fill="none" stroke="currentColor" strokeWidth="1.5" viewBox="0 0 24 24"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></svg>,
                star: <svg className={className} fill="currentColor" viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" /></svg>,
                verified: <svg className={className} fill="none" stroke="currentColor" strokeWidth="1.5" viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" /><path d="m9 12 2 2 4-4" /></svg>,
                menu: <svg className={className} fill="none" stroke="currentColor" strokeWidth="1.5" viewBox="0 0 24 24"><line x1="4" y1="12" x2="20" y2="12" /><line x1="4" y1="6" x2="20" y2="6" /><line x1="4" y1="18" x2="20" y2="18" /></svg>,
            };
            return icons[name] || null;
        };

        // UAE Dirham Symbol Component — uses the official new dirham font
        const Dhs = ({ className = "" }) => (
            <span className={`dirham-symbol ${className}`}>&#xea;</span>
        );

        // Loading State Component
        const LoadingState = () => (
            <div className="flex flex-col items-center justify-center py-24">
                <div className="w-16 h-16 border-4 border-warm-200 border-t-accent-gold rounded-full animate-spin mb-6"></div>
                <p className="text-warm-500 font-medium">Loading properties...</p>
            </div>
        );

        // Empty State Component
        const EmptyState = ({ message = "No properties found", description = "Try adjusting your filters or search criteria" }) => (
            <div className="flex flex-col items-center justify-center py-24 text-center">
                <div className="w-24 h-24 bg-cream-100 rounded-full flex items-center justify-center mb-6">
                    <Icon name="search" className="w-12 h-12 text-warm-400" />
                </div>
                <h3 className="text-xl font-bold text-driven-text mb-2">{message}</h3>
                <p className="text-warm-500 max-w-md">{description}</p>
            </div>
        );

        // Error State Component
        const ErrorState = ({ message = "Something went wrong", onRetry }) => (
            <div className="flex flex-col items-center justify-center py-24 text-center">
                <div className="w-24 h-24 bg-red-50 rounded-full flex items-center justify-center mb-6">
                    <Icon name="x" className="w-12 h-12 text-red-500" />
                </div>
                <h3 className="text-xl font-bold text-driven-text mb-2">{message}</h3>
                <p className="text-warm-500 mb-6">Please try again or contact support if the problem persists.</p>
                {onRetry && (
                    <button
                        onClick={onRetry}
                        aria-label="Retry loading properties"
                        className="btn-primary"
                    >
                        Try Again
                    </button>
                )}
            </div>
        );

        // Mock Data
        const mockProjects = [
            {
                id: 1, name: "Emaar Beachfront Vista", developer: "Emaar Properties", developerProjects: 42,
                location: "Dubai Harbour", area: "Palm Jumeirah", price: "د.إ1,850,000", priceNum: 1850000,
                pricePerSqft: "2,150", roi: "8.2%", appreciation: "+12.4%", completion: "Q4 2026",
                handover: "Q4 2026", paymentPlan: "60/40", category: "Waterfront",
                progress: 65, stage: "Structure Complete", beds: 2, baths: 2, sqft: "1,825",
                image: "https://images.unsplash.com/photo-1545324418-cc1a3fa10c00?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0892", escrowBank: "Emirates NBD", verified: true, trending: true,
                agent: { name: "Khalifa El Omani", image: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "Jan 2024", completed: true },
                    { name: "Foundation", date: "Apr 2024", completed: true },
                    { name: "Structure 50%", date: "Aug 2024", completed: true },
                    { name: "Structure Complete", date: "Dec 2024", completed: true },
                    { name: "MEP", date: "Apr 2025", completed: false },
                    { name: "Handover", date: "Dec 2026", completed: false }
                ]
            },
            {
                id: 2, name: "Sobha One Tower", developer: "Sobha Realty", developerProjects: 28,
                location: "Sobha Hartland", area: "MBR City", price: "د.إ2,400,000", priceNum: 2400000,
                pricePerSqft: "1,890", roi: "7.8%", appreciation: "+9.2%", completion: "Q2 2027",
                handover: "Q2 2027", paymentPlan: "70/30", category: "Off-Plan",
                progress: 42, stage: "Podium Level", beds: 3, baths: 3, sqft: "2,200",
                image: "https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-1203", escrowBank: "FAB", verified: true, trending: false,
                agent: { name: "Sarah Johnson", image: "https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "Mar 2024", completed: true },
                    { name: "Foundation", date: "Jul 2024", completed: true },
                    { name: "Podium Level", date: "Nov 2024", completed: true },
                    { name: "Structure 50%", date: "May 2025", completed: false },
                    { name: "Handover", date: "Jun 2027", completed: false }
                ]
            },
            {
                id: 3, name: "DAMAC Lagoons Villa", developer: "DAMAC Properties", developerProjects: 55,
                location: "DAMAC Lagoons", area: "Dubailand", price: "د.إ3,100,000", priceNum: 3100000,
                pricePerSqft: "1,450", roi: "9.1%", appreciation: "+15.8%", completion: "Q1 2026",
                handover: "Q1 2026", paymentPlan: "80/20", category: "Luxury",
                progress: 78, stage: "Finishing", beds: 4, baths: 5, sqft: "3,500",
                image: "https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=600&h=400&fit=crop",
                reraNo: "RERA-2023-0456", escrowBank: "Dubai Islamic Bank", verified: true, trending: true,
                agent: { name: "Ahmed Hassan", image: "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "Aug 2023", completed: true },
                    { name: "Structure", date: "Jun 2024", completed: true },
                    { name: "MEP", date: "Sep 2024", completed: true },
                    { name: "Finishing", date: "Dec 2024", completed: true },
                    { name: "Handover", date: "Mar 2026", completed: false }
                ]
            },
            {
                id: 4, name: "Creek Views Heights", developer: "Emaar Properties", developerProjects: 42,
                location: "Dubai Creek Harbour", area: "Creek Harbour", price: "د.إ1,850,000", priceNum: 1850000,
                pricePerSqft: "3,200", roi: "6.5%", appreciation: "+8.2%", completion: "Q3 2026",
                handover: "Q3 2026", paymentPlan: "60/40", category: "Off-Plan",
                progress: 55, stage: "Structure", beds: 3, baths: 4, sqft: "1,825",
                image: "https://images.unsplash.com/photo-1512917774080-9991f1c4c750?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0567", escrowBank: "Emirates NBD", verified: true, trending: false,
                agent: { name: "Khalifa El Omani", image: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: false,
                milestones: [
                    { name: "Ground Breaking", date: "Feb 2024", completed: true },
                    { name: "Foundation", date: "May 2024", completed: true },
                    { name: "Structure", date: "Oct 2024", completed: true },
                    { name: "MEP", date: "Mar 2025", completed: false },
                    { name: "Handover", date: "Sep 2026", completed: false }
                ]
            },
            {
                id: 5, name: "Marina Skyline Residence", developer: "Select Group", developerProjects: 35,
                location: "Dubai Marina", area: "Marina", price: "د.إ2,250,000", priceNum: 2250000,
                pricePerSqft: "2,400", roi: "7.5%", appreciation: "+10.5%", completion: "Q1 2027",
                handover: "Q1 2027", paymentPlan: "50/50", category: "Waterfront",
                progress: 38, stage: "Foundation", beds: 2, baths: 2, sqft: "1,550",
                image: "https://images.unsplash.com/photo-1512453979798-5ea266f8880c?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0745", escrowBank: "Mashreq Bank", verified: true, trending: true,
                agent: { name: "Fatima Al Hashmi", image: "https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "Apr 2024", completed: true },
                    { name: "Foundation", date: "Sep 2024", completed: true },
                    { name: "Structure 50%", date: "Mar 2025", completed: false },
                    { name: "Handover", date: "Mar 2027", completed: false }
                ]
            },
            {
                id: 6, name: "Downtown Edge Apartments", developer: "Meraas", developerProjects: 31,
                location: "Downtown Dubai", area: "Downtown", price: "د.إ3,500,000", priceNum: 3500000,
                pricePerSqft: "2,800", roi: "6.8%", appreciation: "+14.2%", completion: "Q3 2026",
                handover: "Q3 2026", paymentPlan: "40/60", category: "Luxury",
                progress: 72, stage: "MEP Installation", beds: 3, baths: 3, sqft: "2,100",
                image: "https://images.unsplash.com/photo-1545324418-cc1a3fa10c00?w=600&h=400&fit=crop",
                reraNo: "RERA-2023-0921", escrowBank: "ADCB", verified: true, trending: true,
                agent: { name: "Michael Chen", image: "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "Jun 2023", completed: true },
                    { name: "Structure", date: "Mar 2024", completed: true },
                    { name: "MEP Installation", date: "Nov 2024", completed: true },
                    { name: "Handover", date: "Sep 2026", completed: false }
                ]
            },
            {
                id: 7, name: "Arabian Ranches Villas", developer: "Emaar Properties", developerProjects: 42,
                location: "Arabian Ranches", area: "Arabian Ranches", price: "د.إ4,200,000", priceNum: 4200000,
                pricePerSqft: "1,350", roi: "8.9%", appreciation: "+16.3%", completion: "Q4 2025",
                handover: "Q4 2025", paymentPlan: "60/40", category: "Luxury",
                progress: 85, stage: "Final Touches", beds: 5, baths: 6, sqft: "4,200",
                image: "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?w=600&h=400&fit=crop",
                reraNo: "RERA-2023-0334", escrowBank: "Emirates NBD", verified: true, trending: false,
                agent: { name: "Omar Abdullah", image: "https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "Apr 2023", completed: true },
                    { name: "Structure", date: "Jan 2024", completed: true },
                    { name: "MEP", date: "Aug 2024", completed: true },
                    { name: "Final Touches", date: "Dec 2024", completed: true },
                    { name: "Handover", date: "Dec 2025", completed: false }
                ]
            },
            {
                id: 8, name: "Business Bay Tower", developer: "DAMAC Properties", developerProjects: 55,
                location: "Business Bay", area: "Business Bay", price: "د.إ1,650,000", priceNum: 1650000,
                pricePerSqft: "2,050", roi: "9.3%", appreciation: "+11.7%", completion: "Q2 2026",
                handover: "Q2 2026", paymentPlan: "70/30", category: "Off-Plan",
                progress: 48, stage: "Podium Complete", beds: 1, baths: 2, sqft: "980",
                image: "https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0456", escrowBank: "Dubai Islamic Bank", verified: true, trending: true,
                agent: { name: "Sarah Johnson", image: "https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: false,
                milestones: [
                    { name: "Ground Breaking", date: "Jan 2024", completed: true },
                    { name: "Foundation", date: "May 2024", completed: true },
                    { name: "Podium Complete", date: "Oct 2024", completed: true },
                    { name: "Structure 50%", date: "Apr 2025", completed: false },
                    { name: "Handover", date: "Jun 2026", completed: false }
                ]
            },
            {
                id: 9, name: "JBR Beachfront Living", developer: "Nakheel", developerProjects: 38,
                location: "JBR", area: "Jumeirah Beach", price: "د.إ2,950,000", priceNum: 2950000,
                pricePerSqft: "2,600", roi: "7.2%", appreciation: "+9.8%", completion: "Q1 2028",
                handover: "Q1 2028", paymentPlan: "50/50", category: "Waterfront",
                progress: 25, stage: "Planning", beds: 2, baths: 3, sqft: "1,680",
                image: "https://images.unsplash.com/photo-1545324418-cc1a3fa10c00?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0889", escrowBank: "FAB", verified: true, trending: false,
                agent: { name: "Ahmed Hassan", image: "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop" },
                has3DTour: false, hasVideo: true,
                milestones: [
                    { name: "Planning", date: "Nov 2024", completed: true },
                    { name: "Ground Breaking", date: "Mar 2025", completed: false },
                    { name: "Foundation", date: "Aug 2025", completed: false },
                    { name: "Handover", date: "Mar 2028", completed: false }
                ]
            },
            {
                id: 10, name: "Palm Gateway Residence", developer: "Nakheel", developerProjects: 38,
                location: "Palm Jumeirah", area: "Palm Jumeirah", price: "د.إ5,800,000", priceNum: 5800000,
                pricePerSqft: "3,100", roi: "6.2%", appreciation: "+13.5%", completion: "Q4 2027",
                handover: "Q4 2027", paymentPlan: "60/40", category: "Luxury",
                progress: 32, stage: "Foundation", beds: 4, baths: 5, sqft: "3,200",
                image: "https://images.unsplash.com/photo-1512917774080-9991f1c4c750?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0678", escrowBank: "Emirates NBD", verified: true, trending: true,
                agent: { name: "Khalifa El Omani", image: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "May 2024", completed: true },
                    { name: "Foundation", date: "Oct 2024", completed: true },
                    { name: "Structure 50%", date: "Jun 2025", completed: false },
                    { name: "Handover", date: "Dec 2027", completed: false }
                ]
            },
            {
                id: 11, name: "Sports City Apartments", developer: "Danube Properties", developerProjects: 22,
                location: "Dubai Sports City", area: "Sports City", price: "د.إ980,000", priceNum: 980000,
                pricePerSqft: "1,550", roi: "10.5%", appreciation: "+7.8%", completion: "Q3 2026",
                handover: "Q3 2026", paymentPlan: "80/20", category: "Off-Plan",
                progress: 58, stage: "Structure 50%", beds: 1, baths: 1, sqft: "750",
                image: "https://images.unsplash.com/photo-1545324418-cc1a3fa10c00?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0234", escrowBank: "Mashreq Bank", verified: true, trending: false,
                agent: { name: "Priya Sharma", image: "https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: false,
                milestones: [
                    { name: "Ground Breaking", date: "Dec 2023", completed: true },
                    { name: "Foundation", date: "Apr 2024", completed: true },
                    { name: "Structure 50%", date: "Sep 2024", completed: true },
                    { name: "MEP", date: "Feb 2025", completed: false },
                    { name: "Handover", date: "Sep 2026", completed: false }
                ]
            },
            {
                id: 12, name: "Silicon Oasis Hub", developer: "Reportage Properties", developerProjects: 18,
                location: "Silicon Oasis", area: "Silicon Oasis", price: "د.إ720,000", priceNum: 720000,
                pricePerSqft: "1,380", roi: "11.2%", appreciation: "+6.5%", completion: "Q2 2026",
                handover: "Q2 2026", paymentPlan: "70/30", category: "Off-Plan",
                progress: 68, stage: "MEP Installation", beds: 1, baths: 1, sqft: "650",
                image: "https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=600&h=400&fit=crop",
                reraNo: "RERA-2023-0998", escrowBank: "ADCB", verified: true, trending: true,
                agent: { name: "John Martinez", image: "https://images.unsplash.com/photo-1519345182560-3f2917c472ef?w=100&h=100&fit=crop" },
                has3DTour: false, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "Jul 2023", completed: true },
                    { name: "Structure", date: "Mar 2024", completed: true },
                    { name: "MEP Installation", date: "Oct 2024", completed: true },
                    { name: "Handover", date: "Jun 2026", completed: false }
                ]
            },
            {
                id: 13, name: "MBR City Villas", developer: "Sobha Realty", developerProjects: 28,
                location: "MBR City", area: "MBR City", price: "د.إ3,850,000", priceNum: 3850000,
                pricePerSqft: "1,620", roi: "8.4%", appreciation: "+14.9%", completion: "Q1 2027",
                progress: 45, stage: "Foundation Complete", beds: 4, baths: 5, sqft: "3,800",
                image: "https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0445", escrowBank: "FAB", verified: true, trending: true,
                agent: { name: "Sarah Johnson", image: "https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "Feb 2024", completed: true },
                    { name: "Foundation Complete", date: "Aug 2024", completed: true },
                    { name: "Structure 50%", date: "Mar 2025", completed: false },
                    { name: "Handover", date: "Mar 2027", completed: false }
                ]
            },
            {
                id: 14, name: "Al Barsha Heights Tower", developer: "Azizi Developments", developerProjects: 48,
                location: "Al Barsha", area: "Al Barsha", price: "د.إ1,450,000", priceNum: 1450000,
                pricePerSqft: "1,950", roi: "8.8%", appreciation: "+10.2%", completion: "Q4 2026",
                progress: 52, stage: "Structure 50%", beds: 2, baths: 2, sqft: "1,250",
                image: "https://images.unsplash.com/photo-1545324418-cc1a3fa10c00?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0556", escrowBank: "Dubai Islamic Bank", verified: true, trending: false,
                agent: { name: "Fatima Al Hashmi", image: "https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "Jan 2024", completed: true },
                    { name: "Foundation", date: "Jun 2024", completed: true },
                    { name: "Structure 50%", date: "Nov 2024", completed: true },
                    { name: "MEP", date: "May 2025", completed: false },
                    { name: "Handover", date: "Dec 2026", completed: false }
                ]
            },
            {
                id: 15, name: "Jumeirah Village Circle", developer: "Nakheel", developerProjects: 38,
                location: "JVC", area: "JVC", price: "د.إ1,180,000", priceNum: 1180000,
                pricePerSqft: "1,680", roi: "9.6%", appreciation: "+8.9%", completion: "Q3 2026",
                progress: 61, stage: "Structure Complete", beds: 2, baths: 2, sqft: "1,100",
                image: "https://images.unsplash.com/photo-1512917774080-9991f1c4c750?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0223", escrowBank: "Emirates NBD", verified: true, trending: true,
                agent: { name: "Omar Abdullah", image: "https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: false,
                milestones: [
                    { name: "Ground Breaking", date: "Nov 2023", completed: true },
                    { name: "Foundation", date: "Apr 2024", completed: true },
                    { name: "Structure Complete", date: "Sep 2024", completed: true },
                    { name: "MEP", date: "Mar 2025", completed: false },
                    { name: "Handover", date: "Sep 2026", completed: false }
                ]
            },
            {
                id: 16, name: "City Walk Residences", developer: "Meraas", developerProjects: 31,
                location: "City Walk", area: "Al Wasl", price: "د.إ4,500,000", priceNum: 4500000,
                pricePerSqft: "2,950", roi: "6.9%", appreciation: "+12.8%", completion: "Q2 2027",
                progress: 35, stage: "Foundation", beds: 3, baths: 4, sqft: "2,450",
                image: "https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0778", escrowBank: "Mashreq Bank", verified: true, trending: true,
                agent: { name: "Michael Chen", image: "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "Jun 2024", completed: true },
                    { name: "Foundation", date: "Nov 2024", completed: true },
                    { name: "Structure 50%", date: "Jul 2025", completed: false },
                    { name: "Handover", date: "Jun 2027", completed: false }
                ]
            },
            {
                id: 17, name: "Discovery Gardens Block", developer: "Nakheel", developerProjects: 38,
                location: "Discovery Gardens", area: "Discovery Gardens", price: "د.إ850,000", priceNum: 850000,
                pricePerSqft: "1,480", roi: "10.8%", appreciation: "+7.2%", completion: "Q1 2026",
                progress: 75, stage: "Finishing", beds: 1, baths: 1, sqft: "720",
                image: "https://images.unsplash.com/photo-1545324418-cc1a3fa10c00?w=600&h=400&fit=crop",
                reraNo: "RERA-2023-0667", escrowBank: "ADCB", verified: true, trending: false,
                agent: { name: "Priya Sharma", image: "https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?w=100&h=100&fit=crop" },
                has3DTour: false, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "May 2023", completed: true },
                    { name: "Structure", date: "Jan 2024", completed: true },
                    { name: "MEP", date: "Jul 2024", completed: true },
                    { name: "Finishing", date: "Nov 2024", completed: true },
                    { name: "Handover", date: "Mar 2026", completed: false }
                ]
            },
            {
                id: 18, name: "Motor City Parkview", developer: "Union Properties", developerProjects: 15,
                location: "Motor City", area: "Motor City", price: "د.إ1,350,000", priceNum: 1350000,
                pricePerSqft: "1,720", roi: "9.4%", appreciation: "+9.5%", completion: "Q4 2026",
                progress: 50, stage: "Podium Level", beds: 2, baths: 2, sqft: "1,180",
                image: "https://images.unsplash.com/photo-1512917774080-9991f1c4c750?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0334", escrowBank: "FAB", verified: true, trending: true,
                agent: { name: "Ahmed Hassan", image: "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "Feb 2024", completed: true },
                    { name: "Foundation", date: "Jul 2024", completed: true },
                    { name: "Podium Level", date: "Oct 2024", completed: true },
                    { name: "Structure 50%", date: "Apr 2025", completed: false },
                    { name: "Handover", date: "Dec 2026", completed: false }
                ]
            },
            {
                id: 19, name: "International City Gateway", developer: "Nakheel", developerProjects: 38,
                location: "International City", area: "International City", price: "د.إ620,000", priceNum: 620000,
                pricePerSqft: "1,320", roi: "12.1%", appreciation: "+5.8%", completion: "Q2 2026",
                progress: 70, stage: "MEP Complete", beds: 1, baths: 1, sqft: "580",
                image: "https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=600&h=400&fit=crop",
                reraNo: "RERA-2023-0889", escrowBank: "Dubai Islamic Bank", verified: true, trending: false,
                agent: { name: "John Martinez", image: "https://images.unsplash.com/photo-1519345182560-3f2917c472ef?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: false,
                milestones: [
                    { name: "Ground Breaking", date: "Jun 2023", completed: true },
                    { name: "Structure", date: "Feb 2024", completed: true },
                    { name: "MEP Complete", date: "Sep 2024", completed: true },
                    { name: "Handover", date: "Jun 2026", completed: false }
                ]
            },
            {
                id: 20, name: "Green Community Villas", developer: "Union Properties", developerProjects: 15,
                location: "Green Community", area: "DIP", price: "د.إ2,680,000", priceNum: 2680000,
                pricePerSqft: "1,520", roi: "8.6%", appreciation: "+11.4%", completion: "Q3 2026",
                progress: 64, stage: "Structure Complete", beds: 3, baths: 4, sqft: "2,850",
                image: "https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0112", escrowBank: "Emirates NBD", verified: true, trending: true,
                agent: { name: "Khalifa El Omani", image: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "Dec 2023", completed: true },
                    { name: "Foundation", date: "May 2024", completed: true },
                    { name: "Structure Complete", date: "Oct 2024", completed: true },
                    { name: "MEP", date: "Apr 2025", completed: false },
                    { name: "Handover", date: "Sep 2026", completed: false }
                ]
            },
            {
                id: 21, name: "Mirdif Hills Apartments", developer: "Dubai Properties", developerProjects: 26,
                location: "Mirdif", area: "Mirdif", price: "د.إ1,550,000", priceNum: 1550000,
                pricePerSqft: "1,850", roi: "8.1%", appreciation: "+10.8%", completion: "Q1 2027",
                progress: 40, stage: "Foundation", beds: 2, baths: 2, sqft: "1,350",
                image: "https://images.unsplash.com/photo-1545324418-cc1a3fa10c00?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0445", escrowBank: "Mashreq Bank", verified: true, trending: false,
                agent: { name: "Sarah Johnson", image: "https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "Mar 2024", completed: true },
                    { name: "Foundation", date: "Sep 2024", completed: true },
                    { name: "Structure 50%", date: "May 2025", completed: false },
                    { name: "Handover", date: "Mar 2027", completed: false }
                ]
            },
            {
                id: 22, name: "The Hills Estate", developer: "Emaar Properties", developerProjects: 42,
                location: "The Hills", area: "Emirates Hills", price: "د.إ8,900,000", priceNum: 8900000,
                pricePerSqft: "2,150", roi: "5.8%", appreciation: "+17.5%", completion: "Q4 2026",
                progress: 55, stage: "Structure 50%", beds: 6, baths: 7, sqft: "6,200",
                image: "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0001", escrowBank: "Emirates NBD", verified: true, trending: true,
                agent: { name: "Omar Abdullah", image: "https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "Jan 2024", completed: true },
                    { name: "Foundation", date: "Jun 2024", completed: true },
                    { name: "Structure 50%", date: "Nov 2024", completed: true },
                    { name: "MEP", date: "Jun 2025", completed: false },
                    { name: "Handover", date: "Dec 2026", completed: false }
                ]
            },
            {
                id: 23, name: "Al Furjan Gardens", developer: "Nakheel", developerProjects: 38,
                location: "Al Furjan", area: "Al Furjan", price: "د.إ1,920,000", priceNum: 1920000,
                pricePerSqft: "1,620", roi: "8.7%", appreciation: "+9.6%", completion: "Q2 2026",
                progress: 68, stage: "MEP Installation", beds: 3, baths: 3, sqft: "1,950",
                image: "https://images.unsplash.com/photo-1512917774080-9991f1c4c750?w=600&h=400&fit=crop",
                reraNo: "RERA-2023-0778", escrowBank: "ADCB", verified: true, trending: false,
                agent: { name: "Fatima Al Hashmi", image: "https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "Aug 2023", completed: true },
                    { name: "Structure", date: "Apr 2024", completed: true },
                    { name: "MEP Installation", date: "Oct 2024", completed: true },
                    { name: "Handover", date: "Jun 2026", completed: false }
                ]
            },
            {
                id: 24, name: "Bluewaters Island View", developer: "Meraas", developerProjects: 31,
                location: "Bluewaters Island", area: "Bluewaters", price: "د.إ3,200,000", priceNum: 3200000,
                pricePerSqft: "2,700", roi: "7.3%", appreciation: "+13.2%", completion: "Q3 2027",
                progress: 28, stage: "Planning Complete", beds: 2, baths: 3, sqft: "1,780",
                image: "https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0890", escrowBank: "FAB", verified: true, trending: true,
                agent: { name: "Michael Chen", image: "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=100&h=100&fit=crop" },
                has3DTour: false, hasVideo: true,
                milestones: [
                    { name: "Planning Complete", date: "Oct 2024", completed: true },
                    { name: "Ground Breaking", date: "Feb 2025", completed: false },
                    { name: "Foundation", date: "Jul 2025", completed: false },
                    { name: "Handover", date: "Sep 2027", completed: false }
                ]
            },
            {
                id: 25, name: "Dubai South Apartments", developer: "MAG", developerProjects: 33,
                location: "Dubai South", area: "Dubai South", price: "د.إ780,000", priceNum: 780000,
                pricePerSqft: "1,420", roi: "11.5%", appreciation: "+6.9%", completion: "Q1 2026",
                progress: 78, stage: "Finishing", beds: 1, baths: 1, sqft: "680",
                image: "https://images.unsplash.com/photo-1545324418-cc1a3fa10c00?w=600&h=400&fit=crop",
                reraNo: "RERA-2023-0445", escrowBank: "Dubai Islamic Bank", verified: true, trending: false,
                agent: { name: "Priya Sharma", image: "https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: false,
                milestones: [
                    { name: "Ground Breaking", date: "Apr 2023", completed: true },
                    { name: "Structure", date: "Dec 2023", completed: true },
                    { name: "MEP", date: "Jul 2024", completed: true },
                    { name: "Finishing", date: "Nov 2024", completed: true },
                    { name: "Handover", date: "Mar 2026", completed: false }
                ]
            },
            {
                id: 26, name: "Town Square Living", developer: "Nshama", developerProjects: 19,
                location: "Town Square", area: "Town Square", price: "د.إ1,280,000", priceNum: 1280000,
                pricePerSqft: "1,690", roi: "9.2%", appreciation: "+8.7%", completion: "Q4 2026",
                progress: 56, stage: "Structure 50%", beds: 2, baths: 2, sqft: "1,150",
                image: "https://images.unsplash.com/photo-1512917774080-9991f1c4c750?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0223", escrowBank: "Mashreq Bank", verified: true, trending: true,
                agent: { name: "Ahmed Hassan", image: "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "Nov 2023", completed: true },
                    { name: "Foundation", date: "May 2024", completed: true },
                    { name: "Structure 50%", date: "Sep 2024", completed: true },
                    { name: "MEP", date: "Apr 2025", completed: false },
                    { name: "Handover", date: "Dec 2026", completed: false }
                ]
            },
            {
                id: 27, name: "Expo Valley Heights", developer: "DP World", developerProjects: 12,
                location: "Expo City", area: "Expo City", price: "د.إ1,450,000", priceNum: 1450000,
                pricePerSqft: "1,780", roi: "9.8%", appreciation: "+10.3%", completion: "Q2 2027",
                progress: 42, stage: "Foundation Complete", beds: 2, baths: 2, sqft: "1,280",
                image: "https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0556", escrowBank: "Emirates NBD", verified: true, trending: true,
                agent: { name: "John Martinez", image: "https://images.unsplash.com/photo-1519345182560-3f2917c472ef?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "Apr 2024", completed: true },
                    { name: "Foundation Complete", date: "Sep 2024", completed: true },
                    { name: "Structure 50%", date: "Mar 2025", completed: false },
                    { name: "Handover", date: "Jun 2027", completed: false }
                ]
            },
            {
                id: 28, name: "Liwan Residences", developer: "Mazaya", developerProjects: 24,
                location: "Queue Point", area: "Liwan", price: "د.إ950,000", priceNum: 950000,
                pricePerSqft: "1,480", roi: "10.2%", appreciation: "+7.5%", completion: "Q3 2026",
                progress: 62, stage: "Structure Complete", beds: 1, baths: 2, sqft: "820",
                image: "https://images.unsplash.com/photo-1545324418-cc1a3fa10c00?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0334", escrowBank: "ADCB", verified: true, trending: false,
                agent: { name: "Sarah Johnson", image: "https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: false,
                milestones: [
                    { name: "Ground Breaking", date: "Oct 2023", completed: true },
                    { name: "Foundation", date: "Mar 2024", completed: true },
                    { name: "Structure Complete", date: "Aug 2024", completed: true },
                    { name: "MEP", date: "Feb 2025", completed: false },
                    { name: "Handover", date: "Sep 2026", completed: false }
                ]
            },
            {
                id: 29, name: "Dubai Hills Vista", developer: "Emaar Properties", developerProjects: 42,
                location: "Dubai Hills Estate", area: "Dubai Hills", price: "د.إ2,850,000", priceNum: 2850000,
                pricePerSqft: "2,180", roi: "7.6%", appreciation: "+12.5%", completion: "Q1 2027",
                progress: 48, stage: "Podium Level", beds: 3, baths: 3, sqft: "2,050",
                image: "https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0667", escrowBank: "FAB", verified: true, trending: true,
                agent: { name: "Khalifa El Omani", image: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "Feb 2024", completed: true },
                    { name: "Foundation", date: "Jul 2024", completed: true },
                    { name: "Podium Level", date: "Nov 2024", completed: true },
                    { name: "Structure 50%", date: "May 2025", completed: false },
                    { name: "Handover", date: "Mar 2027", completed: false }
                ]
            },
            {
                id: 30, name: "Arjan Cityscape", developer: "DAMAC Properties", developerProjects: 55,
                location: "Arjan", area: "Arjan", price: "د.إ1,120,000", priceNum: 1120000,
                pricePerSqft: "1,650", roi: "9.5%", appreciation: "+8.4%", completion: "Q4 2026",
                progress: 58, stage: "Structure 50%", beds: 1, baths: 2, sqft: "890",
                image: "https://images.unsplash.com/photo-1512917774080-9991f1c4c750?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0189", escrowBank: "Dubai Islamic Bank", verified: true, trending: false,
                agent: { name: "Omar Abdullah", image: "https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "Dec 2023", completed: true },
                    { name: "Foundation", date: "May 2024", completed: true },
                    { name: "Structure 50%", date: "Sep 2024", completed: true },
                    { name: "MEP", date: "Mar 2025", completed: false },
                    { name: "Handover", date: "Dec 2026", completed: false }
                ]
            },
            {
                id: 31, name: "Dubai Marina Heights", developer: "Select Group", developerProjects: 35,
                location: "Dubai Marina", area: "Marina", price: "د.إ3,680,000", priceNum: 3680000,
                pricePerSqft: "2,850", roi: "6.9%", appreciation: "+11.8%", completion: "Q2 2028",
                progress: 22, stage: "Planning", beds: 3, baths: 4, sqft: "2,280",
                image: "https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0912", escrowBank: "Mashreq Bank", verified: true, trending: true,
                agent: { name: "Fatima Al Hashmi", image: "https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=100&h=100&fit=crop" },
                has3DTour: false, hasVideo: true,
                milestones: [
                    { name: "Planning", date: "Dec 2024", completed: true },
                    { name: "Ground Breaking", date: "Apr 2025", completed: false },
                    { name: "Foundation", date: "Sep 2025", completed: false },
                    { name: "Handover", date: "Jun 2028", completed: false }
                ]
            },
            {
                id: 32, name: "The Lagoons Beach", developer: "Dubai Properties", developerProjects: 26,
                location: "Dubai Creek Harbour", area: "Creek Harbour", price: "د.إ2,450,000", priceNum: 2450000,
                pricePerSqft: "2,350", roi: "7.7%", appreciation: "+10.9%", completion: "Q3 2027",
                progress: 38, stage: "Foundation", beds: 2, baths: 3, sqft: "1,680",
                image: "https://images.unsplash.com/photo-1545324418-cc1a3fa10c00?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0778", escrowBank: "Emirates NBD", verified: true, trending: false,
                agent: { name: "Michael Chen", image: "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "May 2024", completed: true },
                    { name: "Foundation", date: "Oct 2024", completed: true },
                    { name: "Structure 50%", date: "Jun 2025", completed: false },
                    { name: "Handover", date: "Sep 2027", completed: false }
                ]
            },
            {
                id: 33, name: "Remraam Community", developer: "Nakheel", developerProjects: 38,
                location: "Remraam", area: "Remraam", price: "د.إ890,000", priceNum: 890000,
                pricePerSqft: "1,520", roi: "10.4%", appreciation: "+7.6%", completion: "Q1 2026",
                progress: 72, stage: "MEP Complete", beds: 1, baths: 1, sqft: "750",
                image: "https://images.unsplash.com/photo-1512917774080-9991f1c4c750?w=600&h=400&fit=crop",
                reraNo: "RERA-2023-0556", escrowBank: "ADCB", verified: true, trending: true,
                agent: { name: "Priya Sharma", image: "https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: false,
                milestones: [
                    { name: "Ground Breaking", date: "Mar 2023", completed: true },
                    { name: "Structure", date: "Nov 2023", completed: true },
                    { name: "MEP Complete", date: "Aug 2024", completed: true },
                    { name: "Handover", date: "Mar 2026", completed: false }
                ]
            },
            {
                id: 34, name: "Wasl District Apartments", developer: "Wasl Properties", developerProjects: 21,
                location: "Wasl District", area: "Al Jaddaf", price: "د.إ1,650,000", priceNum: 1650000,
                pricePerSqft: "1,980", roi: "8.5%", appreciation: "+9.7%", completion: "Q4 2026",
                progress: 54, stage: "Structure 50%", beds: 2, baths: 2, sqft: "1,350",
                image: "https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0445", escrowBank: "FAB", verified: true, trending: false,
                agent: { name: "John Martinez", image: "https://images.unsplash.com/photo-1519345182560-3f2917c472ef?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "Jan 2024", completed: true },
                    { name: "Foundation", date: "Jun 2024", completed: true },
                    { name: "Structure 50%", date: "Oct 2024", completed: true },
                    { name: "MEP", date: "Apr 2025", completed: false },
                    { name: "Handover", date: "Dec 2026", completed: false }
                ]
            },
            {
                id: 35, name: "The Springs Villas", developer: "Emaar Properties", developerProjects: 42,
                location: "The Springs", area: "The Springs", price: "د.إ3,200,000", priceNum: 3200000,
                pricePerSqft: "1,580", roi: "8.3%", appreciation: "+13.6%", completion: "Q2 2026",
                progress: 68, stage: "MEP Installation", beds: 4, baths: 5, sqft: "3,150",
                image: "https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=600&h=400&fit=crop",
                reraNo: "RERA-2023-0889", escrowBank: "Emirates NBD", verified: true, trending: true,
                agent: { name: "Ahmed Hassan", image: "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "Jul 2023", completed: true },
                    { name: "Structure", date: "Mar 2024", completed: true },
                    { name: "MEP Installation", date: "Sep 2024", completed: true },
                    { name: "Handover", date: "Jun 2026", completed: false }
                ]
            },
            {
                id: 36, name: "Akoya Oxygen Townhouses", developer: "DAMAC Properties", developerProjects: 55,
                location: "Akoya Oxygen", area: "Akoya", price: "د.إ1,880,000", priceNum: 1880000,
                pricePerSqft: "1,420", roi: "9.1%", appreciation: "+12.2%", completion: "Q3 2026",
                progress: 60, stage: "Structure Complete", beds: 3, baths: 4, sqft: "2,250",
                image: "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0223", escrowBank: "Dubai Islamic Bank", verified: true, trending: false,
                agent: { name: "Sarah Johnson", image: "https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "Nov 2023", completed: true },
                    { name: "Foundation", date: "Apr 2024", completed: true },
                    { name: "Structure Complete", date: "Sep 2024", completed: true },
                    { name: "MEP", date: "Mar 2025", completed: false },
                    { name: "Handover", date: "Sep 2026", completed: false }
                ]
            },
            {
                id: 37, name: "Culture Village Residences", developer: "Dubai Properties", developerProjects: 26,
                location: "Culture Village", area: "Al Jaddaf", price: "د.إ1,750,000", priceNum: 1750000,
                pricePerSqft: "2,100", roi: "8.0%", appreciation: "+10.1%", completion: "Q1 2027",
                progress: 44, stage: "Foundation Complete", beds: 2, baths: 2, sqft: "1,420",
                image: "https://images.unsplash.com/photo-1512917774080-9991f1c4c750?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0556", escrowBank: "Mashreq Bank", verified: true, trending: true,
                agent: { name: "Khalifa El Omani", image: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "Mar 2024", completed: true },
                    { name: "Foundation Complete", date: "Aug 2024", completed: true },
                    { name: "Structure 50%", date: "Apr 2025", completed: false },
                    { name: "Handover", date: "Mar 2027", completed: false }
                ]
            },
            {
                id: 38, name: "Mudon Villas", developer: "Dubai Properties", developerProjects: 26,
                location: "Mudon", area: "Mudon", price: "د.إ2,350,000", priceNum: 2350000,
                pricePerSqft: "1,560", roi: "8.8%", appreciation: "+11.5%", completion: "Q4 2026",
                progress: 64, stage: "Structure Complete", beds: 3, baths: 4, sqft: "2,680",
                image: "https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0112", escrowBank: "ADCB", verified: true, trending: false,
                agent: { name: "Omar Abdullah", image: "https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: false,
                milestones: [
                    { name: "Ground Breaking", date: "Sep 2023", completed: true },
                    { name: "Foundation", date: "Mar 2024", completed: true },
                    { name: "Structure Complete", date: "Aug 2024", completed: true },
                    { name: "MEP", date: "Feb 2025", completed: false },
                    { name: "Handover", date: "Dec 2026", completed: false }
                ]
            },
            {
                id: 39, name: "Jumeirah Park Townhouses", developer: "Nakheel", developerProjects: 38,
                location: "Jumeirah Park", area: "Jumeirah Park", price: "د.إ3,450,000", priceNum: 3450000,
                pricePerSqft: "1,650", roi: "7.9%", appreciation: "+13.8%", completion: "Q2 2026",
                progress: 70, stage: "MEP Complete", beds: 4, baths: 5, sqft: "3,420",
                image: "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?w=600&h=400&fit=crop",
                reraNo: "RERA-2023-0667", escrowBank: "FAB", verified: true, trending: true,
                agent: { name: "Fatima Al Hashmi", image: "https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "May 2023", completed: true },
                    { name: "Structure", date: "Jan 2024", completed: true },
                    { name: "MEP Complete", date: "Jul 2024", completed: true },
                    { name: "Handover", date: "Jun 2026", completed: false }
                ]
            },
            {
                id: 40, name: "Serena Bella Vista", developer: "Dubai Properties", developerProjects: 26,
                location: "Dubai Land", area: "Dubailand", price: "د.إ1,580,000", priceNum: 1580000,
                pricePerSqft: "1,720", roi: "9.0%", appreciation: "+9.3%", completion: "Q3 2026",
                progress: 58, stage: "Structure 50%", beds: 3, baths: 3, sqft: "1,850",
                image: "https://images.unsplash.com/photo-1545324418-cc1a3fa10c00?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0334", escrowBank: "Emirates NBD", verified: true, trending: false,
                agent: { name: "Michael Chen", image: "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "Dec 2023", completed: true },
                    { name: "Foundation", date: "May 2024", completed: true },
                    { name: "Structure 50%", date: "Sep 2024", completed: true },
                    { name: "MEP", date: "Mar 2025", completed: false },
                    { name: "Handover", date: "Sep 2026", completed: false }
                ]
            },
            {
                id: 41, name: "District One Villas", developer: "Meydan", developerProjects: 17,
                location: "District One", area: "MBR City", price: "د.إ12,500,000", priceNum: 12500000,
                pricePerSqft: "2,850", roi: "5.2%", appreciation: "+19.4%", completion: "Q1 2027",
                progress: 48, stage: "Podium Level", beds: 6, baths: 8, sqft: "7,500",
                image: "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0002", escrowBank: "Emirates NBD", verified: true, trending: true,
                agent: { name: "Khalifa El Omani", image: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "Jan 2024", completed: true },
                    { name: "Foundation", date: "Jul 2024", completed: true },
                    { name: "Podium Level", date: "Nov 2024", completed: true },
                    { name: "Structure 50%", date: "Jul 2025", completed: false },
                    { name: "Handover", date: "Mar 2027", completed: false }
                ]
            },
            {
                id: 42, name: "Villanova Community", developer: "Dubai Properties", developerProjects: 26,
                location: "Villanova", area: "Dubailand", price: "د.إ2,180,000", priceNum: 2180000,
                pricePerSqft: "1,520", roi: "8.6%", appreciation: "+10.6%", completion: "Q4 2026",
                progress: 62, stage: "Structure Complete", beds: 3, baths: 4, sqft: "2,480",
                image: "https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0189", escrowBank: "Mashreq Bank", verified: true, trending: false,
                agent: { name: "Priya Sharma", image: "https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "Oct 2023", completed: true },
                    { name: "Foundation", date: "Apr 2024", completed: true },
                    { name: "Structure Complete", date: "Sep 2024", completed: true },
                    { name: "MEP", date: "Mar 2025", completed: false },
                    { name: "Handover", date: "Dec 2026", completed: false }
                ]
            },
            {
                id: 43, name: "Dubai Wharf Residences", developer: "Meydan", developerProjects: 17,
                location: "Dubai Wharf", area: "Dubai Wharf", price: "د.إ1,920,000", priceNum: 1920000,
                pricePerSqft: "2,220", roi: "7.8%", appreciation: "+11.2%", completion: "Q2 2027",
                progress: 38, stage: "Foundation", beds: 2, baths: 2, sqft: "1,480",
                image: "https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0667", escrowBank: "Dubai Islamic Bank", verified: true, trending: true,
                agent: { name: "John Martinez", image: "https://images.unsplash.com/photo-1519345182560-3f2917c472ef?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "Apr 2024", completed: true },
                    { name: "Foundation", date: "Sep 2024", completed: true },
                    { name: "Structure 50%", date: "May 2025", completed: false },
                    { name: "Handover", date: "Jun 2027", completed: false }
                ]
            },
            {
                id: 44, name: "The Valley Villas", developer: "Emaar Properties", developerProjects: 42,
                location: "The Valley", area: "Dubailand", price: "د.إ2,680,000", priceNum: 2680000,
                pricePerSqft: "1,580", roi: "8.7%", appreciation: "+12.9%", completion: "Q3 2026",
                progress: 56, stage: "Structure 50%", beds: 4, baths: 5, sqft: "3,120",
                image: "https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0445", escrowBank: "FAB", verified: true, trending: true,
                agent: { name: "Ahmed Hassan", image: "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "Nov 2023", completed: true },
                    { name: "Foundation", date: "May 2024", completed: true },
                    { name: "Structure 50%", date: "Sep 2024", completed: true },
                    { name: "MEP", date: "Apr 2025", completed: false },
                    { name: "Handover", date: "Sep 2026", completed: false }
                ]
            },
            {
                id: 45, name: "Tilal Al Ghaf Community", developer: "Majid Al Futtaim", developerProjects: 14,
                location: "Tilal Al Ghaf", area: "Tilal Al Ghaf", price: "د.إ3,150,000", priceNum: 3150000,
                pricePerSqft: "1,680", roi: "7.5%", appreciation: "+13.4%", completion: "Q1 2027",
                progress: 50, stage: "Podium Complete", beds: 4, baths: 5, sqft: "3,280",
                image: "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0778", escrowBank: "ADCB", verified: true, trending: false,
                agent: { name: "Sarah Johnson", image: "https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "Feb 2024", completed: true },
                    { name: "Foundation", date: "Jul 2024", completed: true },
                    { name: "Podium Complete", date: "Oct 2024", completed: true },
                    { name: "Structure 50%", date: "Jun 2025", completed: false },
                    { name: "Handover", date: "Mar 2027", completed: false }
                ]
            },
            {
                id: 46, name: "Reem Community", developer: "Emaar Properties", developerProjects: 42,
                location: "Reem", area: "Arabian Ranches", price: "د.إ3,680,000", priceNum: 3680000,
                pricePerSqft: "1,720", roi: "7.9%", appreciation: "+14.7%", completion: "Q2 2026",
                progress: 68, stage: "MEP Installation", beds: 5, baths: 6, sqft: "3,850",
                image: "https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=600&h=400&fit=crop",
                reraNo: "RERA-2023-0889", escrowBank: "Emirates NBD", verified: true, trending: true,
                agent: { name: "Omar Abdullah", image: "https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "Jun 2023", completed: true },
                    { name: "Structure", date: "Feb 2024", completed: true },
                    { name: "MEP Installation", date: "Aug 2024", completed: true },
                    { name: "Handover", date: "Jun 2026", completed: false }
                ]
            },
            {
                id: 47, name: "Bay Square Tower", developer: "Nakheel", developerProjects: 38,
                location: "Business Bay", area: "Business Bay", price: "د.إ1,780,000", priceNum: 1780000,
                pricePerSqft: "2,180", roi: "8.9%", appreciation: "+10.7%", completion: "Q4 2026",
                progress: 52, stage: "Structure 50%", beds: 2, baths: 2, sqft: "1,380",
                image: "https://images.unsplash.com/photo-1512917774080-9991f1c4c750?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0334", escrowBank: "Mashreq Bank", verified: true, trending: false,
                agent: { name: "Fatima Al Hashmi", image: "https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: false,
                milestones: [
                    { name: "Ground Breaking", date: "Jan 2024", completed: true },
                    { name: "Foundation", date: "Jun 2024", completed: true },
                    { name: "Structure 50%", date: "Oct 2024", completed: true },
                    { name: "MEP", date: "Apr 2025", completed: false },
                    { name: "Handover", date: "Dec 2026", completed: false }
                ]
            },
            {
                id: 48, name: "Reef at Dubai Islands", developer: "Nakheel", developerProjects: 38,
                location: "Dubai Islands", area: "Dubai Islands", price: "د.إ4,850,000", priceNum: 4850000,
                pricePerSqft: "2,920", roi: "6.8%", appreciation: "+15.3%", completion: "Q3 2027",
                progress: 32, stage: "Foundation", beds: 3, baths: 4, sqft: "2,650",
                image: "https://images.unsplash.com/photo-1545324418-cc1a3fa10c00?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0890", escrowBank: "FAB", verified: true, trending: true,
                agent: { name: "Michael Chen", image: "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "May 2024", completed: true },
                    { name: "Foundation", date: "Oct 2024", completed: true },
                    { name: "Structure 50%", date: "Jun 2025", completed: false },
                    { name: "Handover", date: "Sep 2027", completed: false }
                ]
            },
            {
                id: 49, name: "Grand Views Apartments", developer: "Sobha Realty", developerProjects: 28,
                location: "Sobha Hartland", area: "MBR City", price: "د.إ2,150,000", priceNum: 2150000,
                pricePerSqft: "2,050", roi: "8.1%", appreciation: "+11.6%", completion: "Q1 2027",
                progress: 42, stage: "Foundation Complete", beds: 2, baths: 3, sqft: "1,680",
                image: "https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0556", escrowBank: "Dubai Islamic Bank", verified: true, trending: false,
                agent: { name: "Priya Sharma", image: "https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "Mar 2024", completed: true },
                    { name: "Foundation Complete", date: "Aug 2024", completed: true },
                    { name: "Structure 50%", date: "Apr 2025", completed: false },
                    { name: "Handover", date: "Mar 2027", completed: false }
                ]
            },
            {
                id: 50, name: "Madinat Jumeirah Living", developer: "Dubai Holding", developerProjects: 20,
                location: "Madinat Jumeirah Living", area: "Umm Suqeim", price: "د.إ5,200,000", priceNum: 5200000,
                pricePerSqft: "2,680", roi: "6.4%", appreciation: "+16.8%", completion: "Q2 2027",
                progress: 45, stage: "Foundation Complete", beds: 4, baths: 5, sqft: "3,450",
                image: "https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=600&h=400&fit=crop",
                reraNo: "RERA-2024-0667", escrowBank: "Emirates NBD", verified: true, trending: true,
                agent: { name: "Khalifa El Omani", image: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop" },
                has3DTour: true, hasVideo: true,
                milestones: [
                    { name: "Ground Breaking", date: "Feb 2024", completed: true },
                    { name: "Foundation Complete", date: "Aug 2024", completed: true },
                    { name: "Structure 50%", date: "May 2025", completed: false },
                    { name: "Handover", date: "Jun 2027", completed: false }
                ]
            }
        ];

        // Header Component
        const Header = ({ onNavigate, watchlistCount, user, onDashboard }) => {
            const [isMobileMenuOpen, setIsMobileMenuOpen] = React.useState(false);
            const [overflowOpen, setOverflowOpen] = React.useState(false);
            const [visibleCount, setVisibleCount] = React.useState(8); // 8 = all items; -1 = hamburger only

            const navItems = [
                { label: 'Buy', hasDropdown: true },
                { label: 'Sell', hasDropdown: false },
                { label: 'Rent', hasDropdown: true },
                { label: 'Invest', hasDropdown: false },
                { label: 'Projects', hasDropdown: false },
                { label: 'Services', hasDropdown: false },
                { label: 'Content Hub', hasDropdown: true },
                { label: 'Find Agent', hasDropdown: false },
            ];

            // Priority-plus: minimum core items that must all be visible before jumping to hamburger
            const MIN_CORE = 4; // Buy, Sell, Rent, Invest
            const navContainerRef = React.useRef(null);
            const measureRef = React.useRef(null);

            // Recalculate how many items fit whenever the nav container resizes
            React.useEffect(() => {
                const recalculate = () => {
                    if (!navContainerRef.current || !measureRef.current) return;
                    const available = navContainerRef.current.offsetWidth;
                    const children = Array.from(measureRef.current.children);
                    if (children.length < navItems.length + 1) return;
                    // Last child in measureRef is the "More" overflow button
                    const overflowBtnW = children[navItems.length].offsetWidth + 8;
                    const itemWidths = children.slice(0, navItems.length).map(el => el.offsetWidth + 8);
                    // First try: do all items fit without an overflow button?
                    const totalAll = itemWidths.reduce((s, w) => s + w, 0);
                    if (totalAll <= available) { setVisibleCount(navItems.length); return; }
                    // Reserve space for overflow button and count how many fit
                    let used = overflowBtnW, count = 0;
                    for (let i = 0; i < navItems.length; i++) {
                        if (used + itemWidths[i] <= available) { used += itemWidths[i]; count = i + 1; } else break;
                    }
                    // If fewer than MIN_CORE fit, jump straight to hamburger
                    setVisibleCount(count < MIN_CORE ? -1 : count);
                };
                const ro = new ResizeObserver(recalculate);
                if (navContainerRef.current) ro.observe(navContainerRef.current);
                recalculate();
                return () => ro.disconnect();
            }, []);

            // Close overflow dropdown when clicking outside
            React.useEffect(() => {
                if (!overflowOpen) return;
                const close = () => setOverflowOpen(false);
                document.addEventListener('click', close);
                return () => document.removeEventListener('click', close);
            }, [overflowOpen]);

            const isHamburgerOnly = visibleCount === -1;
            const hasOverflow = visibleCount >= 0 && visibleCount < navItems.length;
            const overflowItems = hasOverflow ? navItems.slice(visibleCount) : [];

            return (
                <>
                    <header className="bg-white sticky top-0 z-50 transition-colors duration-300" style={{ borderBottom: '1px solid rgba(216,206,190,0.32)', boxShadow: '0px 1px 16.6px 0px rgba(199,165,110,0.03)' }}>
                        <div className="px-4 md:px-[80px]">
                            {/* Priority-plus nav: logo | flex-1 nav | actions */}
                            <div className="flex items-center gap-3 h-[66px]">

                                {/* ── LEFT: Logo ── */}
                                <button onClick={() => onNavigate('search')} className="flex items-center flex-shrink-0">
                                    <svg className="h-6" viewBox="0 0 159 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <g clipPath="url(#clip0_1945_142534)">
                                            <path d="M23.3936 5.86722H18.5605V18.138H23.3936C27.2348 18.138 29.899 15.7097 29.899 12.0115C29.899 8.31324 27.2348 5.86722 23.3936 5.86722ZM23.3936 15.8386H21.1704V8.16662H23.3936C25.9111 8.16662 27.2348 9.84148 27.2348 12.0115C27.2348 14.1815 25.8193 15.8386 23.3936 15.8386Z" fill="black" />
                                            <path d="M41.1526 9.82322C41.1526 7.54207 39.5904 5.86722 37.0364 5.86722H31.3027V18.1375H33.9121V13.7411H35.8228L38.2302 18.1375H41.2256L38.4691 13.4641C39.7918 13.1526 41.152 11.9932 41.152 9.82269L41.1526 9.82322ZM36.6503 11.496H33.9121V8.11079H36.6503C37.6974 8.11079 38.4879 8.77447 38.4879 9.80339C38.4879 10.8323 37.698 11.496 36.6503 11.496Z" fill="black" />
                                            <path d="M45.2744 5.86722H42.665V18.1375H45.2744V5.86722Z" fill="black" />
                                            <path d="M52.3144 15.3038L48.9152 5.86722H45.938L50.6792 18.1375H53.9502L58.6732 5.86722H55.696L52.3144 15.3038Z" fill="black" />
                                            <path d="M59.3594 18.1375H68.0331V15.8746H61.9687V13.0237H67.9048V10.7786H61.9687V8.11079H68.0331V5.86722H59.3594V18.1375Z" fill="black" />
                                            <path d="M77.9804 13.8147L72.3015 5.86722H69.6187V18.1375H72.228V9.89626L78.0717 18.1375H80.5887V5.86722H77.9804V13.8147Z" fill="black" />
                                            <path d="M1.43954 11.6494H0V18.1484H1.43954V11.6494Z" fill="black" />
                                            <path d="M3.96591 10.562H2.52637V17.0611H3.96591V10.562Z" fill="black" />
                                            <path d="M6.49228 11.6494H5.05273V18.1484H6.49228V11.6494Z" fill="black" />
                                            <path d="M0 10.562H1.43954V7.30832H10.8286V16.7079H7.57859V18.149H12.2687V5.86722H0V10.562Z" fill="black" />
                                            <path d="M104.985 21.3401C105.409 21.3401 105.833 21.5895 106.008 21.6896L106.058 21.1658C106.058 21.1658 105.609 21.0411 105.01 21.0411C104.412 21.0411 103.638 21.3656 103.613 22.4133C103.613 23.4615 104.212 23.9603 105.06 23.9603C105.683 23.9603 106.058 23.736 106.058 23.736V22.538H105.559V23.5862C105.559 23.5862 105.459 23.6363 105.285 23.6363C104.661 23.6363 104.212 23.1375 104.212 22.3387C104.212 21.7898 104.436 21.3406 104.985 21.3406V21.3401Z" fill="black" />
                                            <path d="M108.204 23.6108V21.0907H107.58V23.9353H109.277V23.5111C109.277 23.5111 108.903 23.6108 108.379 23.6108H108.204H108.204Z" fill="black" />
                                            <path d="M111.871 21.0411C111.172 21.0411 110.399 21.4402 110.399 22.5135C110.399 23.4866 110.998 23.9859 111.771 23.9859C112.47 23.9859 113.243 23.5868 113.243 22.5135C113.243 21.5404 112.644 21.0411 111.871 21.0411ZM111.896 23.6609C111.347 23.6609 111.022 23.0368 111.022 22.3382C111.022 21.7643 111.272 21.3651 111.721 21.3651C112.295 21.3651 112.619 21.9891 112.619 22.6878C112.619 23.2617 112.37 23.6609 111.895 23.6609H111.896Z" fill="black" />
                                            <path d="M116.112 22.3632C116.112 22.3632 116.636 22.1884 116.636 21.7147C116.636 21.0907 115.963 21.0661 115.439 21.0661C115.139 21.0661 114.666 21.1162 114.666 21.1162V23.9108C114.666 23.9108 115.14 23.9358 115.439 23.9358C116.112 23.9358 116.836 23.7861 116.836 23.0624C116.836 22.4634 116.112 22.3638 116.112 22.3638V22.3632ZM115.264 21.3901C115.264 21.3901 115.364 21.3651 115.513 21.3651C115.788 21.3651 116.062 21.4648 116.062 21.7893C116.062 22.1389 115.838 22.3131 115.488 22.3131C115.339 22.3131 115.264 22.2631 115.264 22.3131V21.3901ZM115.614 23.6609C115.414 23.6609 115.265 23.6108 115.265 23.6108V22.6126C115.29 22.5876 115.414 22.5876 115.489 22.5876H115.639C115.988 22.6126 116.188 22.837 116.188 23.1114C116.188 23.4109 115.988 23.6603 115.614 23.6603V23.6609Z" fill="black" />
                                            <path d="M118.957 21.0907L117.958 23.9103H118.433L118.707 23.0869H119.78L120.079 23.9103H120.703L119.655 21.0907H118.957ZM118.782 22.7874L119.207 21.5649L119.631 22.7874H118.782Z" fill="black" />
                                            <path d="M122.524 23.6108V21.0907H121.925V23.9353H123.597V23.5111C123.597 23.5111 123.223 23.6108 122.699 23.6108H122.524Z" fill="black" />
                                            <path d="M127.489 21.0656C127.164 21.0656 126.691 21.1157 126.691 21.1157L126.666 23.9353H127.265V22.8871C127.639 22.8871 128.836 22.9372 128.836 21.889C128.836 21.1402 128.137 21.0656 127.489 21.0656ZM127.614 22.5881C127.39 22.5881 127.29 22.538 127.29 22.538V21.3901C127.29 21.3901 127.389 21.3651 127.539 21.3651C127.938 21.3651 128.287 21.4397 128.287 21.9641C128.287 22.4133 128.013 22.5881 127.614 22.5881H127.614Z" fill="black" />
                                            <path d="M132.304 21.8394C132.304 21.2404 131.905 21.0656 131.032 21.0656C130.658 21.0656 130.158 21.1157 130.158 21.1157V23.9353H130.757V21.3901C130.757 21.3901 130.907 21.3401 131.082 21.3401C131.456 21.3401 131.73 21.4898 131.73 21.889C131.73 22.2135 131.555 22.4879 131.107 22.4879H131.007V22.7123L131.83 23.9348H132.529C132.205 23.5106 131.881 23.0864 131.531 22.6622C131.98 22.5625 132.304 22.2631 132.304 21.8389V21.8394Z" fill="black" />
                                            <path d="M135.098 21.0411C134.374 21.0411 133.601 21.4402 133.626 22.5135C133.626 23.4866 134.225 23.9859 134.998 23.9859C135.697 23.9859 136.47 23.5868 136.47 22.5135C136.47 21.5404 135.871 21.0411 135.098 21.0411ZM135.098 23.6609C134.549 23.6609 134.225 23.0368 134.225 22.3382C134.225 21.7643 134.474 21.3651 134.923 21.3651C135.497 21.3651 135.821 21.9891 135.821 22.6878C135.821 23.2617 135.572 23.6609 135.097 23.6609H135.098Z" fill="black" />
                                            <path d="M138.666 21.0656C138.342 21.0656 137.868 21.1157 137.868 21.1157L137.843 23.9353H138.442V22.8871C138.816 22.8871 140.013 22.9372 140.013 21.889C140.013 21.1402 139.315 21.0656 138.666 21.0656ZM138.791 22.5881C138.566 22.5881 138.466 22.538 138.466 22.538V21.3901C138.466 21.3901 138.566 21.3651 138.716 21.3651C139.115 21.3651 139.464 21.4397 139.464 21.9641C139.464 22.4133 139.19 22.5881 138.791 22.5881Z" fill="black" />
                                            <path d="M141.934 23.6358V22.6126H143.007V22.3131H141.934V21.4147H142.134C142.658 21.4147 143.032 21.5143 143.032 21.5143V21.0901H141.335V23.9598H143.107V23.5356C143.107 23.5356 142.733 23.6353 142.209 23.6353H141.934V23.6358Z" fill="black" />
                                            <path d="M146.649 21.8394C146.649 21.2404 146.25 21.0656 145.377 21.0656C145.003 21.0656 144.503 21.1157 144.503 21.1157V23.9353H145.102V21.3901C145.102 21.3901 145.252 21.3401 145.427 21.3401C145.801 21.3401 146.075 21.4898 146.075 21.889C146.075 22.2135 145.901 22.4879 145.452 22.4879H145.352V22.7123L146.176 23.9348H146.874C146.55 23.5106 146.226 23.0864 145.876 22.6622C146.325 22.5625 146.649 22.2631 146.649 21.8389V21.8394Z" fill="black" />
                                            <path d="M147.847 21.4402H148.745L148.77 23.9103H149.369V21.4402H150.267V21.0907H147.847V21.4402Z" fill="black" />
                                            <path d="M152.064 21.0907H151.465V23.9103H152.064V21.0907Z" fill="black" />
                                            <path d="M154.234 23.6358V22.6126H155.306V22.3131H154.234V21.4147H154.434C154.957 21.4147 155.332 21.5143 155.332 21.5143V21.0901H153.635V23.9598H155.406V23.5356C155.406 23.5356 155.032 23.6353 154.508 23.6353H154.234V23.6358Z" fill="black" />
                                            <path d="M158.026 22.2886C157.652 22.1639 157.303 22.0888 157.303 21.7147C157.303 21.4903 157.477 21.3901 157.727 21.3901C158.151 21.3901 158.525 21.6646 158.525 21.6646L158.55 21.1903C158.55 21.1903 158.251 21.0656 157.752 21.0656C157.153 21.0656 156.704 21.3401 156.704 21.889C156.704 22.3878 157.103 22.5625 157.528 22.7123C157.852 22.837 158.151 22.9367 158.151 23.2612C158.151 23.5607 157.951 23.6854 157.702 23.6854C157.178 23.6854 156.729 23.3113 156.729 23.3113C156.704 23.4861 156.679 23.6609 156.704 23.8101C156.704 23.8101 157.053 23.9849 157.652 23.9849C158.251 23.9849 158.75 23.785 158.75 23.0864C158.75 22.6121 158.4 22.4128 158.026 22.2881L158.026 22.2886Z" fill="black" />
                                            <path d="M146.6 13.8794C147.473 13.8794 148.222 13.7046 148.87 13.3555C149.544 13.031 150.068 12.6068 150.442 12.108L150.167 11.7835C149.544 12.2577 148.87 12.4821 148.047 12.4821C146.924 12.4821 146.076 12.1325 145.477 11.3593C144.854 10.6105 144.579 9.6625 144.654 8.44002H150.616C150.616 7.11735 150.292 6.01956 149.594 5.17118C148.895 4.34784 147.922 3.92365 146.675 3.92365C145.103 3.92365 143.93 4.42245 143.057 5.39606C142.184 6.36914 141.785 7.56711 141.785 8.98943C141.76 10.3867 142.234 11.5596 143.132 12.4826C144.055 13.4056 145.228 13.8799 146.599 13.8799L146.6 13.8794ZM145.203 5.49519C145.502 4.8216 145.901 4.49706 146.425 4.49706C147.249 4.49706 147.673 5.54528 147.673 7.69077L144.729 7.74085C144.754 6.91751 144.904 6.16879 145.203 5.49519Z" fill="black" />
                                            <path d="M155.656 12.5818C155.381 12.8813 154.982 13.031 154.484 13.031C153.261 13.031 152.338 12.1325 151.714 10.3611L151.24 10.5109L151.34 13.2804C152.338 13.6545 153.46 13.8794 154.683 13.8794C155.905 13.8794 156.928 13.6049 157.652 13.006C158.375 12.4571 158.724 11.6588 158.724 10.6356C158.724 9.962 158.55 9.41311 158.201 8.98892C157.851 8.56472 157.253 8.21514 156.429 7.86608C155.506 7.54155 154.858 7.21753 154.533 6.94309C154.209 6.66864 154.034 6.31906 154.034 5.91991C154.034 5.49572 154.134 5.17118 154.383 4.89674C154.633 4.62229 154.932 4.52263 155.331 4.52263C156.454 4.52263 157.252 5.32093 157.751 6.91804L158.226 6.7683L158.101 4.39793C157.353 4.0734 156.405 3.87408 155.257 3.87408C154.109 3.87408 153.161 4.17358 152.487 4.77256C151.789 5.37154 151.44 6.07018 151.44 6.94361C151.44 7.69234 151.664 8.26627 152.088 8.69047C152.512 9.11466 153.161 9.46424 154.034 9.76321C154.808 10.0377 155.356 10.3121 155.656 10.5615C155.93 10.836 156.105 11.1605 156.105 11.5596C156.105 11.9337 155.955 12.3084 155.656 12.5828V12.5818Z" fill="black" />
                                            <path d="M131.755 1.55277C131.855 1.7526 131.955 2.02705 132.005 2.45124C132.055 3.24954 132.104 5.09605 132.079 7.99079C132.079 10.8605 132.054 12.6569 132.005 13.3555C133.527 13.6801 134.724 13.8298 135.622 13.8298C137.294 13.8298 138.591 13.3555 139.539 12.3825C140.487 11.4344 140.986 10.1117 140.986 8.46507C140.986 7.16745 140.637 6.06966 139.913 5.22128C139.189 4.34785 138.266 3.9487 137.194 3.9487C136.445 3.97374 135.697 4.14853 134.848 4.54768C134.848 2.92552 134.873 1.42859 134.948 0.031311L130.707 0.829607V1.20371L131.131 1.2538C131.43 1.27884 131.63 1.40354 131.754 1.55329L131.755 1.55277ZM135.822 5.04649C136.495 5.04649 137.019 5.37102 137.418 6.06966C137.793 6.7683 138.017 7.59164 138.017 8.6649C138.017 9.96253 137.793 11.0353 137.344 11.9087C136.895 12.7821 136.346 13.2063 135.647 13.2063C135.398 13.1813 135.198 13.1562 134.923 13.1312C134.873 12.2327 134.824 9.56286 134.824 5.19623C135.073 5.12162 135.423 5.04649 135.822 5.04649Z" fill="black" />
                                            <path d="M110.798 13.056L110.05 12.9814C109.601 12.9313 109.301 12.732 109.102 12.4826C108.902 12.2082 108.803 11.7589 108.778 11.16C108.703 10.0371 108.628 8.76455 108.628 7.34223L110.125 7.36727C110.923 7.39232 111.472 8.01583 111.771 9.23883H112.32V4.74751H111.771C111.497 5.94547 110.973 6.54393 110.125 6.59402L108.628 6.61907C108.628 4.124 108.678 2.3521 108.778 1.25431H110.973C112.545 1.25431 113.593 2.25244 114.191 4.2487L114.865 4.04887L114.765 0.330795H103.638V0.879689L104.237 0.929778C104.686 1.00491 104.985 1.17918 105.185 1.42858C105.385 1.70303 105.485 2.15227 105.51 2.75125C105.734 5.74564 105.734 8.56524 105.51 11.1605C105.46 11.7845 105.335 12.2087 105.185 12.4831C104.985 12.7576 104.686 12.9324 104.237 12.982L103.638 13.0566V13.6055H110.798V13.0566V13.056Z" fill="black" />
                                            <path d="M129.061 13.1061L128.312 13.0561C127.788 13.006 127.489 12.5818 127.414 11.8336C127.239 10.2114 127.214 8.49012 127.364 6.71822C127.539 6.44377 127.888 6.26898 128.437 6.21941C128.986 6.16984 129.634 6.31907 130.308 6.71822L131.356 4.12297C130.982 3.92314 130.557 3.84853 130.083 3.84853C129.609 3.84853 129.135 4.04836 128.611 4.44751C128.087 4.82161 127.688 5.37051 127.389 6.09419L127.414 3.87357L123.172 4.69691V5.07101L123.597 5.09606C124.12 5.14615 124.42 5.57034 124.495 6.31855C124.669 8.04036 124.669 9.88688 124.495 11.833C124.444 12.5818 124.145 12.9809 123.597 13.0555L123.172 13.1056V13.6295H129.06V13.1056L129.061 13.1061Z" fill="black" />
                                            <path d="M113.443 8.88873C113.443 10.3361 113.867 11.5335 114.665 12.4821C115.464 13.4301 116.661 13.8794 118.183 13.8794C119.705 13.8794 120.902 13.4051 121.8 12.432C122.698 11.484 123.098 10.286 123.098 8.83864C123.098 7.39128 122.673 6.19383 121.875 5.24527C121.077 4.29671 119.879 3.84799 118.357 3.84799C116.835 3.84799 115.638 4.32227 114.74 5.29536C113.867 6.2434 113.443 7.44137 113.443 8.88873ZM118.233 4.49706C118.832 4.47202 119.306 4.89621 119.655 5.71955C119.98 6.51785 120.13 7.59111 120.13 8.86369C120.13 11.808 119.506 13.2554 118.333 13.2554C117.71 13.2554 117.261 12.8312 116.911 12.0078C116.586 11.1845 116.437 10.1112 116.437 8.86369C116.437 5.94443 117.061 4.49706 118.234 4.49706H118.233Z" fill="black" />
                                            <path d="M103.638 18.0963H158.7V15.8756L103.638 17.7222V18.0963Z" fill="black" />
                                            <path d="M92.3476 0H91.9302V24H92.3476V0Z" fill="black" />
                                        </g>
                                        <defs>
                                            <clipPath id="clip0_1945_142534">
                                                <rect width="158.75" height="24" fill="white" />
                                            </clipPath>
                                        </defs>
                                    </svg>
                                </button>

                                {/* ── CENTRE: Priority-plus nav — takes all space between logo and actions ── */}
                                <nav ref={navContainerRef} className="hidden lg:flex items-center justify-center flex-1 min-w-0 overflow-hidden">
                                    {/* Visible items */}
                                    {!isHamburgerOnly && navItems.slice(0, visibleCount).map(item => (
                                        <button
                                            key={item.label}
                                            className="px-[12px] py-[8px] text-[14px] text-[#3a3a3a] hover:bg-gray-50 rounded-lg transition-colors flex items-center gap-1 whitespace-nowrap font-medium flex-shrink-0"
                                        >
                                            {item.label}
                                            {item.hasDropdown && <svg className="w-3 h-3 text-warm-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" /></svg>}
                                        </button>
                                    ))}

                                    {/* ⋯ More — appears when some items overflow */}
                                    {hasOverflow && (
                                        <div className="relative flex-shrink-0">
                                            <button
                                                onClick={(e) => { e.stopPropagation(); setOverflowOpen(o => !o); }}
                                                className="px-[12px] py-[8px] text-[14px] text-[#3a3a3a] hover:bg-gray-50 rounded-lg transition-colors flex items-center gap-1 whitespace-nowrap font-medium"
                                            >
                                                More
                                                <svg className="w-3 h-3 text-warm-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" /></svg>
                                            </button>
                                            {overflowOpen && (
                                                <div className="absolute top-full left-0 mt-1 bg-white rounded-xl shadow-lg border border-warm-100 py-1.5 z-50 min-w-[160px]">
                                                    {overflowItems.map(item => (
                                                        <button key={item.label} className="w-full text-left px-4 py-2.5 text-[14px] text-[#3a3a3a] hover:bg-gray-50 font-medium flex items-center justify-between gap-3">
                                                            {item.label}
                                                            {item.hasDropdown && <svg className="w-3.5 h-3.5 text-warm-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" /></svg>}
                                                        </button>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                    )}

                                    {/* Hamburger — only when ALL items are too wide for the nav */}
                                    {isHamburgerOnly && (
                                        <button onClick={() => setIsMobileMenuOpen(true)} className="p-2 text-warm-800 hover:bg-gray-50 rounded-lg transition-colors">
                                            <svg className="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" /></svg>
                                        </button>
                                    )}
                                </nav>

                                {/* Hidden measurement container — renders all items + overflow btn off-screen to measure widths */}
                                <div
                                    ref={measureRef}
                                    className="fixed flex items-center"
                                    style={{ top: '-9999px', left: '-9999px', visibility: 'hidden', pointerEvents: 'none' }}
                                    aria-hidden="true"
                                >
                                    {navItems.map(item => (
                                        <button key={item.label} className="px-[12px] py-[8px] text-[14px] font-medium flex items-center gap-1 whitespace-nowrap flex-shrink-0">
                                            {item.label}
                                            {item.hasDropdown && <svg className="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" /></svg>}
                                        </button>
                                    ))}
                                    {/* Overflow button — measured last so we know how much space it needs */}
                                    <button className="px-[12px] py-[8px] text-[14px] font-medium flex items-center gap-1 whitespace-nowrap flex-shrink-0">
                                        More <svg className="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" /></svg>
                                    </button>
                                </div>

                                {/* ── RIGHT: Instant Valuation + Sign In + Mobile hamburger ── */}
                                <div className="flex items-center gap-2 md:gap-[8px] flex-shrink-0 ml-auto">

                                    {/* Instant Valuation — outline style */}
                                    <button className="hidden md:block px-[12px] py-[4px] border border-black text-black rounded-[16px] text-[14px] font-bold hover:bg-gray-50 transition-colors whitespace-nowrap">
                                        Instant Valuation
                                    </button>

                                    {/* Sign In / Avatar */}
                                    {user ? (
                                        <button onClick={onDashboard} className="flex items-center gap-2 p-1 hover:bg-cream-100 rounded-full transition-all">
                                            <div className="w-8 h-8 rounded-full bg-accent-gold flex items-center justify-center text-white font-bold text-sm">
                                                {user.name.charAt(0)}
                                            </div>
                                        </button>
                                    ) : (
                                        <button className="px-[16px] py-[8px] rounded-[20px] text-[14px] font-bold text-black hover:bg-gray-50 transition-colors whitespace-nowrap" style={{ boxShadow: '0px 1px 4px 0px rgba(233,233,233,0.25)' }}>
                                            Sign In
                                        </button>
                                    )}

                                    {/* Hamburger Menu (Mobile) */}
                                    <button
                                        onClick={() => setIsMobileMenuOpen(true)}
                                        className="lg:hidden p-2 -mr-2 text-warm-800 hover:text-warm-900 transition-colors"
                                    >
                                        <svg className="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" />
                                        </svg>
                                    </button>
                                </div>

                            </div>
                        </div>
                    </header>

                    {/* Mobile Bottom Drawer Overlay */}
                    {isMobileMenuOpen && (
                        <div className={`fixed inset-0 z-[100]${isHamburgerOnly ? '' : ' lg:hidden'}`}>
                            {/* Backdrop */}
                            <div
                                className="absolute inset-0 bg-black/50 backdrop-blur-sm transition-opacity"
                                onClick={() => setIsMobileMenuOpen(false)}
                            />

                            {/* Drawer */}
                            <div className="absolute bottom-0 left-0 right-0 bg-white rounded-t-3xl shadow-[-18px_-20px_40px_rgba(0,0,0,0.08)] transform transition-transform duration-300 translate-y-0">
                                <div className="p-6 pb-12 flex flex-col gap-4 max-h-[85vh] overflow-y-auto overscroll-contain">
                                    <div className="w-12 h-1.5 bg-warm-200 rounded-full mx-auto mb-4" />

                                    <div className="flex flex-col gap-2">
                                        {navItems.map(item => (
                                            <button
                                                key={item.label}
                                                className="w-full text-left px-4 py-3 text-[16px] text-warm-800 active:bg-warm-50 rounded-xl transition-colors flex items-center justify-between font-medium border border-transparent active:border-warm-200"
                                            >
                                                {item.label}
                                                {item.hasDropdown && (
                                                    <svg className="w-4 h-4 text-warm-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
                                                    </svg>
                                                )}
                                            </button>
                                        ))}
                                    </div>

                                    <div className="h-px bg-warm-100 my-2" />

                                    <button className="w-full px-4 py-4 text-center bg-transparent border-2 border-warm-800 text-warm-800 rounded-xl text-[16px] font-bold active:bg-warm-50 transition-colors">
                                        Instant Valuation
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </>
            );
        };

        // Compact number formatter: 1850000 → "1.85M", 2150 → "2.15K"
        const formatCompactNum = (num) => {
            if (num >= 1000000) {
                const m = num / 1000000;
                return m % 1 === 0 ? `${m}M` : `${parseFloat(m.toFixed(2))}M`;
            }
            if (num >= 1000) {
                const k = num / 1000;
                return k % 1 === 0 ? `${k}K` : `${parseFloat(k.toFixed(2))}K`;
            }
            return num.toString();
        };

        // Diverse gallery image pool — interiors, amenities, views, exteriors
        const galleryImagePool = [
            // Interiors
            'https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?w=600&h=400&fit=crop',  // modern living room
            'https://images.unsplash.com/photo-1600566753190-17f0baa2a6c3?w=600&h=400&fit=crop',  // luxury kitchen
            'https://images.unsplash.com/photo-1600585154526-990dced4db0d?w=600&h=400&fit=crop',  // bedroom
            'https://images.unsplash.com/photo-1600573472591-ee6b68d14c68?w=600&h=400&fit=crop',  // modern bathroom
            'https://images.unsplash.com/photo-1616137466211-f939a16be3a7?w=600&h=400&fit=crop',  // open-plan kitchen
            'https://images.unsplash.com/photo-1618221195710-dd6b41faaea6?w=600&h=400&fit=crop',  // cozy living room
            'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=600&h=400&fit=crop',     // bright living room
            'https://images.unsplash.com/photo-1616486338812-3dadae4b4ace?w=600&h=400&fit=crop',   // white kitchen island
            // Pools & Amenities
            'https://images.unsplash.com/photo-1615571022219-eb45cf7faa36?w=600&h=400&fit=crop',   // infinity pool
            'https://images.unsplash.com/photo-1582719478250-c89cae4dc85b?w=600&h=400&fit=crop',   // resort pool
            'https://images.unsplash.com/photo-1571896349842-33c89424de2d?w=600&h=400&fit=crop',   // hotel lobby
            'https://images.unsplash.com/photo-1584622650111-993a426fbf0a?w=600&h=400&fit=crop',   // gym / fitness
            // Exteriors & Architecture
            'https://images.unsplash.com/photo-1580587771525-78b9dba3b914?w=600&h=400&fit=crop',   // luxury villa front
            'https://images.unsplash.com/photo-1613490493576-7fde63acd811?w=600&h=400&fit=crop',   // modern white villa
            'https://images.unsplash.com/photo-1564013799919-ab600027ffc6?w=600&h=400&fit=crop',   // contemporary house + pool
            'https://images.unsplash.com/photo-1600047509807-ba8f99d2cdde?w=600&h=400&fit=crop',   // tropical villa
            // Views & Aerial
            'https://images.unsplash.com/photo-1582268611958-ebfd161ef9cf?w=600&h=400&fit=crop',   // waterfront skyline
            'https://images.unsplash.com/photo-1600047509782-20d39509f26d?w=600&h=400&fit=crop',   // garden patio
            'https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=600&h=400&fit=crop',   // villa with garden
            'https://images.unsplash.com/photo-1600585154340-be6161a56a0c?w=600&h=400&fit=crop',   // modern home exterior
        ];

        // PropertyCard Component (Driven Style)

        const PropertyCard = ({ project, onSelect, inWatchlist, onToggleWatchlist, isHovered, isInvestorMode, onAddToCompare, inCompareList }) => {
            const [showCompareIcon, setShowCompareIcon] = React.useState(false);
            const [currentImageIndex, setCurrentImageIndex] = React.useState(0);

            // Build unique gallery per project: hero image + 4 different shots from pool
            const images = project.images || (() => {
                const poolSize = galleryImagePool.length;
                const offset = ((project.id - 1) * 4) % poolSize;
                const picks = [];
                for (let i = 0; i < 4; i++) {
                    const img = galleryImagePool[(offset + i) % poolSize];
                    // skip if it's the same as the hero image
                    if (img !== project.image) picks.push(img);
                }
                return [project.image, ...picks.slice(0, 4)];
            })();

            const nextImage = (e) => {
                e.stopPropagation();
                setCurrentImageIndex((prev) => (prev + 1) % images.length);
            };

            const prevImage = (e) => {
                e.stopPropagation();
                setCurrentImageIndex((prev) => (prev - 1 + images.length) % images.length);
            };

            React.useEffect(() => {
                if (!showCompareIcon) return;
                const interval = setInterval(() => {
                    setCurrentImageIndex((prev) => (prev + 1) % images.length);
                }, 4000);
                return () => clearInterval(interval);
            }, [showCompareIcon, images.length]);

            const isOffPlan = !!project.handover;
            const cardHovered = showCompareIcon;

            return (
                <div className="property-card-wrap h-full group">
                    <div
                        className="property-card-wrap-inner rounded-[32px] border p-[12px] transition-all duration-300 cursor-pointer h-full bg-[#FFFFFF] md:group-hover:bg-[#F1EBE1] border-[#ebebe2] md:group-hover:border-[#887860] shadow-none md:group-hover:shadow-[-18px_51px_15px_rgba(217,217,217,0.01),-11px_33px_14px_rgba(217,217,217,0.1),-6px_18px_12px_rgba(217,217,217,0.33),-3px_8px_9px_rgba(217,217,217,0.56),-1px_2px_5px_rgba(217,217,217,0.64)]"
                        onClick={() => onSelect && onSelect(project)}
                        onMouseEnter={() => setShowCompareIcon(true)}
                        onMouseLeave={() => setShowCompareIcon(false)}
                    >
                        <div className="property-card-inner flex flex-col gap-[12px] h-full">
                            {/* Image */}
                            <div className="card-image-area relative h-[220px] rounded-[16px] overflow-hidden group">
                                <img
                                    src={images[currentImageIndex]}
                                    alt={project.name}
                                    className="w-full h-full object-cover"
                                />
                                {/* Inner border overlay */}
                                <div className="absolute inset-0 rounded-[16px] pointer-events-none transition-colors duration-300 border-[#f8f7f4] md:group-hover:border-[#E1C8A4]" style={{ borderWidth: '1px' }} />

                                {/* 3D / Video badges — bottom left */}
                                <div className="absolute bottom-[8px] left-[8px] flex gap-[8px]">
                                    {project.has3DTour && (
                                        <span className="flex items-center gap-[8px] px-[8px] py-[4px] rounded-[8px] text-[#fbfbfb] text-[12px]" style={{ background: 'rgba(75,75,75,0.51)', border: '1px solid rgba(88,88,88,0.33)' }}>
                                            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 7.5l-9-5.25L3 7.5m18 0l-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9" /></svg>
                                            3D
                                        </span>
                                    )}
                                    {project.hasVideo && (
                                        <span className="flex items-center gap-[8px] px-[8px] py-[4px] rounded-[8px] text-[#fbfbfb] text-[12px]" style={{ background: 'rgba(75,75,75,0.51)', border: '1px solid rgba(88,88,88,0.33)' }}>
                                            <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><polygon points="5,3 19,12 5,21" /></svg>
                                            Video
                                        </span>
                                    )}
                                </div>

                                {/* Watchlist heart — Airbnb style */}
                                <button
                                    onClick={(e) => { e.stopPropagation(); onToggleWatchlist && onToggleWatchlist(project.id); }}
                                    className="absolute top-[8px] right-[8px] w-[32px] h-[32px] flex items-center justify-center transition-transform duration-200 hover:scale-110"
                                    style={{ background: 'transparent', border: 'none' }}
                                >
                                    {inWatchlist
                                        ? <svg className="w-6 h-6" viewBox="0 0 24 24" fill="none" style={{ filter: 'drop-shadow(0px 1px 2px rgba(0,0,0,0.3))' }}><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" fill="#FF385C" stroke="white" strokeWidth="1.5" /></svg>
                                        : <svg className="w-6 h-6" viewBox="0 0 24 24" fill="none" style={{ filter: 'drop-shadow(0px 1px 2px rgba(0,0,0,0.3))' }}><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" fill="rgba(0,0,0,0.5)" stroke="white" strokeWidth="1.5" /></svg>}
                                </button>

                                {/* Add to Compare — always visible on mobile, hover-only on desktop */}
                                {onAddToCompare && (
                                    <button
                                        onClick={(e) => { e.stopPropagation(); onAddToCompare(project); }}
                                        className={`absolute top-[8px] left-[8px] w-[32px] h-[32px] flex items-center justify-center rounded-full transition-all duration-200 hover:scale-110 z-10 opacity-100 md:opacity-0 md:group-hover:opacity-100 ${inCompareList ? 'bg-[#d4a574] text-white' : 'bg-white/90 hover:bg-white text-[#7c7c78]'}`}
                                        style={{ boxShadow: '0 1px 4px rgba(0,0,0,0.18)' }}
                                        title={inCompareList ? "Remove from comparison" : "Add to compare"}
                                    >
                                        {inCompareList ? (
                                            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2.5"><path strokeLinecap="round" strokeLinejoin="round" d="M5 13l4 4L19 7" /></svg>
                                        ) : (
                                            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path strokeLinecap="round" strokeLinejoin="round" d="M12 4v16m8-8H4" /></svg>
                                        )}
                                    </button>
                                )}

                                {/* Navigation arrows — visible on hover (desktop), always (mobile) */}
                                {images.length > 1 && (
                                    <div className="absolute inset-0 flex items-center justify-between px-[9px] pointer-events-none transition-opacity duration-300 opacity-100 md:opacity-0 md:group-hover:opacity-100">
                                        <button onClick={prevImage} className="pointer-events-auto rounded-[20px] w-[32px] h-[32px] flex items-center justify-center hover:bg-[rgba(111,110,110,0.6)] transition-colors" style={{ background: 'rgba(111,110,110,0.43)', border: '0.476px solid #b1b1ab' }}>
                                            <svg width="19" height="19" viewBox="0 0 19 19" fill="none"><path d="M12 4L7 9.5L12 15" stroke="white" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" /></svg>
                                        </button>
                                        <button onClick={nextImage} className="pointer-events-auto rounded-[20px] w-[32px] h-[32px] flex items-center justify-center hover:bg-[rgba(111,110,110,0.6)] transition-colors" style={{ background: 'rgba(111,110,110,0.43)', border: '0.476px solid #b1b1ab' }}>
                                            <svg width="19" height="19" viewBox="0 0 19 19" fill="none"><path d="M7 4L12 9.5L7 15" stroke="white" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" /></svg>
                                        </button>
                                    </div>
                                )}

                                {/* Image dots */}
                                {images.length > 1 && (
                                    <div className="absolute bottom-[8px] right-[8px] flex gap-1">
                                        {images.map((_, idx) => (
                                            <button key={idx} onClick={(e) => { e.stopPropagation(); setCurrentImageIndex(idx); }}
                                                className={`rounded-full transition-all ${idx === currentImageIndex ? 'bg-white w-4 h-1.5' : 'bg-white/50 w-1.5 h-1.5'}`} />
                                        ))}
                                    </div>
                                )}
                            </div>

                            {/* Details Container */}
                            <div className="card-content-area px-[8px] flex flex-col gap-[8px] flex-1">
                                {/* Title + Specs */}
                                <div className="px-[12px] flex flex-col gap-[16px]">
                                    <p className="font-bold text-[#1c1c1a] text-[16px] leading-[20px] line-clamp-2" style={{ display: '-webkit-box', WebkitLineClamp: 2, WebkitBoxOrient: 'vertical', overflow: 'hidden' }}>
                                        {project.name}
                                    </p>

                                    {/* Specs row */}
                                    {isOffPlan ? (
                                        <div className="flex items-center flex-wrap gap-x-3 gap-y-1 text-[#7c7c78] text-[13px]">
                                            <span className="flex items-center gap-[10px]">
                                                <svg className="w-[20px] h-[20px] transition-colors duration-300 text-[#B1B1AB] md:group-hover:text-[#A49075]" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.5"><path d="M15.5 2.5v4m-7-4v4m-4.5 3h16m-16-3a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2h-12a2 2 0 01-2-2v-12z" /></svg>
                                                <span className="font-bold text-[#1c1c1a] text-[16px] leading-[20px]">{project.handover}</span>
                                            </span>
                                            <div className="h-[20px] w-px rounded-[8px] transition-colors duration-300 bg-[#f8f7f4] md:group-hover:bg-[#E1C8A4]" />
                                            <span className="flex items-center gap-[10px]">
                                                <svg className="w-[20px] h-[20px] transition-colors duration-300 text-[#B1B1AB] md:group-hover:text-[#A49075]" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.5"><path d="M7.5 21L3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5" /></svg>
                                                <span className="font-bold text-[#1c1c1a] text-[16px] leading-[20px]">{project.paymentPlan}</span>
                                            </span>
                                            <div className="h-[20px] w-px rounded-[8px] transition-colors duration-300 bg-[#f8f7f4] md:group-hover:bg-[#E1C8A4]" />
                                            <span className="flex items-center gap-[10px]">
                                                <svg className="w-[20px] h-[20px] transition-colors duration-300 text-[#B1B1AB] md:group-hover:text-[#A49075]" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.5"><path d="M17.982 18.725A7.488 7.488 0 0012 15.75a7.488 7.488 0 00-5.982 2.975m11.963 0a9 9 0 10-11.963 0m11.963 0A8.966 8.966 0 0112 21a8.966 8.966 0 01-5.982-2.275M15 9.75a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                                                <span className="font-bold text-[#1c1c1a] text-[16px] leading-[20px]">{project.progress}%</span>
                                            </span>
                                        </div>
                                    ) : (
                                        <div className="flex gap-[8px] items-center">
                                            <div className="flex gap-[10px] items-center min-w-[60px]">
                                                <Icon name="bed" className="w-[20px] h-[20px] transition-colors duration-300 text-[#B1B1AB] md:group-hover:text-[#A49075]" style={{ opacity: 0.72 }} />
                                                <span className="font-bold text-[#1c1c1a] text-[16px] leading-[20px]">{project.beds}</span>
                                            </div>
                                            <div className="h-[20px] w-px rounded-[8px] transition-colors duration-300 bg-[#f8f7f4] md:group-hover:bg-[#E1C8A4]" />
                                            <div className="flex gap-[10px] items-center min-w-[60px]">
                                                <Icon name="bath" className="w-[20px] h-[20px] transition-colors duration-300 text-[#B1B1AB] md:group-hover:text-[#A49075]" style={{ opacity: 0.72 }} />
                                                <span className="font-bold text-[#1c1c1a] text-[16px] leading-[20px]">{project.baths}</span>
                                            </div>
                                            <div className="h-[20px] w-px rounded-[8px] transition-colors duration-300 bg-[#f8f7f4] md:group-hover:bg-[#E1C8A4]" />
                                            <div className="flex gap-[10px] items-center min-w-[60px]">
                                                <Icon name="area" className="w-[20px] h-[20px] transition-colors duration-300 text-[#B1B1AB] md:group-hover:text-[#A49075]" style={{ opacity: 0.72 }} />
                                                <span className="font-bold text-[#1c1c1a] text-[16px] leading-[20px]">{project.sqft} ft²</span>
                                            </div>
                                        </div>
                                    )}
                                </div>

                                {/* Location Container */}
                                <div className="rounded-[6px] px-[12px] py-[8px] transition-all duration-300 bg-[#f8f7f4] md:group-hover:bg-[#FFFBF6]" style={{
                                    borderTop: '1px solid #ebebe2',
                                    borderBottom: '1px solid #ebebe2',
                                    borderTopColor: 'inherit', // Let Tailwind handle it
                                    borderBottomColor: 'inherit',
                                }}>
                                    <div className="flex gap-[10px] items-center">
                                        <Icon name="mapPin" className="w-[20px] h-[20px] flex-shrink-0" style={{ color: '#7c7c78', opacity: 0.72 }} />
                                        <div className="flex-1 flex flex-col gap-[4px]">
                                            <p className="font-bold text-[#7c7c78] text-[16px] leading-[20px]">{project.developer}</p>
                                            <p className="font-bold text-[#7c7c78] text-[16px] leading-[20px]">{project.location}, Dubai</p>
                                        </div>
                                    </div>
                                </div>

                                {/* Price Container — shows compact numbers when card is narrow */}
                                <div className="rounded-[6px] px-[16px] py-[8px] flex items-end justify-between gap-[8px] transition-colors duration-300 mt-auto bg-[#f8f7f4] md:group-hover:bg-[#FFFBF6]">
                                    <div className="px-[8px] py-[8px] rounded-[14px] flex gap-[4px] items-center flex-shrink-0 transition-colors duration-300 bg-[#ebebe2] md:group-hover:bg-[rgba(225,200,164,0.34)]">
                                        <Dhs className="text-[13px]" />
                                        <span className="price-full font-semibold text-[#1c1c1a] text-[14px] leading-[24px]">{project.pricePerSqft} emi*</span>
                                        <span className="price-compact font-semibold text-[#1c1c1a] text-[14px] leading-[24px]">{formatCompactNum(parseInt(project.pricePerSqft.replace(/,/g, '')))} emi*</span>
                                    </div>
                                    <div className="flex gap-[4px] items-baseline flex-shrink-0">
                                        <Dhs className="text-[15px] text-[#7c7c78]" />
                                        <span className="price-full font-[800] text-[#1c1c1a] text-[20px] leading-[24px]">{project.price ? project.price.replace('د.إ', '') : project.price}</span>
                                        <span className="price-compact font-[800] text-[#1c1c1a] text-[20px] leading-[24px]">{formatCompactNum(project.priceNum)}</span>
                                    </div>
                                </div>

                                {/* Agent Container */}
                                <div className="pt-[8px] flex items-center justify-between transition-colors duration-300 border-t-[#f8f7f4] md:group-hover:border-t-[#E1C8A4]" style={{ borderTopWidth: '1px' }}>
                                    {project.agent && (
                                        <div className="flex gap-[8px] items-center flex-1">
                                            <img
                                                src={project.agent.image}
                                                alt={project.agent.name}
                                                className="w-[40px] h-[40px] rounded-full object-cover transition-all duration-300 border-[1.6px] border-transparent md:group-hover:border-[#E1C8A4]"
                                            />
                                            <div className="flex flex-col gap-[6px]">
                                                <p className="text-[#7c7c78] text-[14px] leading-[18px]">Listed By</p>
                                                <p className="font-bold text-[#1c1c1a] text-[14px] overflow-hidden text-ellipsis whitespace-nowrap">{project.agent.name}</p>
                                            </div>
                                        </div>
                                    )}

                                    {/* Contact Icons */}
                                    <div className="flex gap-[11px] items-center">
                                        <button onClick={(e) => e.stopPropagation()}
                                            className="w-[46px] h-[46px] rounded-[13px] flex items-center justify-center hover:scale-105 transition-transform bg-gray-100 text-[#7c7c78]">
                                            <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" /></svg>
                                        </button>
                                        <div className="h-[41px] w-px transition-colors duration-300 bg-[#f8f7f4] md:group-hover:bg-[#E1C8A4]" />
                                        <button onClick={(e) => e.stopPropagation()}
                                            className="w-[46px] h-[46px] rounded-[13px] flex items-center justify-center hover:scale-105 transition-transform bg-[#25D366]">
                                            <svg className="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347z" /><path d="M11.999 0C5.373 0 0 5.373 0 12c0 2.118.554 4.107 1.523 5.834L.044 23.956l6.26-1.458A11.952 11.952 0 0012 24c6.627 0 12-5.373 12-12S18.626 0 11.999 0zm.001 21.818a9.793 9.793 0 01-4.988-1.362l-.357-.212-3.716.866.897-3.622-.232-.371A9.79 9.79 0 012.182 12c0-5.414 4.404-9.818 9.818-9.818 5.415 0 9.818 4.404 9.818 9.818 0 5.415-4.403 9.818-9.818 9.818z" /></svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Dubai location coordinates mapping
        const dubaiCoordinates = {
            "Dubai Harbour": [25.0800, 55.1350],
            "Palm Jumeirah": [25.1124, 55.1390],
            "Sobha Hartland": [25.1735, 55.3170],
            "MBR City": [25.1680, 55.3100],
            "DAMAC Lagoons": [25.0450, 55.2800],
            "Dubailand": [25.0500, 55.2900],
            "Dubai Creek Harbour": [25.1980, 55.3450],
            "Creek Harbour": [25.1980, 55.3450],
            "Dubai Marina": [25.0780, 55.1400],
            "Marina": [25.0780, 55.1400],
            "Downtown Dubai": [25.1972, 55.2744],
            "Downtown": [25.1972, 55.2744],
            "Arabian Ranches": [25.0580, 55.2620],
            "Business Bay": [25.1860, 55.2680],
            "JBR": [25.0770, 55.1330],
            "Jumeirah Beach": [25.0770, 55.1330],
            "Dubai Sports City": [25.0400, 55.2240],
            "Sports City": [25.0400, 55.2240],
            "Silicon Oasis": [25.1180, 55.3880],
            "Al Barsha": [25.1130, 55.2000],
            "JVC": [25.0650, 55.2120],
            "City Walk": [25.2100, 55.2650],
            "Al Wasl": [25.2100, 55.2650],
            "Discovery Gardens": [25.0370, 55.1400],
            "Motor City": [25.0490, 55.2370],
            "International City": [25.1650, 55.4100],
            "Green Community": [25.0070, 55.1850],
            "DIP": [25.0070, 55.1850],
            "Mirdif": [25.2270, 55.4210],
            "The Hills": [25.0990, 55.1720],
            "Emirates Hills": [25.0990, 55.1720],
            "Al Furjan": [25.0290, 55.1500],
            "Bluewaters Island": [25.0810, 55.1250],
            "Bluewaters": [25.0810, 55.1250],
            "Dubai South": [24.9200, 55.1600],
            "Town Square": [25.0250, 55.2700],
            "Expo City": [24.9680, 55.1550],
            "Queue Point": [25.0600, 55.3200],
            "Liwan": [25.0600, 55.3200],
            "Dubai Hills Estate": [25.1350, 55.2450],
            "Dubai Hills": [25.1350, 55.2450],
            "Arjan": [25.0620, 55.2430],
            "Remraam": [25.0420, 55.2600],
            "Wasl District": [25.2050, 55.3380],
            "Al Jaddaf": [25.2050, 55.3380],
            "The Springs": [25.0900, 55.2100],
            "Akoya Oxygen": [25.0200, 55.3000],
            "Akoya": [25.0200, 55.3000],
            "Culture Village": [25.2000, 55.3400],
            "Mudon": [25.0350, 55.2780],
            "Jumeirah Park": [25.0830, 55.1600],
            "District One": [25.1650, 55.3050],
            "Villanova": [25.0400, 55.2850],
            "Dubai Wharf": [25.2020, 55.3500],
            "The Valley": [25.0300, 55.3100],
            "Tilal Al Ghaf": [25.0700, 55.2350],
            "Reem": [25.0630, 55.2580],
            "Dubai Land": [25.0500, 55.2900],
        };

        // Get coordinates for a project
        const getProjectCoords = (project) => {
            return dubaiCoordinates[project.location] || dubaiCoordinates[project.area] || [25.2048, 55.2708];
        };

        // Map View with Leaflet - Airbnb Style
        const MapView = ({ projects, onSelectProject, hoveredProject, onHoverProject }) => {
            const mapRef = useRef(null);
            const mapInstanceRef = useRef(null);
            const markersRef = useRef({});
            const [selectedId, setSelectedId] = useState(null);
            const [searchAsMove, setSearchAsMove] = useState(true);

            // Initialize map
            useEffect(() => {
                if (mapInstanceRef.current) return;

                // Calculate bounds upfront so we can set a good initial view
                const allCoords = projects.map(p => getProjectCoords(p));
                const bounds = L.latLngBounds(allCoords);
                const center = bounds.getCenter();

                const map = L.map(mapRef.current, {
                    center: center,
                    zoom: 12,
                    zoomControl: false,
                    attributionControl: false,
                    minZoom: 10,
                    maxZoom: 18
                });

                // Airbnb-style light map tiles (CartoDB Voyager)
                L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
                    maxZoom: 19,
                    subdomains: 'abcd'
                }).addTo(map);

                // Add zoom control to top-right
                L.control.zoom({ position: 'topright' }).addTo(map);

                // Add attribution
                L.control.attribution({ position: 'bottomright', prefix: false })
                    .addAttribution('&copy; <a href="https://carto.com/">CARTO</a> &copy; <a href="https://www.openstreetmap.org/copyright">OSM</a>')
                    .addTo(map);

                mapInstanceRef.current = map;

                // Leaflet needs the container to be fully rendered before it can
                // calculate bounds properly. Use invalidateSize + fitBounds with
                // increasing delays to handle flex/sticky layout settling.
                const fitMap = () => {
                    map.invalidateSize();
                    map.fitBounds(bounds, { padding: [50, 50], maxZoom: 13 });
                };
                setTimeout(fitMap, 50);
                setTimeout(fitMap, 300);
                setTimeout(fitMap, 800);

                // Also listen for resize so split-panel drag works
                const onResize = () => {
                    map.invalidateSize();
                };
                window.addEventListener('resize', onResize);

                return () => {
                    window.removeEventListener('resize', onResize);
                    map.remove();
                    mapInstanceRef.current = null;
                };
            }, []);

            // Add/update markers
            useEffect(() => {
                const map = mapInstanceRef.current;
                if (!map) return;

                // Clear existing markers
                Object.values(markersRef.current).forEach(m => m.remove());
                markersRef.current = {};

                projects.forEach(project => {
                    const coords = getProjectCoords(project);
                    const priceLabel = project.price.replace('د.إ', 'AED ');
                    const isHovered = hoveredProject?.id === project.id;
                    const isSelected = selectedId === project.id;

                    const markerHtml = document.createElement('div');
                    markerHtml.className = `airbnb-marker${project.trending ? ' trending' : ''}${isHovered ? ' hovered' : ''}${isSelected ? ' selected' : ''}`;
                    markerHtml.textContent = priceLabel;

                    const icon = L.divIcon({
                        html: markerHtml.outerHTML,
                        className: '',
                        iconSize: null,
                        iconAnchor: [50, 15]
                    });

                    const marker = L.marker(coords, { icon }).addTo(map);

                    // Popup content
                    const popupContent = `
                        <div class="map-popup-card">
                            <div style="position:relative;overflow:hidden;">
                                <img class="popup-image" src="${project.image}" alt="${project.name}" />
                                ${project.trending ? '<div class="popup-badge">Trending</div>' : ''}
                                <button onclick="event.stopPropagation()" style="position:absolute;top:10px;right:10px;width:32px;height:32px;background:rgba(255,255,255,0.85);border:none;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;backdrop-filter:blur(4px);box-shadow:0 1px 4px rgba(0,0,0,0.15);">
                                    <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="#222" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
                                </button>
                            </div>
                            <div class="popup-body">
                                <div class="popup-title">${project.name}</div>
                                <div class="popup-location">${project.location}${project.area ? ', ' + project.area : ''}</div>
                                <div class="popup-details">
                                    <span>${project.beds} bd · ${project.baths} ba · ${project.sqft} sqft</span>
                                </div>
                                <div style="display:flex;align-items:center;justify-content:space-between;margin-top:8px;">
                                    <div class="popup-price">${project.price}</div>
                                    ${project.roi ? `<div style="font-size:11px;font-weight:700;color:#15803d;background:#f0fdf4;padding:3px 8px;border-radius:20px;">${project.roi} ROI</div>` : ''}
                                </div>
                            </div>
                        </div>
                    `;

                    marker.bindPopup(popupContent, {
                        maxWidth: 280,
                        minWidth: 280,
                        closeButton: true,
                        autoPan: true,
                        autoPanPaddingTopLeft: [20, 20],
                        autoPanPaddingBottomRight: [20, 20],
                        className: 'airbnb-popup'
                    });

                    marker.on('click', () => {
                        setSelectedId(project.id);
                        onSelectProject && onSelectProject(project);
                    });

                    marker.on('mouseover', () => {
                        onHoverProject && onHoverProject(project);
                    });

                    marker.on('mouseout', () => {
                        onHoverProject && onHoverProject(null);
                    });

                    markersRef.current[project.id] = marker;
                });
            }, [projects, hoveredProject, selectedId]);

            // Pan to hovered project
            useEffect(() => {
                if (hoveredProject && markersRef.current[hoveredProject.id]) {
                    const marker = markersRef.current[hoveredProject.id];
                    const el = marker.getElement();
                    if (el) {
                        const inner = el.querySelector('.airbnb-marker');
                        if (inner) {
                            inner.classList.add('hovered');
                        }
                    }
                }
                return () => {
                    Object.values(markersRef.current).forEach(m => {
                        const el = m.getElement();
                        if (el) {
                            const inner = el.querySelector('.airbnb-marker');
                            if (inner) inner.classList.remove('hovered');
                        }
                    });
                };
            }, [hoveredProject]);

            // Invalidate size when container changes (e.g. split panel drag)
            useEffect(() => {
                if (mapInstanceRef.current) {
                    setTimeout(() => {
                        mapInstanceRef.current.invalidateSize();
                    }, 50);
                }
            });

            return (
                <div className="relative w-full h-full overflow-hidden" style={{ zIndex: 1 }}>
                    <div ref={mapRef} style={{ position: 'absolute', top: 0, left: 0, right: 0, bottom: 0 }} />
                    {/* "Search as I move the map" — Airbnb signature feature */}
                    <div className="absolute top-4 left-1/2 z-[1000]" style={{ transform: 'translateX(-50%)' }}>
                        <button
                            onClick={() => setSearchAsMove(s => !s)}
                            className="flex items-center gap-2.5 bg-white rounded-full px-4 py-2.5 shadow-lg hover:shadow-xl transition-shadow cursor-pointer border border-white/80"
                        >
                            <div className={`w-4 h-4 rounded border-2 flex items-center justify-center flex-shrink-0 transition-colors ${searchAsMove ? 'bg-[#222] border-[#222]' : 'border-[#aaa]'}`}>
                                {searchAsMove && (
                                    <svg className="w-2.5 h-2.5 text-white" fill="none" viewBox="0 0 10 10" stroke="currentColor" strokeWidth="2.5">
                                        <path d="M1.5 5l2.5 2.5 4.5-4.5" strokeLinecap="round" strokeLinejoin="round"/>
                                    </svg>
                                )}
                            </div>
                            <span className="text-sm font-medium text-[#222] whitespace-nowrap select-none">Search as I move the map</span>
                        </button>
                    </div>
                </div>
            );
        };

        // Search Screen (Home Page)
        const SearchScreen = ({ onSelectProject, watchlist, onToggleWatchlist, onViewAll, compareList = [], onAddToCompare }) => {
            const [activeTab, setActiveTab] = useState('buy');
            const [buySubTab, setBuySubTab] = useState('offplan'); // 'all', 'ready', 'offplan', 'luxury'
            const [isInvestorMode, setIsInvestorMode] = useState(false);
            const [showInvestorModal, setShowInvestorModal] = useState(false);
            const [isAiMode, setIsAiMode] = useState(false); // New AI Mode State

            // Carousel refs
            const propertiesScrollRef = useRef(null);
            const blogScrollRef = useRef(null);
            const servicesScrollRef = useRef(null);
            const [exploreTab, setExploreTab] = useState(0);
            const scrollCarousel = (ref, direction, amount = 320) => {
                if (ref.current) {
                    ref.current.scrollBy({ left: direction === 'next' ? amount : -amount, behavior: 'smooth' });
                }
            };

            // Blog post data
            const blogPosts = [
                { id: 1, title: 'Top 10 Off-Plan Projects Launching in Dubai 2026', image: 'https://images.unsplash.com/photo-1512453979798-5ea266f8880c?w=600&h=400&fit=crop', category: 'Most Read', readTime: '8 min', author: 'Sarah Al Maktoum', authorAvatar: 'https://i.pravatar.cc/40?img=1', date: 'Feb 5, 2026' },
                { id: 2, title: 'Dubai Creek Harbour: The Next Investment Hotspot', image: 'https://images.unsplash.com/photo-1546412414-e1885259563a?w=600&h=400&fit=crop', category: 'Investment', readTime: '6 min', author: 'Ahmed Hassan', authorAvatar: 'https://i.pravatar.cc/40?img=3', date: 'Jan 28, 2026' },
                { id: 3, title: 'Understanding Payment Plans: A Complete Guide for Buyers', image: 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=600&h=400&fit=crop', category: 'Guide', readTime: '12 min', author: 'Fatima Youssef', authorAvatar: 'https://i.pravatar.cc/40?img=5', date: 'Jan 20, 2026' },
                { id: 4, title: 'Why Waterfront Properties in Dubai Yield Higher ROI', image: 'https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=600&h=400&fit=crop', category: 'Most Read', readTime: '5 min', author: 'Omar Khalil', authorAvatar: 'https://i.pravatar.cc/40?img=8', date: 'Jan 15, 2026' },
                { id: 5, title: 'Dubai South: The Future of Affordable Luxury Living', image: 'https://images.unsplash.com/photo-1613490493576-7fde63acd811?w=600&h=400&fit=crop', category: 'Trending', readTime: '7 min', author: 'Layla Rahman', authorAvatar: 'https://i.pravatar.cc/40?img=9', date: 'Jan 10, 2026' },
                { id: 6, title: 'Mortgage vs Cash Purchase: What Smart Investors Choose', image: 'https://images.unsplash.com/photo-1560518883-ce09059eeffa?w=600&h=400&fit=crop', category: 'Guide', readTime: '10 min', author: 'Sarah Al Maktoum', authorAvatar: 'https://i.pravatar.cc/40?img=1', date: 'Jan 5, 2026' }
            ];

            // Filter state management - tracks what user has selected
            // Starting with some defaults to match the design reference (Off-Plan state)
            const [selectedPropertyType, setSelectedPropertyType] = useState('residential');
            const [selectedBedsBaths, setSelectedBedsBaths] = useState('2');
            const [selectedPriceRange, setSelectedPriceRange] = useState('2m-5m');
            const [selectedHandover, setSelectedHandover] = useState('2028-Q3');
            const [selectedPaymentPlan, setSelectedPaymentPlan] = useState('70/30');
            const [selectedCompletion, setSelectedCompletion] = useState('80');

            // Dropdown open states
            const [openDropdown, setOpenDropdown] = useState(null);
            const toggleDropdown = (name) => setOpenDropdown(prev => prev === name ? null : name);
            const closeDropdown = () => setOpenDropdown(null);

            // Helper function to get display text for dropdowns
            const getPropertyTypeText = () => {
                if (selectedPropertyType === 'all') return 'Type';
                const typeMap = {
                    'apartment': 'Apartment',
                    'villa': 'Villa',
                    'townhouse': 'Townhouse',
                    'penthouse': 'Penthouse'
                };
                return typeMap[selectedPropertyType] || 'Residential';
            };

            const getBedsBathsText = () => {
                if (selectedBedsBaths === 'all') return 'Beds, Baths';
                const bedsMap = {
                    'studio': 'Studio',
                    '1': '1 bed',
                    '2': '2 beds, 1 bath',
                    '3': '3 beds, 2 baths',
                    '4+': '4+ beds'
                };
                return bedsMap[selectedBedsBaths] || 'Beds, Baths';
            };

            const getPriceRangeText = () => {
                if (selectedPriceRange === 'all') return 'Price (AED)';
                const priceMap = {
                    '0-1m': 'Up to 1,000',
                    '1m-2m': '1,000 - 2,000',
                    '2m-5m': '1,800 - 2,500',
                    '5m+': '5,000+'
                };
                return priceMap[selectedPriceRange] || 'Price (AED)';
            };

            const getHandoverText = () => {
                if (selectedHandover === 'all') return 'Handover by';
                return `Handover by Q${selectedHandover.charAt(selectedHandover.length - 1)} ${selectedHandover.substring(0, 4)}`;
            };

            const getPaymentPlanText = () => {
                if (selectedPaymentPlan === 'all') return 'Payment Plan';
                return `Payment Plan ${selectedPaymentPlan}`;
            };

            const getCompletionText = () => {
                if (selectedCompletion === 'all') return 'Completion';
                return `Completion ${selectedCompletion}%`;
            };

            return (
                <div className="min-h-screen bg-cream-50">
                    {/* Hero - Everything inside the video frame */}
                    <div className="relative">
                        {/* Full-bleed video — tall enough to contain all content */}
                        <div className="relative overflow-hidden" style={{ minHeight: '760px', maxHeight: '760px', height: '760px' }}>
                            <video
                                autoPlay
                                muted
                                loop
                                playsInline
                                className="absolute inset-0 w-full h-full object-cover"
                                style={{ objectPosition: 'center center' }}
                            >
                                <source src="driven-properties-hero.mp4" type="video/mp4" />
                                <img src="https://images.unsplash.com/photo-1512453979798-5ea266f8880c?w=1600&h=600&fit=crop" alt="Dubai Skyline" className="absolute inset-0 w-full h-full object-cover" />
                            </video>
                            {/* Gradient overlay — stronger at bottom so search box area is readable */}
                            <div className="absolute inset-0 bg-gradient-to-b from-black/20 via-black/30 to-black/65"></div>
                            <div className="relative flex flex-col items-center justify-start text-center px-4 md:px-8 pt-36 md:pt-44 pb-16" style={{ height: '760px', overflow: 'visible' }}>
                                {/* Tagline + headline */}
                                <p className="text-white/75 text-xs tracking-[0.25em] mb-5 font-light uppercase">Driven by your Dreams</p>
                                <h1 className="text-4xl md:text-5xl lg:text-[58px] text-white leading-tight font-bold">
                                    We help you find the
                                </h1>
                                <h1 className="text-4xl md:text-5xl lg:text-[58px] text-white leading-tight font-bold mb-8">
                                    Perfect Property
                                </h1>

                                {/* Manual Search / AI Agent Toggle */}
                                <div className="flex justify-center mb-6">
                                    <div className="bg-white/15 backdrop-blur-md p-1.5 rounded-full flex border border-white/25 shadow-lg" role="tablist">
                                        <button
                                            onClick={() => setIsAiMode(false)}
                                            role="tab"
                                            aria-selected={!isAiMode}
                                            className={`px-6 py-2.5 rounded-full text-sm font-semibold transition-all ${!isAiMode ? 'bg-white text-driven-text shadow-md' : 'text-white/90 hover:text-white'}`}
                                        >
                                            Manual Search
                                        </button>
                                        <button
                                            onClick={() => setIsAiMode(true)}
                                            role="tab"
                                            aria-selected={isAiMode}
                                            className={`px-6 py-2.5 rounded-full text-sm font-semibold transition-all flex items-center gap-2 ${isAiMode ? 'bg-white text-driven-text shadow-md' : 'text-white/90 hover:text-white'}`}
                                        >
                                            <Icon name="star" className="w-3.5 h-3.5" />
                                            AI Agent
                                        </button>
                                    </div>
                                </div>
                                {/* ── Hero Search Box — Figma Make Design ── */}
                                <div className="w-full flex justify-center px-0 md:px-4 lg:px-8">
                                    <div className="bg-[rgba(255,255,255,0.1)] p-[8px] rounded-[44px] w-full max-w-4xl shadow-2xl">
                                        {/* Container height is always driven by the manual search content beneath — AI panel overlays it absolutely */}
                                        <div className="backdrop-blur-[8.5px] bg-[rgba(248,247,244,0.9)] rounded-[40px] w-full overflow-hidden relative">

                                            {/* ── AI Panel — absolute overlay, always same height as manual search ── */}
                                            {isAiMode && (
                                                <div className="absolute inset-0 p-4 flex flex-col gap-2 text-left">
                                                    {/* Header: icon + title/subtitle only — chips moved inside input box */}
                                                    <div className="flex items-center gap-3 flex-shrink-0">
                                                        <div className="w-9 h-9 rounded-full bg-[#e7dccc]/40 flex items-center justify-center flex-shrink-0">
                                                            <Icon name="star" className="w-5 h-5 text-[#6C5F4C]" />
                                                        </div>
                                                        <div>
                                                            <h3 className="text-base font-bold text-[#1c1c1a]">Driven AI Assistant</h3>
                                                            <p className="text-xs text-[#696765]">{"I'll help you find verified off-plan investments."}</p>
                                                        </div>
                                                    </div>
                                                    {/* Unified input box fills all remaining space + submit button outside bottom-right */}
                                                    <div className="flex gap-2 items-stretch flex-1">
                                                        {/* Input box: chips top-left, textarea below — fills full height */}
                                                        <div className="flex-1 flex flex-col bg-[#fffbf6] border border-[#e7dccc] rounded-2xl overflow-hidden focus-within:border-[#c4ad8d] transition-colors">
                                                            <div className="flex gap-2 px-4 pt-3 pb-1 flex-shrink-0">
                                                                {['High Yield', 'Under 2M', 'Waterfront'].map(s => (
                                                                    <button key={s} className="px-2.5 py-1 rounded-full bg-white border border-[#e7dccc] text-xs font-medium text-[#696765] hover:border-[#c4ad8d] transition-all whitespace-nowrap">{s}</button>
                                                                ))}
                                                            </div>
                                                            <textarea
                                                                aria-label="AI search query"
                                                                className="flex-1 w-full px-4 pt-1 pb-3 bg-transparent text-[#1c1c1a] placeholder-[rgba(0,0,0,0.4)] resize-none text-sm focus:outline-none"
                                                                placeholder="Find me a 2-bedroom apartment in Dubai Marina under 2M AED with high ROI and payment plan..."
                                                            ></textarea>
                                                        </div>
                                                        {/* Submit button outside, aligned to bottom */}
                                                        <button aria-label="Submit AI search" className="w-[48px] h-[48px] bg-[#161717] hover:bg-black rounded-full text-white flex items-center justify-center transition-all hover:scale-105 active:scale-95 flex-shrink-0 border border-[#c4ad8d] self-end">
                                                            <Icon name="arrowRight" className="w-4 h-4" />
                                                        </button>
                                                    </div>
                                                </div>
                                            )}

                                            {/* ── Manual Search — always in DOM to drive container height; hidden behind AI panel ── */}
                                            <div className={`p-4 flex flex-col gap-2${isAiMode ? ' invisible pointer-events-none select-none' : ''}`}>

                                                    {/* Row 1: Property Type Tabs */}
                                                    <div className="bg-[#fffbf6] border border-[#e7dccc] rounded-[36px] p-2 w-full">
                                                        <div className="flex gap-1" role="tablist" aria-label="Property category">
                                                            {[
                                                                { id: 'buy', label: 'Buy' },
                                                                { id: 'rent', label: 'Rent' },
                                                                { id: 'commercial', label: 'Commercial' },
                                                                { id: 'projects', label: 'Projects' }
                                                            ].map(tab => (
                                                                <button
                                                                    key={tab.id}
                                                                    role="tab"
                                                                    aria-selected={activeTab === tab.id}
                                                                    onClick={() => setActiveTab(tab.id)}
                                                                    className={`flex-1 h-[34px] rounded-[16px] text-sm font-medium transition-all whitespace-nowrap ${activeTab === tab.id ? 'bg-[#161717] text-[#fafaf5] shadow-[0_4px_8px_rgba(0,0,0,0.18)]' : 'text-[#1c1c1a] hover:bg-black/5'}`}
                                                                >
                                                                    {tab.label}
                                                                </button>
                                                            ))}
                                                        </div>
                                                    </div>

                                                    {/* Row 2: Sub-tabs + Dropdowns — wrap to next line if not enough space */}
                                                    <div className="flex gap-2 items-center flex-wrap">

                                                        {/* Buy status sub-tabs — w-full so buttons spread evenly */}
                                                        {activeTab === 'buy' && (
                                                            <div className="bg-[#fffbf6] border border-[#e7dccc] rounded-[36px] p-1.5 flex gap-1 w-full">
                                                                {[{ key: 'all', label: 'All' }, { key: 'ready', label: 'Ready' }, { key: 'offplan', label: 'Off Plan' }, { key: 'luxury', label: 'Luxury' }].map(({ key, label }) => (
                                                                    <button
                                                                        key={key}
                                                                        onClick={() => setBuySubTab(key)}
                                                                        className={`flex-1 min-h-[32px] py-1 rounded-[16px] text-sm transition-all whitespace-nowrap ${buySubTab === key ? 'bg-[#ebebe2] text-[#1c1c1a] font-semibold border border-[#333331]' : 'text-[#494946] hover:bg-black/5'}`}
                                                                    >
                                                                        {label}
                                                                    </button>
                                                                ))}
                                                            </div>
                                                        )}

                                                        {/* Rent sub-tabs — w-full */}
                                                        {activeTab === 'rent' && (
                                                            <div className="bg-[#fffbf6] border border-[#e7dccc] rounded-[36px] p-1.5 flex gap-1 w-full">
                                                                {['Yearly', 'Monthly', 'Weekly'].map(p => (
                                                                    <button key={p} className="flex-1 min-h-[32px] py-1 rounded-[16px] text-sm text-[#494946] hover:bg-black/5 transition-all whitespace-nowrap">{p}</button>
                                                                ))}
                                                            </div>
                                                        )}

                                                        {/* Commercial sub-tabs — w-full */}
                                                        {activeTab === 'commercial' && (
                                                            <div className="bg-[#fffbf6] border border-[#e7dccc] rounded-[36px] p-1.5 flex gap-1 w-full">
                                                                {['Office', 'Retail', 'Warehouse'].map(p => (
                                                                    <button key={p} className="flex-1 min-h-[32px] py-1 rounded-[16px] text-sm text-[#494946] hover:bg-black/5 transition-all whitespace-nowrap">{p}</button>
                                                                ))}
                                                            </div>
                                                        )}

                                                        {/* Projects sub-tabs — w-full */}
                                                        {activeTab === 'projects' && (
                                                            <div className="bg-[#fffbf6] border border-[#e7dccc] rounded-[36px] p-1.5 flex gap-1 w-full">
                                                                {['Off-Plan', 'Completed', 'Under Construction'].map(p => (
                                                                    <button key={p} className="flex-1 min-h-[32px] py-1 rounded-[16px] text-sm text-[#494946] hover:bg-black/5 transition-all whitespace-nowrap">{p}</button>
                                                                ))}
                                                            </div>
                                                        )}

                                                        {/* Dropdown Filters */}
                                                        {activeTab === 'buy' && buySubTab === 'offplan' ? (
                                                            <>
                                                                <div className="relative flex-shrink-0">
                                                                    <button onClick={() => toggleDropdown('handover')} className={`bg-[#fffbf6] border h-[50px] rounded-[33px] flex items-center pl-3 pr-4 gap-2 hover:bg-[#f0ede8] transition-colors min-w-[130px] border-[#e7dccc]`}>
                                                                        <Icon name="chevronDown" className="w-3.5 h-3.5 text-[#242424] flex-shrink-0" />
                                                                        <div className="text-left">
                                                                            <p className="text-[11px] text-[#696765] leading-none font-medium">Handover by</p>
                                                                            {selectedHandover !== 'all' && <p className="text-sm font-bold text-[#1c1c1a] leading-tight mt-0.5">{selectedHandover.replace('-', ' ')}</p>}
                                                                        </div>
                                                                    </button>
                                                                    {openDropdown === 'handover' && (
                                                                        <div className="absolute top-full left-0 mt-1.5 bg-[#fffbf6] rounded-2xl shadow-lg border border-[#e7dccc] py-1.5 z-50 min-w-[140px]">
                                                                            {[['all', 'Any time'], ['2026-Q2', 'Q2 2026'], ['2027-Q4', 'Q4 2027'], ['2028-Q3', 'Q3 2028']].map(([v, l]) => (
                                                                                <button key={v} onClick={() => { setSelectedHandover(v); closeDropdown(); }} className={`w-full text-left px-4 py-2 text-sm transition-colors ${selectedHandover === v ? 'font-semibold bg-[#ebebe2] text-[#1c1c1a]' : 'text-[#696765] hover:bg-black/5'}`}>{l}</button>
                                                                            ))}
                                                                        </div>
                                                                    )}
                                                                </div>
                                                                <div className="relative flex-shrink-0">
                                                                    <button onClick={() => toggleDropdown('paymentplan')} className={`bg-[#fffbf6] border h-[50px] rounded-[33px] flex items-center pl-3 pr-4 gap-2 hover:bg-[#f0ede8] transition-colors min-w-[140px] border-[#e7dccc]`}>
                                                                        <Icon name="chevronDown" className="w-3.5 h-3.5 text-[#242424] flex-shrink-0" />
                                                                        <div className="text-left">
                                                                            <p className="text-[11px] text-[#696765] leading-none font-medium">Payment Plan</p>
                                                                            {selectedPaymentPlan !== 'all' && <p className="text-sm font-bold text-[#1c1c1a] leading-tight mt-0.5">{selectedPaymentPlan}</p>}
                                                                        </div>
                                                                    </button>
                                                                    {openDropdown === 'paymentplan' && (
                                                                        <div className="absolute top-full left-0 mt-1.5 bg-[#fffbf6] rounded-2xl shadow-lg border border-[#e7dccc] py-1.5 z-50 min-w-[140px]">
                                                                            {[['all', 'Any plan'], ['70/30', '70/30'], ['60/40', '60/40'], ['80/20', '80/20']].map(([v, l]) => (
                                                                                <button key={v} onClick={() => { setSelectedPaymentPlan(v); closeDropdown(); }} className={`w-full text-left px-4 py-2 text-sm transition-colors ${selectedPaymentPlan === v ? 'font-semibold bg-[#ebebe2] text-[#1c1c1a]' : 'text-[#696765] hover:bg-black/5'}`}>{l}</button>
                                                                            ))}
                                                                        </div>
                                                                    )}
                                                                </div>
                                                                <div className="relative flex-shrink-0">
                                                                    <button onClick={() => toggleDropdown('completion')} className={`bg-[#fffbf6] border h-[50px] rounded-[33px] flex items-center pl-3 pr-4 gap-2 hover:bg-[#f0ede8] transition-colors min-w-[120px] border-[#e7dccc]`}>
                                                                        <Icon name="chevronDown" className="w-3.5 h-3.5 text-[#242424] flex-shrink-0" />
                                                                        <div className="text-left">
                                                                            <p className="text-[11px] text-[#696765] leading-none font-medium">Completion</p>
                                                                            {selectedCompletion !== 'all' && <p className="text-sm font-bold text-[#1c1c1a] leading-tight mt-0.5">{selectedCompletion}%+</p>}
                                                                        </div>
                                                                    </button>
                                                                    {openDropdown === 'completion' && (
                                                                        <div className="absolute top-full left-0 mt-1.5 bg-[#fffbf6] rounded-2xl shadow-lg border border-[#e7dccc] py-1.5 z-50 min-w-[130px]">
                                                                            {[['all', 'Any %'], ['40', '40%+'], ['60', '60%+'], ['80', '80%+']].map(([v, l]) => (
                                                                                <button key={v} onClick={() => { setSelectedCompletion(v); closeDropdown(); }} className={`w-full text-left px-4 py-2 text-sm transition-colors ${selectedCompletion === v ? 'font-semibold bg-[#ebebe2] text-[#1c1c1a]' : 'text-[#696765] hover:bg-black/5'}`}>{l}</button>
                                                                            ))}
                                                                        </div>
                                                                    )}
                                                                </div>
                                                            </>
                                                        ) : activeTab === 'buy' ? (
                                                            <>
                                                                <div className="relative flex-shrink-0">
                                                                    <button onClick={() => toggleDropdown('type')} className={`bg-[#fffbf6] border h-[50px] rounded-[33px] flex items-center pl-3 pr-4 gap-2 hover:bg-[#f0ede8] transition-colors min-w-[100px] border-[#e7dccc]`}>
                                                                        <Icon name="chevronDown" className="w-3.5 h-3.5 text-[#242424] flex-shrink-0" />
                                                                        <div className="text-left">
                                                                            <p className="text-[11px] text-[#696765] leading-none font-medium">Type</p>
                                                                            {selectedPropertyType !== 'all' && <p className="text-sm font-bold text-[#1c1c1a] leading-tight mt-0.5">{getPropertyTypeText()}</p>}
                                                                        </div>
                                                                    </button>
                                                                    {openDropdown === 'type' && (
                                                                        <div className="absolute top-full left-0 mt-1.5 bg-[#fffbf6] rounded-2xl shadow-lg border border-[#e7dccc] py-1.5 z-50 min-w-[140px]">
                                                                            {[['all', 'Any type'], ['apartment', 'Apartment'], ['villa', 'Villa'], ['townhouse', 'Townhouse'], ['penthouse', 'Penthouse']].map(([v, l]) => (
                                                                                <button key={v} onClick={() => { setSelectedPropertyType(v); closeDropdown(); }} className={`w-full text-left px-4 py-2 text-sm transition-colors ${selectedPropertyType === v ? 'font-semibold bg-[#ebebe2] text-[#1c1c1a]' : 'text-[#696765] hover:bg-black/5'}`}>{l}</button>
                                                                            ))}
                                                                        </div>
                                                                    )}
                                                                </div>
                                                                <div className="relative flex-shrink-0">
                                                                    <button onClick={() => toggleDropdown('beds')} className={`bg-[#fffbf6] border h-[50px] rounded-[33px] flex items-center pl-3 pr-4 gap-2 hover:bg-[#f0ede8] transition-colors min-w-[120px] border-[#e7dccc]`}>
                                                                        <Icon name="chevronDown" className="w-3.5 h-3.5 text-[#242424] flex-shrink-0" />
                                                                        <div className="text-left">
                                                                            <p className="text-[11px] text-[#696765] leading-none font-medium">Beds, Baths</p>
                                                                            {selectedBedsBaths !== 'all' && <p className="text-sm font-bold text-[#1c1c1a] leading-tight mt-0.5">{getBedsBathsText()}</p>}
                                                                        </div>
                                                                    </button>
                                                                    {openDropdown === 'beds' && (
                                                                        <div className="absolute top-full left-0 mt-1.5 bg-[#fffbf6] rounded-2xl shadow-lg border border-[#e7dccc] py-1.5 z-50 min-w-[150px]">
                                                                            {[['all', 'Any beds'], ['studio', 'Studio'], ['1', '1 Bed'], ['2', '2 Beds'], ['3', '3 Beds'], ['4+', '4+ Beds']].map(([v, l]) => (
                                                                                <button key={v} onClick={() => { setSelectedBedsBaths(v); closeDropdown(); }} className={`w-full text-left px-4 py-2 text-sm transition-colors ${selectedBedsBaths === v ? 'font-semibold bg-[#ebebe2] text-[#1c1c1a]' : 'text-[#696765] hover:bg-black/5'}`}>{l}</button>
                                                                            ))}
                                                                        </div>
                                                                    )}
                                                                </div>
                                                                <div className="relative flex-shrink-0">
                                                                    <button onClick={() => toggleDropdown('price')} className={`bg-[#fffbf6] border h-[50px] rounded-[33px] flex items-center pl-3 pr-4 gap-2 hover:bg-[#f0ede8] transition-colors min-w-[95px] border-[#e7dccc]`}>
                                                                        <Icon name="chevronDown" className="w-3.5 h-3.5 text-[#242424] flex-shrink-0" />
                                                                        <div className="text-left">
                                                                            <p className="text-[11px] text-[#696765] leading-none font-medium">Price</p>
                                                                            {selectedPriceRange !== 'all' && <p className="text-sm font-bold text-[#1c1c1a] leading-tight mt-0.5">{getPriceRangeText()}</p>}
                                                                        </div>
                                                                    </button>
                                                                    {openDropdown === 'price' && (
                                                                        <div className="absolute top-full left-0 mt-1.5 bg-[#fffbf6] rounded-2xl shadow-lg border border-[#e7dccc] py-1.5 z-50 min-w-[150px]">
                                                                            {[['all', 'Any price'], ['0-1m', 'Up to 1M'], ['1m-2m', '1M – 2M'], ['2m-5m', '2M – 5M'], ['5m+', '5M+']].map(([v, l]) => (
                                                                                <button key={v} onClick={() => { setSelectedPriceRange(v); closeDropdown(); }} className={`w-full text-left px-4 py-2 text-sm transition-colors ${selectedPriceRange === v ? 'font-semibold bg-[#ebebe2] text-[#1c1c1a]' : 'text-[#696765] hover:bg-black/5'}`}>{l}</button>
                                                                            ))}
                                                                        </div>
                                                                    )}
                                                                </div>
                                                            </>
                                                        ) : activeTab === 'rent' ? (
                                                            ['Type', 'Beds, Baths', 'Price'].map(f => (
                                                                <button key={f} className="flex-shrink-0 bg-[#fffbf6] border border-[#e7dccc] h-[50px] rounded-[33px] flex items-center pl-3 pr-4 gap-2 hover:bg-[#f0ede8] transition-colors min-w-[100px]">
                                                                    <Icon name="chevronDown" className="w-3.5 h-3.5 text-[#242424]" />
                                                                    <p className="text-sm text-[#696765]">{f}</p>
                                                                </button>
                                                            ))
                                                        ) : activeTab === 'commercial' ? (
                                                            ['Size (sqft)', 'Price'].map(f => (
                                                                <button key={f} className="flex-shrink-0 bg-[#fffbf6] border border-[#e7dccc] h-[50px] rounded-[33px] flex items-center pl-3 pr-4 gap-2 hover:bg-[#f0ede8] transition-colors min-w-[100px]">
                                                                    <Icon name="chevronDown" className="w-3.5 h-3.5 text-[#242424]" />
                                                                    <p className="text-sm text-[#696765]">{f}</p>
                                                                </button>
                                                            ))
                                                        ) : (
                                                            ['Developer', 'Location', 'Price Range'].map(f => (
                                                                <button key={f} className="flex-shrink-0 bg-[#fffbf6] border border-[#e7dccc] h-[50px] rounded-[33px] flex items-center pl-3 pr-4 gap-2 hover:bg-[#f0ede8] transition-colors min-w-[100px]">
                                                                    <Icon name="chevronDown" className="w-3.5 h-3.5 text-[#242424]" />
                                                                    <p className="text-sm text-[#696765]">{f}</p>
                                                                </button>
                                                            ))
                                                        )}
                                                    </div>

                                                    {/* Row 3: Search Bar + Reset + Button — always full width */}
                                                    <div className="flex gap-2 items-center">
                                                        <div className="flex-1 bg-[#fffbf6] border border-[#e7dccc] rounded-[33px] h-[50px] flex items-center gap-2 pl-5 pr-3 min-w-0">
                                                            <Icon name="search" className="w-4 h-4 text-[#6C5F4C] flex-shrink-0" />
                                                            <input
                                                                type="text"
                                                                aria-label="Search your preferred location"
                                                                placeholder="Search your preferred location"
                                                                className="flex-1 bg-transparent text-sm text-[rgba(0,0,0,0.85)] placeholder-[rgba(0,0,0,0.45)] outline-none min-w-0"
                                                            />
                                                        </div>
                                                        <button
                                                            onClick={() => { setSelectedPropertyType('all'); setSelectedBedsBaths('all'); setSelectedPriceRange('all'); setSelectedHandover('all'); setSelectedPaymentPlan('all'); setSelectedCompletion('all'); setBuySubTab('all'); }}
                                                            className="text-xs text-[#00276f] underline hover:text-[#003a9c] transition-colors flex-shrink-0 whitespace-nowrap font-medium"
                                                        >
                                                            Reset
                                                        </button>
                                                        <button
                                                            onClick={() => onViewAll()}
                                                            aria-label="Search properties"
                                                            className="w-[48px] h-[48px] bg-[#161717] rounded-full flex items-center justify-center hover:scale-105 active:scale-95 transition-transform flex-shrink-0 border border-[#c4ad8d]"
                                                        >
                                                            <Icon name="search" className="w-5 h-5 text-white" />
                                                        </button>
                                                    </div>

                                                </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* ════════ Popular Properties in Dubai ════════ */}
                    <div className="max-w-7xl mx-auto px-4 md:px-6 pt-10 pb-4">
                        <div className="flex items-center justify-between mb-6">
                            <h2 className="text-[18px] lg:text-[28px] font-bold text-driven-text">Popular Properties in Dubai</h2>
                            <div className="flex items-center gap-2 flex-shrink-0">
                                <button onClick={() => scrollCarousel(propertiesScrollRef, 'prev')} className="w-10 h-10 rounded-full border border-warm-200 flex items-center justify-center text-driven-text hover:bg-warm-100 transition-all" aria-label="Previous"><svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7" /></svg></button>
                                <button onClick={() => scrollCarousel(propertiesScrollRef, 'next')} className="w-10 h-10 rounded-full border border-warm-200 flex items-center justify-center text-driven-text hover:bg-warm-100 transition-all" aria-label="Next"><svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M9 5l7 7-7 7" /></svg></button>
                                <button onClick={onViewAll} className="flex items-center gap-1.5 px-4 py-2 rounded-full border border-warm-200 text-driven-text font-medium text-sm hover:bg-warm-100 transition-all whitespace-nowrap"><svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M7 17L17 7M17 7H7M17 7v10" /></svg>View More</button>
                            </div>
                        </div>
                        <div ref={propertiesScrollRef} className="carousel-container -mx-4 md:-mx-6 px-4 md:px-6">
                            <div className="carousel-track pb-2">
                                {mockProjects.slice(0, 10).map(project => (
                                    <div key={project.id} className="carousel-property-card flex-shrink-0">
                                        <PropertyCard project={project} onSelect={onSelectProject} inWatchlist={watchlist.some(w => w.id === project.id)} onToggleWatchlist={onToggleWatchlist} isInvestorMode={isInvestorMode} onAddToCompare={onAddToCompare} inCompareList={compareList.some(c => c.id === project.id)} />
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>

                    {/* ════════ City Comparison Banner ════════ */}
                    <div className="max-w-7xl mx-auto px-4 md:px-6 py-4">
                        <div className="rounded-2xl overflow-hidden flex items-center" style={{ background: '#EDE0CD', minHeight: '190px' }}>
                            <div className="flex items-center justify-between w-full px-6 md:px-10 py-8 gap-4">
                                <div className="flex-1 min-w-0">
                                    <p className="text-[#1c1c1a] text-lg md:text-[22px] font-semibold leading-snug mb-5 max-w-md">
                                        Find out how Dubai compares to London, New York, and Singapore in our groundbreaking Tier-1 City Index!
                                    </p>
                                    <button className="flex items-center gap-2.5 px-5 py-3 bg-[#1c1c1a] text-white rounded-full text-sm font-semibold hover:bg-black transition-colors">
                                        <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M7 17L17 7M17 7H7M17 7v10" /></svg>
                                        Full Rankings & Analysis
                                    </button>
                                </div>
                                <div className="hidden md:block flex-shrink-0" style={{ width: '260px', height: '170px' }}>
                                    <svg viewBox="0 0 260 170" fill="none" xmlns="http://www.w3.org/2000/svg" className="w-full h-full">
                                        <defs>
                                            <linearGradient id="cBg" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stopColor="#F9C4A0"/><stop offset="100%" stopColor="#EDE0CD"/></linearGradient>
                                            <linearGradient id="cB1" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stopColor="#C8462A"/><stop offset="100%" stopColor="#7A1E0A"/></linearGradient>
                                            <linearGradient id="cB2" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stopColor="#E07040"/><stop offset="100%" stopColor="#A83010"/></linearGradient>
                                            <linearGradient id="cB3" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stopColor="#EE9060"/><stop offset="100%" stopColor="#C04020"/></linearGradient>
                                        </defs>
                                        <rect width="260" height="170" fill="url(#cBg)"/>
                                        {/* Water reflection */}
                                        <rect x="0" y="152" width="260" height="18" fill="#C9A07A" opacity="0.35" rx="0"/>
                                        {/* Far buildings */}
                                        <rect x="5" y="105" width="14" height="50" fill="url(#cB3)" opacity="0.5" rx="1"/>
                                        <rect x="22" y="92" width="13" height="63" fill="url(#cB2)" opacity="0.5" rx="1"/>
                                        {/* Building cluster left */}
                                        <rect x="38" y="88" width="15" height="67" fill="url(#cB3)" rx="1"/>
                                        <rect x="36" y="98" width="19" height="57" fill="url(#cB3)" rx="1"/>
                                        {/* Building cluster center-left */}
                                        <rect x="62" y="72" width="18" height="83" fill="url(#cB2)" rx="1"/>
                                        <rect x="60" y="82" width="22" height="73" fill="url(#cB2)" rx="1"/>
                                        {/* Burj Khalifa - tall center spire */}
                                        <rect x="121" y="15" width="10" height="140" fill="url(#cB1)" rx="1"/>
                                        <rect x="118" y="40" width="16" height="115" fill="url(#cB1)" rx="1"/>
                                        <rect x="114" y="65" width="24" height="90" fill="url(#cB1)" rx="1"/>
                                        <polygon points="121,5 131,5 126,0" fill="#A03020"/>
                                        {/* Building right of Burj */}
                                        <rect x="144" y="62" width="18" height="93" fill="url(#cB2)" rx="1"/>
                                        <rect x="142" y="78" width="22" height="77" fill="url(#cB2)" rx="1"/>
                                        {/* Building far right-center */}
                                        <rect x="172" y="78" width="16" height="77" fill="url(#cB3)" rx="1"/>
                                        <rect x="170" y="88" width="20" height="67" fill="url(#cB3)" rx="1"/>
                                        {/* Sail-shaped building (Burj Al Arab) */}
                                        <path d="M200,155 L200,58 Q213,28 224,58 L224,155 Z" fill="url(#cB2)"/>
                                        {/* Far right */}
                                        <rect x="230" y="95" width="14" height="60" fill="url(#cB3)" opacity="0.6" rx="1"/>
                                        <rect x="246" y="108" width="12" height="47" fill="url(#cB2)" opacity="0.5" rx="1"/>
                                        {/* Ground */}
                                        <rect x="0" y="153" width="260" height="4" fill="#B8906A" opacity="0.5"/>
                                        {/* Subtle window lights */}
                                        <rect x="123" y="80" width="2" height="2" fill="rgba(255,240,180,0.5)"/>
                                        <rect x="127" y="80" width="2" height="2" fill="rgba(255,240,180,0.5)"/>
                                        <rect x="123" y="92" width="2" height="2" fill="rgba(255,240,180,0.5)"/>
                                        <rect x="127" y="92" width="2" height="2" fill="rgba(255,240,180,0.5)"/>
                                        <rect x="123" y="104" width="2" height="2" fill="rgba(255,240,180,0.4)"/>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* ════════ Popular Blog Posts ════════ */}
                    <div className="max-w-7xl mx-auto px-4 md:px-6 py-6">
                        <div className="flex items-center justify-between mb-6">
                            <h2 className="text-[18px] lg:text-[28px] font-bold text-driven-text">Read our Popular Blog Posts</h2>
                            <div className="flex items-center gap-2 flex-shrink-0">
                                <button onClick={() => scrollCarousel(blogScrollRef, 'prev', 360)} className="w-10 h-10 rounded-full border border-warm-200 flex items-center justify-center text-driven-text hover:bg-warm-100 transition-all" aria-label="Previous"><svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7" /></svg></button>
                                <button onClick={() => scrollCarousel(blogScrollRef, 'next', 360)} className="w-10 h-10 rounded-full border border-warm-200 flex items-center justify-center text-driven-text hover:bg-warm-100 transition-all" aria-label="Next"><svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M9 5l7 7-7 7" /></svg></button>
                                <button className="flex items-center gap-1.5 px-4 py-2 rounded-full border border-warm-200 text-driven-text font-medium text-sm hover:bg-warm-100 transition-all whitespace-nowrap"><svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M7 17L17 7M17 7H7M17 7v10" /></svg>View More</button>
                            </div>
                        </div>
                        <div ref={blogScrollRef} className="carousel-container -mx-4 md:-mx-6 px-4 md:px-6">
                            <div className="carousel-track pb-2">
                                {blogPosts.map(post => (
                                    <div key={post.id} className="carousel-blog-card flex-shrink-0">
                                        <div className="blog-card border border-warm-200 shadow-sm">
                                            <div className="blog-image-wrapper">
                                                <img src={post.image} alt={post.title} loading="lazy" />
                                                <div className="absolute top-3 left-3"><span className="px-2.5 py-1 bg-white/90 backdrop-blur-sm rounded-full text-xs font-bold text-driven-text shadow-sm">{post.category}</span></div>
                                                <div className="absolute top-3 right-3"><span className="px-2.5 py-1 bg-black/50 backdrop-blur-sm rounded-full text-xs font-medium text-white">{post.readTime}</span></div>
                                            </div>
                                            <div className="p-4 flex-1 flex flex-col">
                                                <h3 className="font-bold text-driven-text text-[15px] leading-snug mb-3" style={{ display: '-webkit-box', WebkitLineClamp: 2, WebkitBoxOrient: 'vertical', overflow: 'hidden' }}>{post.title}</h3>
                                                <div className="flex items-center justify-between mt-auto pt-2 border-t border-warm-100">
                                                    <div className="flex items-center gap-2.5">
                                                        <img src={post.authorAvatar} alt={post.author} className="w-7 h-7 rounded-full object-cover" />
                                                        <div>
                                                            <p className="text-[10px] text-warm-400 leading-tight">Written by</p>
                                                            <p className="text-xs font-semibold text-driven-text leading-tight">{post.author}</p>
                                                        </div>
                                                    </div>
                                                    <button className="w-8 h-8 rounded-full border border-warm-200 flex items-center justify-center text-warm-400 hover:border-accent-gold hover:text-accent-gold transition-all">
                                                        <svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M7 17L17 7M17 7H7M17 7v10" /></svg>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>

                    {/* ════════ Newsletter Banner ════════ */}
                    <div className="max-w-7xl mx-auto px-4 md:px-6 pb-6">
                        <div className="rounded-2xl overflow-hidden" style={{ background: '#EDE0CD' }}>
                            <div className="flex items-center justify-between px-6 md:px-10 py-10 gap-6">
                                <div className="flex-1 max-w-[380px]">
                                    <h2 className="text-xl md:text-[22px] font-bold text-[#1c1c1a] mb-5 leading-snug">Get monthly real estate insights in your inbox</h2>
                                    <div className="flex flex-col gap-3 mb-4">
                                        <label className="flex items-start gap-3 cursor-pointer">
                                            <div className="w-5 h-5 mt-0.5 border-2 border-[#9B8E7E] rounded flex items-center justify-center flex-shrink-0 bg-white/60">
                                                <svg className="w-3 h-3 text-[#1c1c1a]" fill="none" stroke="currentColor" strokeWidth="3" viewBox="0 0 24 24"><path d="M5 13l4 4L19 7" /></svg>
                                            </div>
                                            <span className="text-sm text-[#1c1c1a]">I want to receive the Buy &amp; Sell newsletter</span>
                                        </label>
                                        <label className="flex items-start gap-3 cursor-pointer">
                                            <div className="w-5 h-5 mt-0.5 border-2 border-[#9B8E7E] rounded flex-shrink-0 bg-white/60"></div>
                                            <span className="text-sm text-[#1c1c1a]">I want to receive the Capital Investment &amp; Developer newsletter</span>
                                        </label>
                                    </div>
                                    <input type="email" placeholder="Enter your email address" className="w-full px-4 py-3 rounded-full border border-[#C4AD8D] bg-white/70 text-sm mb-3 focus:outline-none focus:border-[#9B8E7E]" />
                                    <button className="w-full py-3.5 bg-[#1c1c1a] text-white rounded-full flex items-center justify-center gap-2.5 font-semibold text-sm hover:bg-black transition-colors">
                                        <svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>
                                        Subscribe
                                    </button>
                                </div>
                                {/* Envelope illustration */}
                                <div className="hidden md:flex flex-shrink-0 items-center justify-center" style={{ width: '260px', height: '190px' }}>
                                    <svg viewBox="0 0 260 200" fill="none" xmlns="http://www.w3.org/2000/svg" className="w-full h-full">
                                        <defs>
                                            <linearGradient id="stampGrad" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stopColor="#E8D5B7"/><stop offset="100%" stopColor="#D4B896"/></linearGradient>
                                        </defs>
                                        {/* Back stamps scattered */}
                                        <g transform="rotate(-18 60 130)"><rect x="20" y="95" width="50" height="68" rx="4" fill="#C4A070" opacity="0.5"/><rect x="23" y="98" width="44" height="62" rx="3" fill="url(#stampGrad)" opacity="0.85"/></g>
                                        <g transform="rotate(14 210 120)"><rect x="192" y="80" width="46" height="64" rx="4" fill="#C4A070" opacity="0.5"/><rect x="195" y="83" width="40" height="58" rx="3" fill="url(#stampGrad)" opacity="0.85"/></g>
                                        <g transform="rotate(6 185 145)"><rect x="165" y="110" width="42" height="58" rx="4" fill="#B89060" opacity="0.4"/><rect x="168" y="113" width="36" height="52" rx="3" fill="url(#stampGrad)" opacity="0.7"/></g>
                                        {/* Envelope body */}
                                        <rect x="48" y="68" width="164" height="112" rx="12" fill="#F6F0E8" stroke="#D0B88A" strokeWidth="1.5"/>
                                        {/* Envelope V-fold line */}
                                        <path d="M48 80 L130 128 L212 80" stroke="#D0B88A" strokeWidth="1.2" fill="none"/>
                                        {/* Bottom fold lines */}
                                        <path d="M48 180 L90 145" stroke="#D0B88A" strokeWidth="1" opacity="0.5"/>
                                        <path d="M212 180 L170 145" stroke="#D0B88A" strokeWidth="1" opacity="0.5"/>
                                        {/* @ card - dark card poking out of envelope */}
                                        <rect x="88" y="30" width="84" height="96" rx="10" fill="#1c1c1a" />
                                        <text x="130" y="88" textAnchor="middle" fill="white" fontSize="40" fontWeight="bold" fontFamily="Georgia, serif">@</text>
                                        {/* Stamp on envelope */}
                                        <rect x="172" y="78" width="28" height="34" rx="3" fill="#D4B896"/>
                                        <rect x="175" y="81" width="22" height="28" rx="2" fill="#EDE0CD"/>
                                        <text x="186" y="99" textAnchor="middle" fill="#8B6040" fontSize="9" fontWeight="bold">AE</text>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Separator */}
                    <div className="max-w-7xl mx-auto px-4 md:px-6"><div className="border-t border-warm-100" /></div>

                    {/* ════════ Our Services ════════ */}
                    <div className="max-w-7xl mx-auto px-4 md:px-6 py-10">
                        <div className="flex items-center justify-between mb-6">
                            <h2 className="text-[18px] lg:text-[28px] font-bold text-driven-text">Our Services</h2>
                            <div className="flex items-center gap-2 flex-shrink-0">
                                <button onClick={() => scrollCarousel(servicesScrollRef, 'prev')} className="w-10 h-10 rounded-full border border-warm-200 flex items-center justify-center text-driven-text hover:bg-warm-100 transition-all" aria-label="Previous"><svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7" /></svg></button>
                                <button onClick={() => scrollCarousel(servicesScrollRef, 'next')} className="w-10 h-10 rounded-full border border-warm-200 flex items-center justify-center text-driven-text hover:bg-warm-100 transition-all" aria-label="Next"><svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M9 5l7 7-7 7" /></svg></button>
                                <button className="flex items-center gap-1.5 px-4 py-2 rounded-full border border-warm-200 text-driven-text font-medium text-sm hover:bg-warm-100 transition-all whitespace-nowrap"><svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M7 17L17 7M17 7H7M17 7v10" /></svg>View More</button>
                            </div>
                        </div>
                        <div ref={servicesScrollRef} className="carousel-container -mx-4 md:-mx-6 px-4 md:px-6">
                            <div className="carousel-track pb-2">
                                {[
                                    { title: 'Relocation Services', desc: 'Planning a move for a property transaction? Let PetraMove handle everything for a fixed fee. Our relocation experts ensure a seamless experience, managing every detail from packing to settling in.', cta: 'Get Started', img: 'https://images.unsplash.com/photo-1600585154526-990dced4db0d?w=600&h=320&fit=crop' },
                                    { title: 'Instant Property Valuation', desc: 'Planning a move for a property transaction? Let PetraMove handle everything for a fixed fee. Our relocation experts ensure a seamless experience, managing every detail from packing to settling in.', cta: 'Get it Now', img: 'https://images.unsplash.com/photo-1556742049-0cfed4f6a45d?w=600&h=320&fit=crop' },
                                    { title: 'Property Management', desc: 'Planning a move for a property transaction? Let PetraMove handle everything for a fixed fee. Our relocation experts ensure a seamless experience, managing every detail from packing to settling in.', cta: 'Tenant Portal', img: 'https://images.unsplash.com/photo-1560518883-ce09059eeffa?w=600&h=320&fit=crop' },
                                    { title: 'Investment Advisory', desc: 'Planning a move for a property transaction? Let PetraMove handle everything for a fixed fee. Our relocation experts ensure a seamless experience, managing every detail from packing to settling in.', cta: 'Learn More', img: 'https://images.unsplash.com/photo-1507679799987-c73779587ccf?w=600&h=320&fit=crop' },
                                    { title: 'Mortgage Consulting', desc: 'Planning a move for a property transaction? Let PetraMove handle everything for a fixed fee. Our relocation experts ensure a seamless experience, managing every detail from packing to settling in.', cta: 'Get Started', img: 'https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?w=600&h=320&fit=crop' },
                                ].map((service, i) => (
                                    <div key={i} className="flex-shrink-0 bg-white rounded-2xl border border-warm-100 overflow-hidden hover:shadow-md transition-all cursor-pointer flex flex-col" style={{ width: '290px' }}>
                                        <div className="overflow-hidden rounded-t-2xl" style={{ height: '185px' }}>
                                            <img src={service.img} alt={service.title} className="w-full h-full object-cover hover:scale-105 transition-transform duration-500" loading="lazy" />
                                        </div>
                                        <div className="p-5 flex flex-col flex-1">
                                            <h3 className="font-bold text-driven-text text-[16px] mb-2">{service.title}</h3>
                                            <p className="text-sm text-warm-500 leading-relaxed mb-3 flex-1" style={{ display: '-webkit-box', WebkitLineClamp: 3, WebkitBoxOrient: 'vertical', overflow: 'hidden' }}>{service.desc}</p>
                                            <a href="#" className="text-sm font-medium text-[#1c1c1a] underline underline-offset-2 mb-4 hover:text-accent-gold transition-colors self-start">Read more</a>
                                            <button className="w-full py-3 rounded-full border border-warm-200 text-driven-text text-sm font-medium hover:bg-warm-50 transition-all">{service.cta}</button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>

                    {/* Separator */}
                    <div className="max-w-7xl mx-auto px-4 md:px-6"><div className="border-t border-warm-100" /></div>

                    {/* ════════ Popular Area ════════ */}
                    <div className="max-w-7xl mx-auto px-4 md:px-6 py-10">
                        <div className="flex items-center justify-between mb-6">
                            <h2 className="text-[18px] lg:text-[28px] font-bold text-driven-text">Popular Area</h2>
                            <div className="flex items-center gap-2 flex-shrink-0">
                                <button className="w-10 h-10 rounded-full border border-warm-200 flex items-center justify-center text-driven-text hover:bg-warm-100 transition-all" aria-label="Previous"><svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7" /></svg></button>
                                <button className="w-10 h-10 rounded-full border border-warm-200 flex items-center justify-center text-driven-text hover:bg-warm-100 transition-all" aria-label="Next"><svg className="w-4 h-4" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M9 5l7 7-7 7" /></svg></button>
                                <button className="flex items-center gap-1.5 px-4 py-2 rounded-full border border-warm-200 text-driven-text font-medium text-sm hover:bg-warm-100 transition-all whitespace-nowrap"><svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M7 17L17 7M17 7H7M17 7v10" /></svg>View More</button>
                            </div>
                        </div>
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                            {[
                                'Dubai Marina', 'Jumeirah Beach Residence', 'Palm Jumeirah', 'Downtown Dubai',
                                'Business Bay', 'Dubai Design District', 'DIFC', 'Deira',
                                'Jumeirah', 'Arabian Ranches', 'Dubai Hills Estate', 'City Walk'
                            ].map((area, i) => (
                                <button key={i} className="flex items-center justify-between px-4 py-3.5 bg-cream-50 border border-warm-200 rounded-xl hover:bg-warm-100 hover:border-warm-300 transition-all group text-left">
                                    <span className="text-sm font-medium text-driven-text truncate mr-2">{area}</span>
                                    <svg className="w-4 h-4 text-warm-400 group-hover:text-driven-text transition-colors flex-shrink-0" fill="none" stroke="currentColor" strokeWidth="1.5" viewBox="0 0 24 24"><path d="M7 17L17 7M17 7H7M17 7v10" /></svg>
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Separator */}
                    <div className="max-w-7xl mx-auto px-4 md:px-6"><div className="border-t border-warm-100" /></div>

                    {/* ════════ Explore More ════════ */}
                    <div className="max-w-7xl mx-auto px-4 md:px-6 py-10">
                        <div className="flex items-center justify-between mb-6">
                            <h2 className="text-[18px] lg:text-[28px] font-bold text-driven-text">Explore More</h2>
                            <button className="flex items-center gap-1.5 px-4 py-2 rounded-full border border-warm-200 text-driven-text font-medium text-sm hover:bg-warm-100 transition-all whitespace-nowrap"><svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M7 17L17 7M17 7H7M17 7v10" /></svg>View All</button>
                        </div>
                        {/* Tabs */}
                        <div className="flex overflow-x-auto border-b border-warm-200 mb-6" style={{ scrollbarWidth: 'none' }}>
                            {['Apartments for Sale', 'Properties for Sale', 'Apartments for Rent', 'Properties for Rent', 'Luxury Properties'].map((tab, i) => (
                                <button key={i} onClick={() => setExploreTab(i)}
                                    className={`flex items-center gap-2 px-4 py-2.5 text-sm font-medium whitespace-nowrap border-b-2 transition-all flex-shrink-0 ${exploreTab === i ? 'border-[#1c1c1a] text-[#1c1c1a]' : 'border-transparent text-warm-500 hover:text-driven-text'}`}>
                                    <svg className="w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor" strokeWidth="1.5" viewBox="0 0 24 24"><path d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" /></svg>
                                    {tab}
                                </button>
                            ))}
                        </div>
                        {/* 4 link columns */}
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-6 md:gap-8">
                            {[
                                { heading: 'Studio Apartments for sale in Dubai', items: ['Studio Apartments for sale in Dubai', '1 BHK Apartments in Dubai', '2 BHK Apartments in Dubai', '3 BHK Apartments in Dubai', '4 BHK Apartments in Dubai'], readMore: true },
                                { heading: '1 BHK Apartments in Dubai', items: ['Studio Apartments for sale in Dubai', '1 BHK Apartments in Dubai', '2 BHK Apartments in Dubai', '3 BHK Apartments in Dubai', '4 BHK Apartments in Dubai'], readMore: false },
                                { heading: '2 BHK Apartments in Dubai', items: ['Studio Apartments for sale in Dubai', '1 BHK Apartments in Dubai', '2 BHK Apartments in Dubai', '3 BHK Apartments in Dubai', '4 BHK Apartments in Dubai'], readMore: true },
                                { heading: 'Luxury Studio Apartments in Dubai', items: ['Studio Apartments for sale in Dubai', '1 BHK Apartments in Dubai', '2 BHK Apartments in Dubai', '3 BHK Apartments in Dubai', '4 BHK Apartments in Dubai'], readMore: false },
                            ].map((col, i) => (
                                <div key={i}>
                                    <h3 className="font-bold text-driven-text text-sm mb-3 leading-snug">{col.heading}</h3>
                                    <div className="flex flex-col gap-2">
                                        {col.items.map((item, j) => (
                                            <a key={j} href="#" className="text-xs text-warm-500 hover:text-driven-text transition-colors leading-snug">{item}</a>
                                        ))}
                                        {col.readMore && <a href="#" className="text-xs font-semibold text-driven-text underline underline-offset-2 mt-1">Read more</a>}
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* ════════ Speak with us today ════════ */}
                    <div className="relative overflow-hidden" style={{ minHeight: '420px' }}>
                        <img src="https://images.unsplash.com/photo-1618221195710-dd6b41faaea6?w=1600&h=700&fit=crop" alt="Luxury Interior" className="absolute inset-0 w-full h-full object-cover" loading="lazy" />
                        <div className="absolute inset-0" style={{ background: 'linear-gradient(to right, rgba(0,0,0,0.72) 0%, rgba(0,0,0,0.48) 55%, rgba(0,0,0,0.18) 100%)' }} />
                        <div className="relative flex flex-col lg:flex-row items-start lg:items-center justify-between gap-8 px-8 md:px-14 lg:px-20 py-14" style={{ minHeight: '420px' }}>
                            <div className="flex flex-col justify-center">
                                <h2 className="text-3xl md:text-4xl lg:text-[42px] font-bold text-white leading-tight">Speak with us today</h2>
                                <p className="text-white/55 mt-2 text-base">Please let us know how we can help</p>
                            </div>
                            <div className="w-full lg:w-[390px] flex-shrink-0">
                                <div className="bg-white/96 backdrop-blur-sm rounded-2xl p-6 shadow-2xl">
                                    <h3 className="text-lg font-bold text-[#1c1c1a] mb-5">Get a call back</h3>
                                    <div className="grid grid-cols-2 gap-3 mb-3">
                                        <div>
                                            <label className="text-xs font-medium text-warm-500 mb-1.5 block">First Name</label>
                                            <input type="text" placeholder="John" className="w-full px-3.5 py-3 rounded-xl border border-warm-200 text-sm focus:outline-none focus:border-warm-400 bg-[#FAFAF5]" />
                                        </div>
                                        <div>
                                            <label className="text-xs font-medium text-warm-500 mb-1.5 block">Last Name</label>
                                            <input type="text" placeholder="Dio" className="w-full px-3.5 py-3 rounded-xl border border-warm-200 text-sm focus:outline-none focus:border-warm-400 bg-[#FAFAF5]" />
                                        </div>
                                    </div>
                                    <div className="mb-3">
                                        <label className="text-xs font-medium text-warm-500 mb-1.5 block">Phone</label>
                                        <div className="flex gap-2">
                                            <div className="flex items-center gap-1.5 px-3 py-3 rounded-xl border border-warm-200 bg-[#FAFAF5] text-sm cursor-pointer flex-shrink-0">
                                                <span className="text-base leading-none">🇦🇪</span>
                                                <span className="text-driven-text font-medium text-sm">+971</span>
                                                <svg className="w-3 h-3 text-warm-400" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M19 9l-7 7-7-7" /></svg>
                                            </div>
                                            <input type="tel" placeholder="516156566" className="flex-1 min-w-0 px-3.5 py-3 rounded-xl border border-warm-200 text-sm focus:outline-none focus:border-warm-400 bg-[#FAFAF5]" />
                                        </div>
                                    </div>
                                    <div className="mb-5">
                                        <label className="text-xs font-medium text-warm-500 mb-1.5 block">Email ID</label>
                                        <input type="email" placeholder="John@gmail.com" className="w-full px-3.5 py-3 rounded-xl border border-warm-200 text-sm focus:outline-none focus:border-warm-400 bg-[#FAFAF5]" />
                                    </div>
                                    <button className="w-full py-3.5 bg-[#1c1c1a] text-white rounded-xl font-semibold text-sm hover:bg-black transition-colors">Submit</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* ════════ Footer ════════ */}
                    <footer className="bg-[#1c1c1a]">
                        <div className="max-w-7xl mx-auto px-6 py-5 flex flex-col md:flex-row items-center justify-between gap-3">
                            <div className="flex items-center gap-1.5 flex-shrink-0">
                                <span className="text-white font-bold text-base tracking-widest uppercase">DRIVEN</span>
                                <span className="text-white/40 text-[9px] tracking-[0.18em] uppercase self-end mb-0.5">Properties</span>
                            </div>
                            <div className="flex items-center flex-wrap justify-center gap-x-5 gap-y-1.5">
                                <span className="text-white/35 text-xs">© 2023 Driven Properties. All Rights Reserved.</span>
                                <a href="#" className="text-white/55 hover:text-white transition-colors text-xs">About Us</a>
                                <a href="#" className="text-white/55 hover:text-white transition-colors text-xs">Careers</a>
                                <a href="#" className="text-white/55 hover:text-white transition-colors text-xs">Privacy Policy</a>
                                <a href="#" className="flex items-center gap-1 text-white/55 hover:text-white transition-colors text-xs">Other <svg className="w-3 h-3" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M7 17L17 7M17 7H7M17 7v10" /></svg></a>
                            </div>
                        </div>
                    </footer>
                </div>
            );
        };
        // Detail Screen
        const DetailScreen = ({ project, onBack, onAddToWatchlist, inWatchlist, user, compareList = [], onAddToCompare, onSelectProject, onViewComparison, onClearCompare }) => {
            const [rentalIncome, setRentalIncome] = useState(120000);
            const [holdingPeriod, setHoldingPeriod] = useState(5);
            const [showImmersive, setShowImmersive] = useState(false);
            const [show3DTour, setShow3DTour] = useState(false);
            const [showVideoPlayer, setShowVideoPlayer] = useState(false);
            const videoRef = React.useRef(null);
            const [videoPlaying, setVideoPlaying] = React.useState(false);
            const [videoCurrentTime, setVideoCurrentTime] = React.useState(0);
            const [videoDuration, setVideoDuration] = React.useState(0);
            const [videoVolume, setVideoVolume] = React.useState(1);
            const [hoveredSimilar, setHoveredSimilar] = React.useState(null);
            const [currentFloorPlanPage, setCurrentFloorPlanPage] = React.useState(1);
            const [showEmailForm, setShowEmailForm] = React.useState(false);
            const [email, setEmail] = React.useState('');
            const [phone, setPhone] = React.useState('');
            const [openCalculator, setOpenCalculator] = React.useState('mortgage'); // 'mortgage' or 'roi'
            const [showAdvancedModal, setShowAdvancedModal] = React.useState(false);

            // Helper: rough number to words for display
            const numberToWords = (n) => {
                if (n >= 1000000) return `${(n / 1000000).toFixed(2)} million`;
                if (n >= 1000) {
                    const thousands = Math.floor(n / 1000);
                    const hundreds = n % 1000;
                    const wordsMap = { 1: 'One', 2: 'Two', 3: 'Three', 4: 'Four', 5: 'Five', 6: 'Six', 7: 'Seven', 8: 'Eight', 9: 'Nine', 10: 'Ten', 11: 'Eleven', 12: 'Twelve', 13: 'Thirteen', 14: 'Fourteen', 15: 'Fifteen', 16: 'Sixteen', 17: 'Seventeen', 18: 'Eighteen', 19: 'Nineteen', 20: 'Twenty', 30: 'Thirty', 40: 'Forty', 50: 'Fifty', 60: 'Sixty', 70: 'Seventy', 80: 'Eighty', 90: 'Ninety', 100: 'One hundred', 200: 'Two hundred', 300: 'Three hundred', 400: 'Four hundred', 500: 'Five hundred', 600: 'Six hundred', 700: 'Seven hundred', 760: 'Seven hundred sixty', 800: 'Eight hundred', 900: 'Nine hundred' };
                    return `${wordsMap[thousands] || thousands} thousand${hundreds > 0 ? ` ${wordsMap[hundreds] || hundreds}` : ''}`;
                }
                return n.toLocaleString();
            };
            const monthlyPaymentInWords = (n) => {
                if (n >= 4000 && n < 5000) return 'Four Thousand ' + (n > 4000 ? 'and ' + (n - 4000) : '') + ' Dirhams';
                if (n >= 3000 && n < 4000) return 'Three Thousand ' + (n > 3000 ? (n - 3000) + '' : '') + ' Dirhams';
                return n.toLocaleString() + ' Dirhams';
            };

            // Distance Calculator State
            const [selectedDestination, setSelectedDestination] = React.useState('custom');
            const [customDestination, setCustomDestination] = React.useState('');
            const [transportMode, setTransportMode] = React.useState('car');

            // Modal State
            const [activeModal, setActiveModal] = React.useState(null); // 'description', 'amenities', 'verification', etc.

            const destinations = {
                'DIFC': { distance: '8.5 km', car: '12 min', metro: '18 min', walk: '1h 45min', bike: '28 min' },
                'Dubai Airport': { distance: '15 km', car: '18 min', metro: '28 min', walk: '3h 10min', bike: '48 min' },
                'Dubai Mall': { distance: '12 km', car: '15 min', metro: '22 min', walk: '2h 30min', bike: '38 min' },
                'Downtown': { distance: '10 km', car: '14 min', metro: '20 min', walk: '2h 5min', bike: '32 min' },
                'Palm Jumeirah': { distance: '6 km', car: '10 min', metro: 'N/A', walk: '1h 15min', bike: '20 min' },
                'Business Bay': { distance: '9 km', car: '13 min', metro: '19 min', walk: '1h 50min', bike: '30 min' }
            };

            // Mortgage Calculator State
            const [downPaymentPercent, setDownPaymentPercent] = React.useState(20);
            const [loanYears, setLoanYears] = React.useState(25);
            const [interestRate, setInterestRate] = React.useState(3.75);

            // Mortgage Calculations
            const downPaymentAmount = (project.priceNum * downPaymentPercent) / 100;
            const loanAmount = project.priceNum - downPaymentAmount;
            const monthlyRate = interestRate / 100 / 12;
            const numberOfPayments = loanYears * 12;
            const monthlyPayment = (loanAmount * monthlyRate * Math.pow(1 + monthlyRate, numberOfPayments)) / (Math.pow(1 + monthlyRate, numberOfPayments) - 1);
            const totalInterest = (monthlyPayment * numberOfPayments) - loanAmount;

            const annualYield = ((rentalIncome / project.priceNum) * 100).toFixed(1);
            const totalReturn = (annualYield * holdingPeriod).toFixed(1);

            // Floor plan mock data - first 2 pages free, rest gated
            const floorPlanPages = [
                { id: 1, name: 'Ground Floor', image: 'https://images.unsplash.com/photo-1503387762-592deb58ef4e?w=800&h=600&fit=crop' },
                { id: 2, name: 'First Floor', image: 'https://images.unsplash.com/photo-1600607686527-6fb886090705?w=800&h=600&fit=crop' },
                { id: 3, name: 'Second Floor', image: 'https://images.unsplash.com/photo-1600566753086-00f18fb6b3ea?w=800&h=600&fit=crop', locked: true },
                { id: 4, name: 'Penthouse', image: 'https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?w=800&h=600&fit=crop', locked: true }
            ];

            // Extra interior images for the 2x2 grid
            const interiorImages = [
                'https://images.unsplash.com/photo-1600210492493-0946911123ea?w=600&h=400&fit=crop',
                'https://images.unsplash.com/photo-1600566753190-17f0baa2a6c3?w=600&h=400&fit=crop',
                'https://images.unsplash.com/photo-1631679706909-1844bbd07221?w=600&h=400&fit=crop',
                'https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?w=600&h=400&fit=crop',
            ];

            return (
                <div className="min-h-screen bg-cream-50" style={{ overflowX: 'clip' }}>

                    {/* Breadcrumb + Currency */}
                    <div className="bg-cream-50 px-4 md:px-6 py-3 max-w-[1400px] mx-auto">
                        <div className="flex items-center justify-between gap-2 min-w-0">
                            <div className="flex items-center gap-1.5 sm:gap-2 text-xs sm:text-sm text-warm-500 min-w-0 overflow-hidden">
                                <button onClick={onBack} className="flex items-center gap-1 hover:text-driven-text transition-colors flex-shrink-0">
                                    <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.5"><path d="M3 12h18M3 6h18M3 18h18" /></svg>
                                    Home
                                </button>
                                <span className="flex-shrink-0">/</span>
                                <button onClick={onBack} className="hover:text-driven-text transition-colors truncate hidden sm:inline">Properties for sale in Dubai</button>
                                <button onClick={onBack} className="hover:text-driven-text transition-colors truncate sm:hidden">Properties</button>
                                <span className="flex-shrink-0">/</span>
                                <span className="text-driven-text font-medium truncate max-w-[120px] sm:max-w-[200px] md:max-w-none">{project.name}</span>
                            </div>
                            <div className="flex items-center gap-1 border border-warm-300 rounded-full px-3 py-1.5 text-sm font-medium text-driven-text bg-white cursor-pointer hover:border-warm-400">
                                <svg className="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M19 9l-7 7-7-7" /></svg>
                                <Dhs className="text-sm" />
                            </div>
                        </div>
                    </div>
                    <div className="max-w-[1400px] mx-auto px-4 md:px-6 pb-0">
                        {/* Glass border wrapper — like search box */}
                        <div className="p-2 bg-white/15 backdrop-blur-md rounded-[2.25rem] border border-white/25 shadow-2xl">
                            <div className="bg-white rounded-[1.75rem] overflow-hidden">

                                {/* Hero Media — Video or Image Gallery */}
                                <div className="p-3">
                                    {showVideoPlayer ? (
                                        /* Inline Video Player */
                                        <div className="relative rounded-[1.25rem] overflow-hidden bg-black" style={{ height: '520px' }}>
                                            <video
                                                ref={videoRef}
                                                src="Property Video/Umm sequim Horizontal.drp.mp4"
                                                className="w-full h-full object-contain"
                                                onClick={() => {
                                                    if (videoRef.current) {
                                                        if (videoPlaying) { videoRef.current.pause(); } else { videoRef.current.play(); }
                                                        setVideoPlaying(!videoPlaying);
                                                    }
                                                }}
                                                onTimeUpdate={() => {
                                                    if (videoRef.current) setVideoCurrentTime(videoRef.current.currentTime);
                                                }}
                                                onLoadedMetadata={() => {
                                                    if (videoRef.current) setVideoDuration(videoRef.current.duration);
                                                }}
                                                onEnded={() => setVideoPlaying(false)}
                                            />

                                            {/* Top gradient + close */}
                                            <div className="absolute top-0 left-0 right-0 p-4 flex items-start justify-between bg-gradient-to-b from-black/50 to-transparent pointer-events-none">
                                                <div className="pointer-events-auto">
                                                    <h3 className="text-white text-base font-semibold">{project.name}</h3>
                                                    <p className="text-white/50 text-xs mt-0.5">{project.developer} • {project.location}</p>
                                                </div>
                                                <div className="flex items-center gap-2 pointer-events-auto">
                                                    <button className="w-9 h-9 bg-white/10 backdrop-blur-md rounded-full flex items-center justify-center hover:bg-white/20 transition-all text-white/70 hover:text-white">
                                                        <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.5">
                                                            <path strokeLinecap="round" strokeLinejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z" />
                                                        </svg>
                                                    </button>
                                                    <button className="w-9 h-9 bg-white/10 backdrop-blur-md rounded-full flex items-center justify-center hover:bg-white/20 transition-all text-white/70 hover:text-white">
                                                        <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.5">
                                                            <path strokeLinecap="round" strokeLinejoin="round" d="M7.217 10.907a2.25 2.25 0 100 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186l9.566-5.314m-9.566 7.5l9.566 5.314m0 0a2.25 2.25 0 103.935 2.186 2.25 2.25 0 00-3.935-2.186zm0-12.814a2.25 2.25 0 103.933-2.185 2.25 2.25 0 00-3.933 2.185z" />
                                                        </svg>
                                                    </button>
                                                    <button
                                                        onClick={() => { setShowVideoPlayer(false); setVideoPlaying(false); if (videoRef.current) { videoRef.current.pause(); videoRef.current.currentTime = 0; } }}
                                                        className="w-9 h-9 bg-white/10 backdrop-blur-md rounded-full flex items-center justify-center hover:bg-white/20 transition-all text-white/70 hover:text-white"
                                                    >
                                                        <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2">
                                                            <path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" />
                                                        </svg>
                                                    </button>
                                                </div>
                                            </div>

                                            {/* Center play button when paused */}
                                            {!videoPlaying && (
                                                <button
                                                    onClick={() => { if (videoRef.current) { videoRef.current.play(); setVideoPlaying(true); } }}
                                                    className="absolute inset-0 flex items-center justify-center z-10"
                                                >
                                                    <div className="w-16 h-16 bg-white/15 backdrop-blur-xl rounded-full flex items-center justify-center hover:bg-white/25 transition-all hover:scale-105">
                                                        <svg className="w-7 h-7 text-white ml-0.5" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z" /></svg>
                                                    </div>
                                                </button>
                                            )}

                                            {/* Bottom controls */}
                                            <div className="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-4 pt-10">
                                                {/* Progress bar */}
                                                <div className="relative w-full h-1 bg-white/20 rounded-full mb-3 cursor-pointer group"
                                                    onClick={(e) => {
                                                        if (videoRef.current && videoDuration) {
                                                            const rect = e.currentTarget.getBoundingClientRect();
                                                            const pct = (e.clientX - rect.left) / rect.width;
                                                            videoRef.current.currentTime = pct * videoDuration;
                                                            setVideoCurrentTime(pct * videoDuration);
                                                        }
                                                    }}
                                                >
                                                    <div className="absolute top-0 left-0 h-full bg-white rounded-full transition-all" style={{ width: `${videoDuration ? (videoCurrentTime / videoDuration) * 100 : 0}%` }} />
                                                    <div className="absolute top-1/2 -translate-y-1/2 w-3 h-3 bg-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity shadow-lg" style={{ left: `${videoDuration ? (videoCurrentTime / videoDuration) * 100 : 0}%`, transform: 'translate(-50%, -50%)' }} />
                                                </div>
                                                {/* Controls row */}
                                                <div className="flex items-center justify-between">
                                                    <div className="flex items-center gap-3">
                                                        <button onClick={() => { if (videoRef.current) { if (videoPlaying) { videoRef.current.pause(); } else { videoRef.current.play(); } setVideoPlaying(!videoPlaying); } }} className="text-white hover:text-white/80 transition-colors">
                                                            {videoPlaying ? (
                                                                <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z" /></svg>
                                                            ) : (
                                                                <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z" /></svg>
                                                            )}
                                                        </button>
                                                        <button onClick={() => { if (videoRef.current) videoRef.current.currentTime = Math.max(0, videoRef.current.currentTime - 10); }} className="text-white/60 hover:text-white transition-colors">
                                                            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.5"><path strokeLinecap="round" strokeLinejoin="round" d="M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3" /></svg>
                                                        </button>
                                                        <button onClick={() => { if (videoRef.current) videoRef.current.currentTime = Math.min(videoDuration, videoRef.current.currentTime + 10); }} className="text-white/60 hover:text-white transition-colors">
                                                            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.5"><path strokeLinecap="round" strokeLinejoin="round" d="M15 15l6-6m0 0l-6-6m6 6H9a6 6 0 000 12h3" /></svg>
                                                        </button>
                                                        <span className="text-white/50 text-xs font-medium tabular-nums">
                                                            {(() => { const fmt = (t) => { const m = Math.floor(t / 60); const s = Math.floor(t % 60); return `${m}:${s.toString().padStart(2, '0')}`; }; return `${fmt(videoCurrentTime)} / ${fmt(videoDuration)}`; })()}
                                                        </span>
                                                    </div>
                                                    <div className="flex items-center gap-2">
                                                        <div className="flex items-center gap-1.5 group/vol">
                                                            <button onClick={() => { const v = videoVolume === 0 ? 1 : 0; setVideoVolume(v); if (videoRef.current) videoRef.current.volume = v; }} className="text-white/60 hover:text-white transition-colors">
                                                                {videoVolume === 0 ? (
                                                                    <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.5"><path strokeLinecap="round" strokeLinejoin="round" d="M17.25 9.75L19.5 12m0 0l2.25 2.25M19.5 12l2.25-2.25M19.5 12l-2.25 2.25m-10.5-6l4.72-3.15a.75.75 0 011.28.53v13.74a.75.75 0 01-1.28.53l-4.72-3.15H4.51c-.88 0-1.704-.507-1.938-1.354A9.01 9.01 0 012.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75z" /></svg>
                                                                ) : (
                                                                    <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.5"><path strokeLinecap="round" strokeLinejoin="round" d="M19.114 5.636a9 9 0 010 12.728M16.463 8.288a5.25 5.25 0 010 7.424M6.75 8.25l4.72-3.15a.75.75 0 011.28.53v13.74a.75.75 0 01-1.28.53l-4.72-3.15H4.51c-.88 0-1.704-.507-1.938-1.354A9.01 9.01 0 012.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75z" /></svg>
                                                                )}
                                                            </button>
                                                            <input type="range" min="0" max="1" step="0.05" value={videoVolume} onChange={(e) => { const v = parseFloat(e.target.value); setVideoVolume(v); if (videoRef.current) videoRef.current.volume = v; }} className="w-16 h-1 accent-white opacity-0 group-hover/vol:opacity-100 transition-opacity cursor-pointer" />
                                                        </div>
                                                        <button onClick={() => { if (videoRef.current) { if (videoRef.current.requestFullscreen) videoRef.current.requestFullscreen(); else if (videoRef.current.webkitRequestFullscreen) videoRef.current.webkitRequestFullscreen(); } }} className="text-white/60 hover:text-white transition-colors">
                                                            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.5"><path strokeLinecap="round" strokeLinejoin="round" d="M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15" /></svg>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    ) : (
                                        /* Image Gallery (default) */
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-2 rounded-[1.25rem] overflow-hidden h-[280px] sm:h-[400px] md:h-[520px]">
                                            {/* Hero image left */}
                                            <div className="relative overflow-hidden rounded-l-[1.25rem]">
                                                <img src={project.image} alt={project.name} className="w-full h-full object-cover hover:scale-105 transition-transform duration-700 cursor-pointer" />
                                                <div className="absolute top-4 left-4 flex flex-wrap gap-2">
                                                    {project.offPlan && (
                                                        <span className="flex items-center gap-1.5 bg-white/90 backdrop-blur-sm text-driven-text px-3 py-1.5 rounded-lg text-xs font-semibold shadow-sm border border-white/50">
                                                            <svg className="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><rect x="3" y="3" width="18" height="18" rx="2" /><path d="M3 9h18M9 21V9" /></svg>
                                                            Off-plan
                                                        </span>
                                                    )}
                                                    {project.trending && (
                                                        <span className="flex items-center gap-1.5 bg-white/90 backdrop-blur-sm text-driven-text px-3 py-1.5 rounded-lg text-xs font-semibold shadow-sm border border-white/50">
                                                            🔥 Hot Deal
                                                        </span>
                                                    )}
                                                    {project.verified && (
                                                        <span className="flex items-center gap-1.5 bg-white/90 backdrop-blur-sm text-driven-text px-3 py-1.5 rounded-lg text-xs font-semibold shadow-sm border border-white/50">
                                                            <Icon name="verified" className="w-3.5 h-3.5 text-accent-gold" /> DLD Verified
                                                        </span>
                                                    )}
                                                </div>
                                                <button className="absolute bottom-4 right-4 w-9 h-9 bg-white/80 backdrop-blur-sm rounded-lg flex items-center justify-center hover:bg-white transition-all shadow-sm">
                                                    <svg className="w-4 h-4 text-driven-text" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7" /></svg>
                                                </button>
                                            </div>
                                            {/* Right 2x2 grid */}
                                            <div className="grid grid-cols-2 gap-2 h-full">
                                                {interiorImages.map((img, i) => (
                                                    <div key={i} className={`relative overflow-hidden ${i === 1 ? 'rounded-tr-[1.25rem]' : ''} ${i === 3 ? 'rounded-br-[1.25rem]' : ''}`}>
                                                        <img src={img} alt={`Interior ${i + 1}`} className="w-full h-full object-cover hover:scale-105 transition-transform duration-700 cursor-pointer" />
                                                        <div className="absolute bottom-2 left-2 opacity-30 pointer-events-none">
                                                            <span className="text-white text-xs font-bold tracking-wider">DRIVEN</span>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                </div>

                                {/* Title, Subtitle & Action Buttons — inside the same card */}
                                <div className="px-3 sm:px-5 pb-4 sm:pb-5 pt-2">
                                    <div className="flex flex-col md:flex-row md:items-center justify-between gap-3 sm:gap-4">
                                        {/* Left: name + tags */}
                                        <div className="min-w-0">
                                            <h1 className="text-xl sm:text-2xl md:text-[1.65rem] font-bold text-driven-text">{project.name}</h1>
                                            <p className="text-warm-500 text-xs sm:text-sm mt-1">
                                                {[project.furnished && 'Fully Furnished', 'Branded Developer', project.metro && 'Near Metro Station', project.trending && 'Hot Deal'].filter(Boolean).join(' | ')}
                                            </p>
                                        </div>
                                        {/* Right: action buttons */}
                                        <div className="flex items-center gap-1.5 sm:gap-2 flex-shrink-0 flex-wrap">
                                            <button onClick={() => { setShowVideoPlayer(true); }} className="flex items-center gap-1.5 sm:gap-2 border border-warm-300 bg-white rounded-full px-3 sm:px-4 py-2 sm:py-2.5 text-xs sm:text-sm font-medium text-driven-text hover:border-warm-400 hover:bg-cream-50 transition-all shadow-sm">
                                                <Icon name="play" className="w-3.5 h-3.5 sm:w-4 sm:h-4" /> Watch Video
                                            </button>
                                            <button onClick={() => setShow3DTour(true)} className="flex items-center gap-1.5 sm:gap-2 border border-warm-300 bg-white rounded-full px-3 sm:px-4 py-2 sm:py-2.5 text-xs sm:text-sm font-medium text-driven-text hover:border-warm-400 hover:bg-cream-50 transition-all shadow-sm">
                                                <Icon name="layers" className="w-3.5 h-3.5 sm:w-4 sm:h-4" /> 3D Tour
                                            </button>
                                            {/* Icon-only buttons */}
                                            <button
                                                onClick={(e) => { e.stopPropagation(); onAddToCompare && onAddToCompare(project); }}
                                                className={`w-9 h-9 sm:w-10 sm:h-10 border rounded-full flex items-center justify-center transition-all shadow-sm ${compareList && compareList.some(c => c.id === project.id) ? 'bg-amber-50 border-accent-gold text-accent-gold' : 'border-warm-300 bg-white text-warm-500 hover:border-warm-400 hover:text-driven-text'}`}
                                                title={compareList && compareList.some(c => c.id === project.id) ? "Remove from comparison" : "Add to compare"}
                                            >
                                                {compareList && compareList.some(c => c.id === project.id) ? (
                                                    <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2.5"><path strokeLinecap="round" strokeLinejoin="round" d="M5 13l4 4L19 7" /></svg>
                                                ) : (
                                                    <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path strokeLinecap="round" strokeLinejoin="round" d="M12 4v16m8-8H4" /></svg>
                                                )}
                                            </button>
                                            <button className="w-9 h-9 sm:w-10 sm:h-10 border border-warm-300 bg-white rounded-full flex items-center justify-center text-warm-500 hover:border-warm-400 hover:text-driven-text transition-all shadow-sm">
                                                <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M4 12v8a2 2 0 002 2h12a2 2 0 002-2v-8M16 6l-4-4-4 4M12 2v13" /></svg>
                                            </button>
                                            <button onClick={() => onAddToWatchlist(project)} className={`w-9 h-9 sm:w-10 sm:h-10 border rounded-full flex items-center justify-center transition-all shadow-sm ${inWatchlist ? 'bg-red-50 border-red-200 text-red-500' : 'border-warm-300 bg-white text-warm-400 hover:border-warm-400 hover:text-red-400'}`}>
                                                {inWatchlist ? <Icon name="heartFilled" className="w-4 h-4" /> : <Icon name="heart" className="w-4 h-4" />}
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-[1400px] mx-auto px-4 md:px-6 py-6">
                        <div className="grid lg:grid-cols-3 gap-8 items-start min-w-0">
                            {/* Main Content */}
                            <div className="lg:col-span-2 space-y-6 min-w-0 overflow-hidden">
                                {/* Key Metrics + About Property */}
                                <div className="bg-white rounded-2xl border border-white/30 shadow-[0_0_0_1.5px_rgba(255,255,255,0.35),0_2px_16px_rgba(0,0,0,0.07)] overflow-hidden min-w-0">

                                    {/* Key Metrics Row */}
                                    <div className="p-3 sm:p-4">
                                        <div className="grid grid-cols-3 md:grid-cols-6 border border-warm-200 rounded-xl overflow-hidden">
                                            {[
                                                { value: project.handover || 'Q3 2028', label: 'Handover' },
                                                { value: project.paymentPlan || '70/30', label: 'Payment Plan' },
                                                { value: `${project.progress || 50}%`, label: 'Completion' },
                                                { value: `${project.sqft} Sq.Ft`, label: 'Built Up Area' },
                                                { value: `${project.beds} BHK`, label: 'Unit' },
                                                { value: project.roi || '9.3%', label: 'Expected ROI', isHighlight: true }
                                            ].map((metric, i) => (
                                                <div key={i} className={`px-2 sm:px-3 py-3 sm:py-4 text-center min-w-0 ${i < 5 ? 'border-r border-warm-200' : ''} ${i < 3 ? 'border-b md:border-b-0 border-warm-200' : ''}`}>
                                                    <p className={`text-sm sm:text-base md:text-lg font-bold leading-tight truncate ${metric.isHighlight ? 'text-accent-green flex items-center justify-center gap-1' : 'text-driven-text'}`}>
                                                        {metric.isHighlight && (
                                                            <svg className="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2.5">
                                                                <path strokeLinecap="round" strokeLinejoin="round" d="M5 10l7-7m0 0l7 7m-7-7v18" />
                                                            </svg>
                                                        )}
                                                        {metric.value}
                                                    </p>
                                                    <p className="text-xs text-warm-500 mt-1">{metric.label}</p>
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Description */}
                                    <div className="px-4 sm:px-6 pb-4 sm:pb-6">
                                        <p className="text-warm-700 text-[15px] leading-relaxed">
                                            The Sponsor acquired the site in May 2022 at a compelling land basis of AED 77k/unit or AED 10M/acre, which is substantially lower than a similar site in {project.location} recently listed for AED 48M/acre. The Project also offers the potential return of capital in Years 3-4 upon the refinance of a low-leverage constructi...
                                        </p>
                                        <button
                                            onClick={() => setActiveModal('description')}
                                            className="text-blue-600 font-medium hover:text-blue-800 mt-3 text-sm underline underline-offset-2 transition-colors"
                                        >
                                            Read more
                                        </button>
                                    </div>
                                </div>
                                {/* What Comes With Your Home */}
                                <div className="bg-white rounded-2xl p-4 sm:p-6 border border-white/30 shadow-[0_0_0_1.5px_rgba(255,255,255,0.35),0_2px_16px_rgba(0,0,0,0.07)] overflow-hidden min-w-0">
                                    <h2 className="text-xl md:text-2xl font-bold text-driven-text mb-2">What Comes With Your Home</h2>
                                    <p className="text-warm-500 text-sm mb-4 sm:mb-6">This isn't just another apartment, it's a {project.sqft} sq ft waterfront sanctuary designed for those who refuse to compromise.</p>

                                    <div className="grid md:grid-cols-2 gap-4">
                                        {/* Building Amenities */}
                                        <div className="border border-warm-200 rounded-xl p-5">
                                            <h3 className="font-bold text-driven-text mb-4">Building Amenities</h3>
                                            <ul className="space-y-3.5">
                                                {['Basement Parking', 'Rooftop Garden', 'Ground Floor Lobby', 'Fitness Center', 'Swimming Pool', 'Business Lounge', 'Conference Room', "Children's Play Area"].map(amenity => (
                                                    <li key={amenity} className="flex items-center gap-3 text-warm-700 text-sm">
                                                        <svg className="w-5 h-5 text-warm-300 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.5">
                                                            <path strokeLinecap="round" strokeLinejoin="round" d="M9 12l2 2 4-4" />
                                                            <circle cx="12" cy="12" r="9" />
                                                        </svg>
                                                        <span>{amenity}</span>
                                                    </li>
                                                ))}
                                            </ul>
                                        </div>

                                        {/* Unit Features */}
                                        <div className="border border-warm-200 rounded-xl p-5">
                                            <h3 className="font-bold text-driven-text mb-4">Unit Features</h3>
                                            <ul className="space-y-3.5">
                                                {['Marina View', 'Fully Furnished', 'Balcony', 'Ocean Breeze', 'Modern Kitchen', 'Gym Access', 'Pet Friendly', 'High-Speed Internet'].map(feature => (
                                                    <li key={feature} className="flex items-center gap-3 text-warm-700 text-sm">
                                                        <svg className="w-5 h-5 text-warm-300 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.5">
                                                            <path strokeLinecap="round" strokeLinejoin="round" d="M9 12l2 2 4-4" />
                                                            <circle cx="12" cy="12" r="9" />
                                                        </svg>
                                                        <span>{feature}</span>
                                                    </li>
                                                ))}
                                            </ul>
                                        </div>
                                    </div>

                                    <button
                                        onClick={() => setActiveModal('amenities')}
                                        className="mt-5 w-full py-3 border border-warm-300 text-driven-text font-semibold rounded-full hover:bg-cream-50 transition-all flex items-center justify-center gap-2 text-sm"
                                    >
                                        View All 50+ Amenities
                                        <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path strokeLinecap="round" strokeLinejoin="round" d="M19 9l-7 7-7-7" /></svg>
                                    </button>
                                </div>
                                <div className="bg-white rounded-2xl p-4 sm:p-6 border border-white/30 shadow-[0_0_0_1.5px_rgba(255,255,255,0.35),0_2px_16px_rgba(0,0,0,0.07)] overflow-hidden min-w-0">
                                    <h2 className="text-xl font-bold text-driven-text mb-5">Verified &amp; Certified</h2>

                                    {/* Row 1: Escrow Bank · Developer · RERA Registration */}
                                    <div className="grid grid-cols-2 sm:grid-cols-3 gap-2 sm:gap-3 mb-2 sm:mb-3">
                                        {/* Escrow Bank */}
                                        <div className="border border-white/30 shadow-[0_0_0_1px_rgba(255,255,255,0.3),0_1px_8px_rgba(0,0,0,0.06)] rounded-2xl p-3 sm:p-4 flex flex-col gap-2 min-w-0">
                                            <p className="text-xs text-warm-400">Escrow Bank</p>
                                            <div className="flex items-center justify-between gap-1 sm:gap-2 min-w-0">
                                                <div className="flex items-center gap-1.5 sm:gap-2 min-w-0">
                                                    {/* bank icon */}
                                                    <svg className="flex-shrink-0" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#a8a29e" strokeWidth="1.5"><path d="M3 10h18M3 14h18M4 6l8-3 8 3M4 18v-8M20 18v-8M9 18v-8M15 18v-8M3 18h18" /></svg>
                                                    <span className="font-bold text-driven-text text-xs sm:text-sm truncate">{project.escrowBank}</span>
                                                </div>
                                                <div className="w-8 h-8 sm:w-9 sm:h-9 rounded-lg bg-warm-100 flex items-center justify-center flex-shrink-0 hidden sm:flex">
                                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#78716c" strokeWidth="1.4"><rect x="3" y="10" width="18" height="10" rx="1" /><path d="M12 3L3 10h18L12 3z" /><path d="M8 14v4M12 14v4M16 14v4" /></svg>
                                                </div>
                                            </div>
                                        </div>
                                        <div className="border border-white/30 shadow-[0_0_0_1px_rgba(255,255,255,0.3),0_1px_8px_rgba(0,0,0,0.06)] rounded-2xl p-3 sm:p-4 flex flex-col gap-2 min-w-0">
                                            <p className="text-xs text-warm-400">Developer</p>
                                            <div className="flex items-center justify-between gap-1 sm:gap-2 min-w-0">
                                                <div className="flex items-center gap-1.5 sm:gap-2 min-w-0">
                                                    <svg className="flex-shrink-0" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#a8a29e" strokeWidth="1.5"><rect x="4" y="2" width="16" height="20" rx="1" /><path d="M9 7h6M9 11h6M9 15h4" /></svg>
                                                    <span className="font-bold text-driven-text text-xs sm:text-sm truncate">{project.developer}</span>
                                                </div>
                                                <div className="w-8 h-8 sm:w-9 sm:h-9 rounded-lg bg-warm-100 flex items-center justify-center flex-shrink-0 hidden sm:flex">
                                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#78716c" strokeWidth="1.2"><circle cx="12" cy="12" r="3" />{[0, 45, 90, 135, 180, 225, 270, 315].map(a => { const r = a * Math.PI / 180; const x1 = 12 + 5 * Math.cos(r); const y1 = 12 + 5 * Math.sin(r); const x2 = 12 + 9 * Math.cos(r); const y2 = 12 + 9 * Math.sin(r); return <line key={a} x1={x1} y1={y1} x2={x2} y2={y2} /> })}</svg>
                                                </div>
                                            </div>
                                        </div>
                                        <div className="col-span-2 sm:col-span-1 border border-white/30 shadow-[0_0_0_1px_rgba(255,255,255,0.3),0_1px_8px_rgba(0,0,0,0.06)] rounded-2xl p-3 sm:p-4 flex flex-col gap-2 min-w-0">
                                            <p className="text-xs text-warm-400">RERA Registration</p>
                                            <div className="flex items-center gap-1.5 sm:gap-2 min-w-0">
                                                {/* shield-check icon */}
                                                <svg className="flex-shrink-0" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#a8a29e" strokeWidth="1.5"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" /><path d="m9 12 2 2 4-4" strokeLinecap="round" strokeLinejoin="round" /></svg>
                                                <span className="font-bold text-driven-text text-xs sm:text-sm font-mono truncate">{project.reraNo}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="grid grid-cols-2 sm:grid-cols-3 gap-2 sm:gap-3 mb-2 sm:mb-3">
                                        <div className="border border-white/30 shadow-[0_0_0_1px_rgba(255,255,255,0.3),0_1px_8px_rgba(0,0,0,0.06)] rounded-2xl p-3 sm:p-4 flex flex-col gap-2 min-w-0">
                                            <p className="text-xs text-warm-400">Permit Number</p>
                                            <div className="flex items-center gap-1.5 sm:gap-2 min-w-0">
                                                <svg className="flex-shrink-0" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#a8a29e" strokeWidth="1.5"><path d="M3 10h18M3 14h18M4 6l8-3 8 3M4 18v-8M20 18v-8M9 18v-8M15 18v-8M3 18h18" /></svg>
                                                <span className="font-bold text-driven-text text-xs sm:text-sm font-mono truncate">7145263850</span>
                                            </div>
                                        </div>
                                        <div className="border border-white/30 shadow-[0_0_0_1px_rgba(255,255,255,0.3),0_1px_8px_rgba(0,0,0,0.06)] rounded-2xl p-3 sm:p-4 flex flex-col gap-2 min-w-0">
                                            <p className="text-xs text-warm-400">DLD Permit</p>
                                            <div className="flex items-center gap-1.5 sm:gap-2 min-w-0">
                                                <svg className="flex-shrink-0" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#a8a29e" strokeWidth="1.5"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" /><path d="m9 12 2 2 4-4" strokeLinecap="round" strokeLinejoin="round" /></svg>
                                                <span className="font-bold text-driven-text text-xs sm:text-sm font-mono truncate">6501234567</span>
                                            </div>
                                        </div>
                                        <div className="col-span-2 sm:col-span-1 border border-white/30 shadow-[0_0_0_1px_rgba(255,255,255,0.3),0_1px_8px_rgba(0,0,0,0.06)] rounded-2xl p-3 sm:p-4 flex flex-col gap-2 min-w-0">
                                            <p className="text-xs text-warm-400">Verification ID</p>
                                            <div className="flex items-center gap-1.5 sm:gap-2 min-w-0">
                                                <svg className="flex-shrink-0" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#a8a29e" strokeWidth="1.5"><rect x="4" y="2" width="16" height="20" rx="1" /><path d="M9 7h6M9 11h6M9 15h4" /></svg>
                                                <span className="font-bold text-driven-text text-xs sm:text-sm font-mono truncate">V-{project.id}892341</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="border border-white/30 shadow-[0_0_0_1px_rgba(255,255,255,0.3),0_1px_8px_rgba(0,0,0,0.06)] rounded-2xl p-3 sm:p-4 flex items-center gap-3 sm:gap-5 min-w-0">
                                        {/* QR Code Image */}
                                        <div className="flex-shrink-0 w-16 h-16 sm:w-20 sm:h-20 rounded-xl overflow-hidden bg-white flex items-center justify-center">
                                            <img src="QR Code/QR Image Container.svg" alt="QR Code - Scan for permit details" className="w-full h-full object-contain" />
                                        </div>
                                        <div className="min-w-0">
                                            <p className="text-xs sm:text-sm text-warm-700 font-medium mb-2">Scan this QR code to view the permit details</p>
                                            <p className="text-xs text-warm-400 mb-0.5">Reference ID</p>
                                            <div className="flex items-center gap-2 min-w-0">
                                                <svg className="flex-shrink-0" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="#a8a29e" strokeWidth="1.5"><rect x="4" y="2" width="16" height="20" rx="1" /><path d="M9 7h6M9 11h6M9 15h4" /></svg>
                                                <span className="font-bold text-driven-text text-xs sm:text-sm font-mono truncate">DP-S-{project.id}6516</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {/* ── Mobile Calculator — 2nd section on mobile, hidden on desktop ── */}
                                <div className="lg:hidden bg-white rounded-2xl p-4 sm:p-5 border border-white/30 shadow-[0_0_0_1.5px_rgba(255,255,255,0.35),0_2px_16px_rgba(0,0,0,0.07)] overflow-hidden min-w-0">
                                    <div>
                                        <h3 className="text-lg font-bold text-driven-text mb-4">Check the numbers</h3>
                                        <div className="bg-cream-100 p-1 rounded-full flex mb-5">
                                            {['mortgage', 'roi', 'advanced'].map(tab => (
                                                <button
                                                    key={tab}
                                                    onClick={() => tab === 'advanced' ? setShowAdvancedModal(true) : setOpenCalculator(tab)}
                                                    className={`flex-1 py-2 px-3 rounded-full text-sm font-medium transition-all flex items-center justify-center gap-1.5 ${openCalculator === tab && tab !== 'advanced'
                                                        ? 'bg-white shadow text-driven-text'
                                                        : 'text-warm-500 hover:text-warm-700'
                                                        }`}
                                                >
                                                    {tab === 'advanced' && (
                                                        <svg className="w-3.5 h-3.5 text-accent-gold" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2">
                                                            <path d="M12 2l2.4 7.4H22l-6.2 4.5 2.4 7.4L12 17l-6.2 4.3 2.4-7.4L2 9.4h7.6z" />
                                                        </svg>
                                                    )}
                                                    {tab.charAt(0).toUpperCase() + tab.slice(1)}
                                                </button>
                                            ))}
                                        </div>
                                        {openCalculator === 'mortgage' && (
                                            <div className="space-y-5">
                                                <div>
                                                    <label className="text-sm font-medium text-driven-text block mb-3">Loan Amount</label>
                                                    <div className="flex items-center gap-2 mb-2">
                                                        <button onClick={() => setDownPaymentPercent(Math.min(50, downPaymentPercent + 5))} className="w-9 h-9 rounded-full border border-warm-300 flex items-center justify-center text-warm-700 hover:border-warm-500 transition-all flex-shrink-0">
                                                            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M12 5v14M5 12h14" /></svg>
                                                        </button>
                                                        <button onClick={() => setDownPaymentPercent(Math.max(10, downPaymentPercent - 5))} className="w-9 h-9 rounded-full border border-warm-300 flex items-center justify-center text-warm-700 hover:border-warm-500 transition-all flex-shrink-0">
                                                            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M5 12h14" /></svg>
                                                        </button>
                                                        <div className="flex-1 px-4 py-2.5 border border-warm-200 rounded-full text-right font-semibold text-driven-text bg-cream-50">
                                                            {Math.round(loanAmount).toLocaleString()}
                                                        </div>
                                                    </div>
                                                    <input type="range" min="10" max="50" step="5" value={downPaymentPercent} onChange={(e) => setDownPaymentPercent(Number(e.target.value))} className="w-full accent-warm-800" />
                                                    <p className="text-xs text-warm-500 text-right mt-1">{numberToWords(Math.round(loanAmount))} Dirhams</p>
                                                </div>
                                                <div>
                                                    <label className="text-sm font-medium text-driven-text block mb-3">Duration</label>
                                                    <div className="flex items-center gap-2 mb-2">
                                                        <button onClick={() => setLoanYears(Math.min(30, loanYears + 5))} className="w-9 h-9 rounded-full border border-warm-300 flex items-center justify-center text-warm-700 hover:border-warm-500 transition-all flex-shrink-0">
                                                            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M12 5v14M5 12h14" /></svg>
                                                        </button>
                                                        <button onClick={() => setLoanYears(Math.max(5, loanYears - 5))} className="w-9 h-9 rounded-full border border-warm-300 flex items-center justify-center text-warm-700 hover:border-warm-500 transition-all flex-shrink-0">
                                                            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M5 12h14" /></svg>
                                                        </button>
                                                        <div className="flex-1 px-4 py-2.5 border border-warm-200 rounded-full text-right font-semibold text-driven-text bg-cream-50">
                                                            {loanYears}
                                                        </div>
                                                    </div>
                                                    <input type="range" min="5" max="30" step="5" value={loanYears} onChange={(e) => setLoanYears(Number(e.target.value))} className="w-full accent-warm-800" />
                                                    <p className="text-xs text-warm-500 text-right mt-1">{loanYears === 1 ? 'One year' : loanYears === 5 ? 'Five years' : loanYears === 10 ? 'Ten years' : loanYears === 15 ? 'Fifteen years' : loanYears === 20 ? 'Twenty years' : loanYears === 25 ? 'Twenty five years' : 'Thirty years'}</p>
                                                </div>
                                                <div>
                                                    <label className="text-sm font-medium text-driven-text block mb-3">Annual Interest Rate (%)</label>
                                                    <div className="flex items-center gap-2 mb-2">
                                                        <button onClick={() => setInterestRate(Math.min(10, parseFloat((interestRate + 0.25).toFixed(2))))} className="w-9 h-9 rounded-full border border-warm-300 flex items-center justify-center text-warm-700 hover:border-warm-500 transition-all flex-shrink-0">
                                                            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M12 5v14M5 12h14" /></svg>
                                                        </button>
                                                        <button onClick={() => setInterestRate(Math.max(1, parseFloat((interestRate - 0.25).toFixed(2))))} className="w-9 h-9 rounded-full border border-warm-300 flex items-center justify-center text-warm-700 hover:border-warm-500 transition-all flex-shrink-0">
                                                            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M5 12h14" /></svg>
                                                        </button>
                                                        <div className="flex-1 px-4 py-2.5 border border-warm-200 rounded-full text-right font-semibold text-driven-text bg-cream-50">
                                                            {interestRate}%
                                                        </div>
                                                    </div>
                                                    <input type="range" min="1" max="10" step="0.25" value={interestRate} onChange={(e) => setInterestRate(Number(e.target.value))} className="w-full accent-warm-800" />
                                                </div>
                                                <div className="bg-cream-50 rounded-2xl p-4 border border-white/30 shadow-[0_0_0_1px_rgba(255,255,255,0.3),0_1px_8px_rgba(0,0,0,0.06)]">
                                                    <div className="flex items-center justify-between mb-1">
                                                        <span className="text-sm text-warm-500">Convert to</span>
                                                        <div className="flex items-center gap-1 bg-white border border-warm-200 rounded-full px-3 py-1 text-sm font-medium">
                                                            <svg className="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M19 9l-7 7-7-7" /></svg> <Dhs className="text-sm" />
                                                        </div>
                                                    </div>
                                                    <p className="text-3xl font-bold text-driven-text mt-2">
                                                        <Dhs className="text-2xl text-warm-400 mr-1" />
                                                        {Math.round(monthlyPayment).toLocaleString()} <span className="text-lg font-medium text-warm-500">/month*</span>
                                                    </p>
                                                    <p className="text-xs text-warm-500 mt-1">{monthlyPaymentInWords(Math.round(monthlyPayment))}</p>
                                                </div>
                                                <button className="w-full bg-driven-text text-white py-3.5 rounded-full font-semibold flex items-center justify-center gap-2 hover:bg-warm-700 transition-all">
                                                    <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg>
                                                    Secure this rate
                                                </button>
                                                <p className="text-xs text-warm-400 text-center">* Additional fee and processing charges may apply</p>
                                            </div>
                                        )}
                                        {openCalculator === 'roi' && (
                                            <div className="space-y-5">
                                                <div>
                                                    <label className="text-sm font-medium text-driven-text block mb-3">Annual Rent (AED)</label>
                                                    <div className="flex items-center gap-2 mb-2">
                                                        <button onClick={() => setRentalIncome(Math.min(200000, rentalIncome + 5000))} className="w-9 h-9 rounded-full border border-warm-300 flex items-center justify-center text-warm-700 hover:border-warm-500 transition-all flex-shrink-0">
                                                            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M12 5v14M5 12h14" /></svg>
                                                        </button>
                                                        <button onClick={() => setRentalIncome(Math.max(80000, rentalIncome - 5000))} className="w-9 h-9 rounded-full border border-warm-300 flex items-center justify-center text-warm-700 hover:border-warm-500 transition-all flex-shrink-0">
                                                            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M5 12h14" /></svg>
                                                        </button>
                                                        <div className="flex-1 px-4 py-2.5 border border-warm-200 rounded-full text-right font-semibold text-driven-text bg-cream-50">
                                                            {rentalIncome.toLocaleString()}
                                                        </div>
                                                    </div>
                                                    <input type="range" min="80000" max="200000" step="5000" value={rentalIncome} onChange={(e) => setRentalIncome(Number(e.target.value))} className="w-full accent-warm-800" />
                                                </div>
                                                <div>
                                                    <label className="text-sm font-medium text-driven-text block mb-3">Holding Period</label>
                                                    <div className="flex gap-2">
                                                        {[3, 5, 7, 10].map(y => (
                                                            <button key={y} onClick={() => setHoldingPeriod(y)} className={`flex-1 py-2.5 rounded-full text-sm font-medium transition-all border ${holdingPeriod === y ? 'bg-driven-text text-white border-driven-text' : 'bg-cream-50 text-warm-600 border-warm-200 hover:border-warm-400'}`}>
                                                                {y}y
                                                            </button>
                                                        ))}
                                                    </div>
                                                </div>
                                                <div className="bg-cream-50 rounded-2xl p-4 border border-white/30 shadow-[0_0_0_1px_rgba(255,255,255,0.3),0_1px_8px_rgba(0,0,0,0.06)] space-y-3">
                                                    <div className="flex justify-between items-center">
                                                        <span className="text-sm text-warm-600">Annual Yield</span>
                                                        <span className="text-2xl font-bold text-accent-gold">{annualYield}%</span>
                                                    </div>
                                                    <div className="w-full bg-warm-100 rounded-full h-2">
                                                        <div className="bg-accent-gold h-2 rounded-full" style={{ width: `${Math.min(100, annualYield * 10)}%` }}></div>
                                                    </div>
                                                    <div className="flex justify-between items-center pt-1 border-t border-warm-200">
                                                        <span className="text-sm text-warm-600">{holdingPeriod}-Year Total Return</span>
                                                        <span className="text-2xl font-bold text-accent-gold">{totalReturn}%</span>
                                                    </div>
                                                </div>
                                                <button className="w-full bg-driven-text text-white py-3.5 rounded-full font-semibold flex items-center justify-center gap-2 hover:bg-warm-700 transition-all">
                                                    <Icon name="calculator" className="w-5 h-5" />
                                                    Get Full ROI Report
                                                </button>
                                                <p className="text-xs text-warm-400 text-center">* Estimates based on current market data</p>
                                            </div>
                                        )}
                                    </div>
                                </div>

                                {/* Construction Progress — Illustrated Timeline */}
                                <div className="bg-white rounded-2xl border border-white/30 shadow-[0_0_0_1.5px_rgba(255,255,255,0.35),0_2px_16px_rgba(0,0,0,0.07)] overflow-hidden min-w-0">
                                    <div className="p-4 sm:p-6 pb-0">
                                        <h2 className="text-xl md:text-2xl font-bold text-driven-text mb-4 sm:mb-6">Construction Progress</h2>

                                        {/* Milestone Icons Row */}
                                        <div className="flex items-end justify-between mb-4 sm:mb-6 px-0 sm:px-2 gap-1">
                                            {(() => {
                                                const milestoneIcons = [
                                                    'Progress Icons/Icon.svg',
                                                    'Progress Icons/Icon-1.svg',
                                                    'Progress Icons/Icon-2.svg',
                                                    'Progress Icons/Icon-3.svg',
                                                    'Progress Icons/Icon-4.svg'
                                                ];
                                                return project.milestones.map((m, i) => (
                                                    <div key={i} className="flex flex-col items-center text-center flex-1 min-w-0">
                                                        {/* Icon with checkmark */}
                                                        <div className="relative mb-2 sm:mb-3">
                                                            <div className={`w-10 h-10 sm:w-16 sm:h-16 md:w-20 md:h-20 rounded-full flex items-center justify-center overflow-hidden ${m.completed ? '' : 'opacity-40 grayscale'}`}>
                                                                <img
                                                                    src={milestoneIcons[i] || milestoneIcons[0]}
                                                                    alt={m.name}
                                                                    className="w-full h-full object-contain"
                                                                />
                                                            </div>
                                                            {/* Green checkmark badge */}
                                                            {m.completed && (
                                                                <div className="absolute -top-0.5 -right-0.5 w-4 h-4 sm:w-5 sm:h-5 md:w-6 md:h-6 bg-emerald-500 rounded-full flex items-center justify-center shadow-sm border-2 border-white">
                                                                    <svg className="w-2.5 h-2.5 sm:w-3 sm:h-3 md:w-3.5 md:h-3.5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="3">
                                                                        <path strokeLinecap="round" strokeLinejoin="round" d="M5 13l4 4L19 7" />
                                                                    </svg>
                                                                </div>
                                                            )}
                                                        </div>
                                                        {/* Label */}
                                                        <p className={`text-[10px] sm:text-xs md:text-sm font-semibold leading-tight ${m.completed ? 'text-driven-text' : 'text-warm-400'}`}>{m.name}</p>
                                                        <p className={`text-[10px] sm:text-xs mt-0.5 ${m.completed ? 'text-warm-600' : 'text-warm-300'}`}>{m.date}</p>
                                                    </div>
                                                ));
                                            })()}
                                        </div>

                                        {/* Progress Bar */}
                                        <div className="mb-3">
                                            <div className="h-2.5 bg-warm-100 rounded-full overflow-hidden">
                                                <div className="h-full bg-emerald-500 rounded-full transition-all duration-500" style={{ width: `${project.progress}%` }} />
                                            </div>
                                        </div>

                                        {/* Current Stage + Percentage */}
                                        <div className="flex items-center justify-between pb-6">
                                            <p className="text-sm text-warm-500">Current: <span className="font-bold text-driven-text">{project.stage}</span></p>
                                            <p className="text-sm text-warm-500"><span className="font-bold text-driven-text">{project.progress}%</span> complete</p>
                                        </div>
                                    </div>

                                    {/* Email Subscribe Section */}
                                    <div className="bg-cream-50 border-t border-warm-200 px-4 sm:px-6 py-4 sm:py-5">
                                        <div className="flex flex-col sm:flex-row items-start sm:items-center gap-3 sm:gap-4">
                                            {/* Subscribe Illustration */}
                                            <div className="flex-shrink-0 -mt-8 -mb-2 hidden md:block">
                                                <img src="Progress Icons/Subscribe Illustration.svg" alt="Subscribe" className="w-20 h-20 object-contain" />
                                            </div>
                                            {/* Input + Button */}
                                            <div className="flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-3 flex-1 w-full min-w-0">
                                                <div className="flex-1 min-w-0">
                                                    <input
                                                        type="email"
                                                        value={email}
                                                        onChange={(e) => setEmail(e.target.value)}
                                                        placeholder="enter your email for exclusive updates"
                                                        className="w-full px-4 py-3 bg-white border border-warm-200 rounded-full text-sm text-driven-text placeholder-warm-400 focus:outline-none focus:border-warm-400 focus:shadow-sm transition-all"
                                                    />
                                                </div>
                                                <button
                                                    onClick={() => { if (email) { setShowEmailForm(false); setEmail(''); } }}
                                                    className="flex items-center justify-center gap-2 px-5 py-3 border-2 border-driven-text rounded-full text-sm font-semibold text-driven-text hover:bg-driven-text hover:text-white transition-all flex-shrink-0"
                                                >
                                                    <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2">
                                                        <path strokeLinecap="round" strokeLinejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                                    </svg>
                                                    Subscribe
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {/* Distance Calculator — Redesigned */}
                                <div className="bg-white rounded-2xl p-4 sm:p-5 md:p-6 border border-white/30 shadow-[0_0_0_1.5px_rgba(255,255,255,0.35),0_2px_16px_rgba(0,0,0,0.07)] overflow-hidden min-w-0">
                                    <h2 className="text-xl md:text-2xl font-bold text-driven-text mb-5">Distance Calculator</h2>

                                    {/* Destination Cards Grid — 3x2 */}
                                    {(() => {
                                        const destIcons = {
                                            'DIFC': <svg className="w-4 h-4 text-warm-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.5"><path d="M3 21h18M5 21V7l7-4 7 4v14M9 21v-4h6v4M9 9h.01M15 9h.01M9 13h.01M15 13h.01" /></svg>,
                                            'Dubai Airport': <svg className="w-4 h-4 text-warm-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.5"><path d="M12 19l-2 3m2-3l2 3m-2-3V2m-6.5 8.5L2 12l1.5 1.5M17.5 10.5L22 12l-1.5 1.5M5 10l7-2 7 2M5 14l7 2 7-2" /></svg>,
                                            'Dubai Mall': <svg className="w-4 h-4 text-warm-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.5"><rect x="3" y="3" width="18" height="18" rx="2" /><path d="M3 9h18M9 9v12M15 9v12M3 15h18" /></svg>,
                                            'Downtown': <svg className="w-4 h-4 text-warm-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.5"><path d="M3 21h18M9 21V3h6v18M3 21V10l6-7M21 21V10l-6-7" /></svg>,
                                            'Palm Jumeirah': <svg className="w-4 h-4 text-warm-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.5"><path d="M14 6c0-1.1-.9-2-2-2s-2 .9-2 2M8 14c-2.2 0-4-1.8-4-4s1.8-4 4-4M16 14c2.2 0 4-1.8 4-4s-1.8-4-4-4M12 4v16M8 20h8" /></svg>,
                                            'Business Bay': <svg className="w-4 h-4 text-warm-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.5"><path d="M3 21h18M5 21V8l4-5h6l4 5v13M9 21v-6h6v6M9 9h.01M15 9h.01M9 13h.01M15 13h.01" /></svg>
                                        };
                                        return (
                                            <div className="grid grid-cols-2 md:grid-cols-3 gap-2.5 mb-5">
                                                {Object.keys(destinations).map(loc => (
                                                    <button
                                                        key={loc}
                                                        onClick={() => { setSelectedDestination(loc); setCustomDestination(''); }}
                                                        className={`flex items-center gap-2.5 px-4 py-3.5 rounded-xl border transition-all ${selectedDestination === loc
                                                            ? 'border-warm-400 bg-cream-50 shadow-sm'
                                                            : 'border-warm-200 bg-white hover:border-warm-300'
                                                            }`}
                                                    >
                                                        {destIcons[loc]}
                                                        <span className="text-sm font-semibold text-driven-text flex-1 text-left">{loc}</span>
                                                        <span className="text-xs text-warm-400 font-medium">{destinations[loc].distance}</span>
                                                    </button>
                                                ))}
                                            </div>
                                        );
                                    })()}

                                    {/* Search Input with chip tags */}
                                    <div className="relative mb-5">
                                        <div className="flex items-center gap-2 w-full px-4 py-3 border border-warm-200 rounded-full bg-cream-50 focus-within:border-warm-400 focus-within:bg-white transition-all">
                                            <svg className="w-4 h-4 text-warm-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2">
                                                <path strokeLinecap="round" strokeLinejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                            </svg>
                                            {/* Show chip if a destination is selected */}
                                            {selectedDestination && selectedDestination !== 'custom' && (
                                                <span className="flex items-center gap-1.5 bg-white border border-warm-300 rounded-full px-3 py-1 text-sm font-medium text-driven-text flex-shrink-0">
                                                    {selectedDestination}
                                                    <button onClick={(e) => { e.stopPropagation(); setSelectedDestination('custom'); setCustomDestination(''); }} className="text-warm-400 hover:text-warm-600 transition-colors">
                                                        <svg className="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                                                    </button>
                                                </span>
                                            )}
                                            <input
                                                type="text"
                                                placeholder={selectedDestination && selectedDestination !== 'custom' ? '' : 'Search the location you want to calculate distance from'}
                                                value={customDestination}
                                                onChange={(e) => { setCustomDestination(e.target.value); setSelectedDestination('custom'); }}
                                                className="flex-1 bg-transparent text-sm text-driven-text placeholder-warm-400 outline-none"
                                            />
                                        </div>
                                    </div>

                                    {/* Results Row — shown when a destination is selected */}
                                    {selectedDestination && selectedDestination !== 'custom' && destinations[selectedDestination] && (
                                        <div className="bg-cream-50 rounded-2xl p-4 border border-warm-200">
                                            <div className="grid grid-cols-2 md:grid-cols-6 gap-2.5">
                                                {/* Distance To */}
                                                <div className="bg-white rounded-xl px-4 py-3 border border-warm-100 md:col-span-1">
                                                    <p className="text-[11px] text-warm-400 mb-0.5">Distance to</p>
                                                    <p className="text-sm font-bold text-driven-text flex items-center gap-1.5">
                                                        <svg className="w-3.5 h-3.5 text-warm-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.5"><path d="M3 21h18M5 21V7l7-4 7 4v14" /></svg>
                                                        {selectedDestination}
                                                    </p>
                                                </div>
                                                {/* Distance by road */}
                                                <div className="bg-white rounded-xl px-4 py-3 border border-warm-100 md:col-span-1">
                                                    <p className="text-[11px] text-warm-400 mb-0.5">Distance by road</p>
                                                    <p className="text-base font-bold text-driven-text">{destinations[selectedDestination].distance}</p>
                                                </div>
                                                {/* Travel modes */}
                                                {[
                                                    { key: 'car', label: 'Car', icon: <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.5"><path d="M5 17h14M5 17a2 2 0 01-2-2v-3a1 1 0 011-1l2-4h12l2 4a1 1 0 011 1v3a2 2 0 01-2 2M5 17a2 2 0 100 4 2 2 0 000-4zm14 0a2 2 0 100 4 2 2 0 000-4z" /></svg> },
                                                    { key: 'metro', label: 'Metro', icon: <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.5"><rect x="4" y="3" width="16" height="14" rx="2" /><path d="M4 10h16M8 21l2-4M16 21l-2-4M9 7h.01M15 7h.01" /></svg> },
                                                    { key: 'bike', label: 'Bike', icon: <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.5"><circle cx="5.5" cy="17.5" r="3.5" /><circle cx="18.5" cy="17.5" r="3.5" /><path d="M15 6a1 1 0 100-2 1 1 0 000 2zM12 17.5l2-7h3l2 7M5.5 17.5l3-7h4" /></svg> },
                                                    { key: 'walk', label: 'Walk', icon: <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.5"><circle cx="13" cy="4" r="2" /><path d="M13.5 7l2 8 3 3M11 22l1-5-3-3 .5-5M10 7l-3 8" /></svg> }
                                                ].map(mode => (
                                                    <div key={mode.key} className="bg-white rounded-xl px-4 py-3 border border-warm-100 text-center">
                                                        <div className="flex items-center justify-center gap-1.5 text-warm-400 mb-0.5">
                                                            {mode.icon}
                                                            <span className="text-[11px]">{mode.label}</span>
                                                        </div>
                                                        <p className="text-base font-bold text-driven-text">{destinations[selectedDestination][mode.key]}</p>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}

                                    {/* Custom search result */}
                                    {selectedDestination === 'custom' && customDestination && (
                                        <div className="bg-cream-50 rounded-2xl p-4 border border-warm-200">
                                            <div className="grid grid-cols-2 md:grid-cols-6 gap-2.5">
                                                <div className="bg-white rounded-xl px-4 py-3 border border-warm-100 md:col-span-1">
                                                    <p className="text-[11px] text-warm-400 mb-0.5">Distance to</p>
                                                    <p className="text-sm font-bold text-driven-text flex items-center gap-1.5">
                                                        <svg className="w-3.5 h-3.5 text-warm-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.5"><path d="M17.657 16.657L13.414 20.9a2 2 0 01-2.828 0l-4.243-4.243a8 8 0 1111.314 0z" /><path d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                                                        {customDestination}
                                                    </p>
                                                </div>
                                                <div className="bg-white rounded-xl px-4 py-3 border border-warm-100 md:col-span-1">
                                                    <p className="text-[11px] text-warm-400 mb-0.5">Distance by road</p>
                                                    <p className="text-base font-bold text-driven-text">--</p>
                                                </div>
                                                {['Car', 'Metro', 'Bike', 'Walk'].map(mode => (
                                                    <div key={mode} className="bg-white rounded-xl px-4 py-3 border border-warm-100 text-center">
                                                        <p className="text-[11px] text-warm-400 mb-0.5">{mode}</p>
                                                        <p className="text-base font-bold text-warm-300">--</p>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                </div>
                                <div className="bg-white rounded-2xl p-4 sm:p-6 border border-white/30 shadow-[0_0_0_1.5px_rgba(255,255,255,0.35),0_2px_16px_rgba(0,0,0,0.07)] overflow-hidden min-w-0">
                                    <h2 className="text-xl sm:text-2xl font-bold text-driven-text mb-4 sm:mb-6 flex items-center gap-2">
                                        <Icon name="map" className="w-6 h-6 text-accent-gold" /> Floor Plans
                                    </h2>

                                    {/* Current Floor Plan */}
                                    <div className="relative mb-6 rounded-xl overflow-hidden bg-cream-50 border border-warm-200">
                                        {floorPlanPages[currentFloorPlanPage - 1].locked ? (
                                            // Locked page - show blurred with gate
                                            <>
                                                <img
                                                    src={floorPlanPages[currentFloorPlanPage - 1].image}
                                                    alt={floorPlanPages[currentFloorPlanPage - 1].name}
                                                    className="w-full h-96 object-cover filter blur-md"
                                                />
                                                <div className="absolute inset-0 bg-gradient-to-t from-warm-900/95 via-warm-900/70 to-transparent flex items-center justify-center p-8">
                                                    <div className="text-center text-white max-w-md">
                                                        <svg className="w-16 h-16 mx-auto mb-4 opacity-90" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                                                        </svg>
                                                        <h3 className="text-xl font-bold mb-2">View Complete Floor Plans</h3>
                                                        <p className="text-white/90 mb-6">Get instant access to all floor plans + HD downloads</p>

                                                        {!showEmailForm ? (
                                                            <div className="space-y-3">
                                                                <button
                                                                    onClick={() => setShowEmailForm(true)}
                                                                    className="w-full px-6 py-3 bg-accent-gold text-white rounded-lg font-semibold hover:bg-accent-gold/90 transition-all"
                                                                >
                                                                    📧 Send via Email
                                                                </button>
                                                                <button className="w-full px-6 py-3 bg-white text-warm-800 rounded-lg font-semibold hover:bg-cream-50 transition-all">
                                                                    Sign Up for Instant Access
                                                                </button>
                                                            </div>
                                                        ) : (
                                                            // Email Form
                                                            <div className="bg-white/10 backdrop-blur-sm rounded-xl p-4 border border-white/20">
                                                                <div className="space-y-3">
                                                                    <input
                                                                        type="email"
                                                                        placeholder="Email address *"
                                                                        value={email}
                                                                        onChange={(e) => setEmail(e.target.value)}
                                                                        className="w-full px-4 py-3 rounded-lg bg-white text-warm-800 placeholder-warm-400 border border-warm-200"
                                                                    />
                                                                    <input
                                                                        type="tel"
                                                                        placeholder="Phone number (optional)"
                                                                        value={phone}
                                                                        onChange={(e) => setPhone(e.target.value)}
                                                                        className="w-full px-4 py-3 rounded-lg bg-white text-warm-800 placeholder-warm-400 border border-warm-200"
                                                                    />
                                                                    <button className="w-full px-6 py-3 bg-accent-gold text-white rounded-lg font-semibold hover:bg-accent-gold/90">
                                                                        Send Floor Plans
                                                                    </button>
                                                                    <button
                                                                        onClick={() => setShowEmailForm(false)}
                                                                        className="w-full text-white/80 text-sm hover:text-white"
                                                                    >
                                                                        Cancel
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            </>
                                        ) : (
                                            // Free page - show normally
                                            <img
                                                src={floorPlanPages[currentFloorPlanPage - 1].image}
                                                alt={floorPlanPages[currentFloorPlanPage - 1].name}
                                                className="w-full h-96 object-cover"
                                            />
                                        )}
                                    </div>
                                    <div className="flex items-center justify-between mb-4">
                                        <div>
                                            <h3 className="font-bold text-driven-text">{floorPlanPages[currentFloorPlanPage - 1].name}</h3>
                                            <p className="text-sm text-warm-500">Page {currentFloorPlanPage} of {floorPlanPages.length}</p>
                                        </div>
                                        <div className="flex items-center gap-2">
                                            <button
                                                onClick={() => setCurrentFloorPlanPage(Math.max(1, currentFloorPlanPage - 1))}
                                                disabled={currentFloorPlanPage === 1}
                                                className="p-2 rounded-lg border border-warm-200 hover:bg-cream-50 disabled:opacity-40 disabled:cursor-not-allowed"
                                            >
                                                <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                                                </svg>
                                            </button>
                                            <button
                                                onClick={() => setCurrentFloorPlanPage(Math.min(floorPlanPages.length, currentFloorPlanPage + 1))}
                                                disabled={currentFloorPlanPage === floorPlanPages.length}
                                                className="p-2 rounded-lg border border-warm-200 hover:bg-cream-50 disabled:opacity-40 disabled:cursor-not-allowed"
                                            >
                                                <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
                                                </svg>
                                            </button>
                                        </div>
                                    </div>
                                    <div className="grid grid-cols-4 gap-3">
                                        {floorPlanPages.map((page, idx) => (
                                            <button
                                                key={page.id}
                                                onClick={() => setCurrentFloorPlanPage(idx + 1)}
                                                className={`relative aspect-video rounded-lg overflow-hidden border-2 transition-all ${currentFloorPlanPage === idx + 1 ? 'border-accent-gold' : 'border-warm-200 hover:border-warm-300'}`}
                                            >
                                                <img
                                                    src={page.image}
                                                    alt={page.name}
                                                    className={`w-full h-full object-cover ${page.locked ? 'filter blur-sm' : ''}`}
                                                />
                                                {page.locked && (
                                                    <div className="absolute inset-0 bg-warm-900/60 flex items-center justify-center">
                                                        <svg className="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                                                        </svg>
                                                    </div>
                                                )}
                                                <div className="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2">
                                                    <p className="text-white text-xs font-medium text-center">{page.name}</p>
                                                </div>
                                            </button>
                                        ))}
                                    </div>
                                </div>
                                {false && <div className="bg-white rounded-2xl p-6 border border-white/30 shadow-[0_0_0_1.5px_rgba(255,255,255,0.35),0_2px_16px_rgba(0,0,0,0.07)]">
                                    <h2 className="font-bold text-driven-text mb-4">Features / Amenities</h2>
                                    <div className="grid md:grid-cols-2 gap-6">
                                        <div>
                                            <h3 className="font-semibold text-driven-text mb-3 text-sm">Building Amenities</h3>
                                            <ul className="space-y-2">
                                                <li className="flex items-center gap-2 text-sm text-warm-600">
                                                    <Icon name="check" className="w-4 h-4 text-accent-gold" />
                                                    Swimming Pool
                                                </li>
                                                <li className="flex items-center gap-2 text-sm text-warm-600">
                                                    <Icon name="check" className="w-4 h-4 text-accent-gold" />
                                                    Gym / Health Club
                                                </li>
                                                <li className="flex items-center gap-2 text-sm text-warm-600">
                                                    <Icon name="check" className="w-4 h-4 text-accent-gold" />
                                                    Kids Play Area
                                                </li>
                                                <li className="flex items-center gap-2 text-sm text-warm-600">
                                                    <Icon name="check" className="w-4 h-4 text-accent-gold" />
                                                    24/7 Security
                                                </li>
                                                <li className="flex items-center gap-2 text-sm text-warm-600">
                                                    <Icon name="check" className="w-4 h-4 text-accent-gold" />
                                                    Covered Parking
                                                </li>
                                            </ul>
                                        </div>
                                        <div>
                                            <h3 className="font-semibold text-driven-text mb-3 text-sm">Unit Features</h3>
                                            <ul className="space-y-2">
                                                <li className="flex items-center gap-2 text-sm text-warm-600">
                                                    <Icon name="check" className="w-4 h-4 text-accent-gold" />
                                                    View of Water / Marina / Burj Al Arab
                                                </li>
                                                <li className="flex items-center gap-2 text-sm text-warm-600">
                                                    <Icon name="check" className="w-4 h-4 text-accent-gold" />
                                                    Fully Furnished
                                                </li>
                                                <li className="flex items-center gap-2 text-sm text-warm-600">
                                                    <Icon name="check" className="w-4 h-4 text-accent-gold" />
                                                    Balcony
                                                </li>
                                                <li className="flex items-center gap-2 text-sm text-warm-600">
                                                    <Icon name="check" className="w-4 h-4 text-accent-gold" />
                                                    Built-in Wardrobes
                                                </li>
                                                <li className="flex items-center gap-2 text-sm text-warm-600">
                                                    <Icon name="check" className="w-4 h-4 text-accent-gold" />
                                                    Central A/C
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>}

                                {/* Market Insights at a Glance */}
                                <div className="bg-white rounded-2xl p-6 border border-white/30 shadow-[0_0_0_1.5px_rgba(255,255,255,0.35),0_2px_16px_rgba(0,0,0,0.07)]">
                                    <h2 className="text-xl font-bold text-driven-text mb-5">Market insights at a glance</h2>
                                    <div className="grid md:grid-cols-2 gap-4">
                                        {/* Price Trend Card */}
                                        {(() => {
                                            const pricePts = [
                                                { v: 57, label: '2018' },
                                                { v: 55, label: '' },
                                                { v: 64, label: '2019' },
                                                { v: 64, label: '' },
                                                { v: 76, label: '2020' },
                                                { v: 77, label: '' },
                                                { v: 79, label: '2021' },
                                                { v: 78, label: '' },
                                                { v: 70, label: '2022' },
                                                { v: 69, label: '' },
                                                { v: 81, label: '2023' }
                                            ];
                                            const xLabels = ['2018', '2019', '2020', '2021', '2022', '2023'];
                                            const yLabels = [100, 80, 60, 40, 20, 0];
                                            const W = 340, H = 200, padL = 32, padR = 16, padT = 12, padB = 28;
                                            const chartW = W - padL - padR;
                                            const chartH = H - padT - padB;
                                            const toX = (i) => padL + (i / (pricePts.length - 1)) * chartW;
                                            const toY = (v) => padT + chartH - ((v / 100) * chartH);
                                            const lineD = pricePts.map((p, i) => `${i === 0 ? 'M' : 'L'}${toX(i)},${toY(p.v)}`).join(' ');
                                            const areaD = lineD + ` L${toX(pricePts.length - 1)},${padT + chartH} L${toX(0)},${padT + chartH} Z`;
                                            return (
                                                <div className="bg-warm-50 rounded-2xl p-5 border border-white/30 shadow-[0_0_0_1px_rgba(255,255,255,0.3),0_1px_8px_rgba(0,0,0,0.06)]">
                                                    <div className="flex items-center gap-2 mb-0.5">
                                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#a8a29e" strokeWidth="1.8"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17" /><polyline points="16 7 22 7 22 13" /></svg>
                                                        <span className="text-base font-bold text-driven-text">Price Trend</span>
                                                    </div>
                                                    <p className="text-xs text-warm-400 mb-3">Average listing price per sqft over time</p>
                                                    <svg viewBox={`0 0 ${W} ${H}`} width="100%" style={{ display: 'block', overflow: 'visible' }}>
                                                        {/* Y-axis labels + dotted grid lines */}
                                                        {yLabels.map((lbl, i) => {
                                                            const y = padT + (i / (yLabels.length - 1)) * chartH;
                                                            return (
                                                                <g key={lbl}>
                                                                    <text x={padL - 6} y={y + 4} textAnchor="end" fontSize="9" fill="#a8a29e">{lbl}</text>
                                                                    <line x1={padL} y1={y} x2={W - padR} y2={y} stroke="#d6d3d1" strokeWidth="0.5" strokeDasharray="3,3" />
                                                                </g>
                                                            );
                                                        })}
                                                        {/* Vertical grid lines at data labels */}
                                                        {xLabels.map((lbl, i) => {
                                                            const dataIdx = pricePts.findIndex(p => p.label === lbl);
                                                            const x = toX(dataIdx);
                                                            return (
                                                                <line key={lbl} x1={x} y1={padT} x2={x} y2={padT + chartH} stroke="#d6d3d1" strokeWidth="0.5" strokeDasharray="3,3" />
                                                            );
                                                        })}
                                                        {/* Area fill */}
                                                        <defs>
                                                            <linearGradient id="priceGrad" x1="0" y1="0" x2="0" y2="1">
                                                                <stop offset="0%" stopColor="#c8c4be" stopOpacity="0.45" />
                                                                <stop offset="100%" stopColor="#c8c4be" stopOpacity="0.05" />
                                                            </linearGradient>
                                                        </defs>
                                                        <path d={areaD} fill="url(#priceGrad)" />
                                                        {/* Line */}
                                                        <path d={lineD} fill="none" stroke="#3d3935" strokeWidth="1.8" strokeLinejoin="round" strokeLinecap="round" />
                                                        {/* Data points — only at labelled years */}
                                                        {pricePts.map((p, i) => p.label ? (
                                                            <g key={i}>
                                                                <circle cx={toX(i)} cy={toY(p.v)} r="5.5" fill="#e8e4de" stroke="#e8e4de" strokeWidth="1" />
                                                                <circle cx={toX(i)} cy={toY(p.v)} r="3" fill="#3d3935" />
                                                            </g>
                                                        ) : null)}
                                                        {/* X-axis labels */}
                                                        {xLabels.map((lbl, i) => {
                                                            const dataIdx = pricePts.findIndex(p => p.label === lbl);
                                                            return (
                                                                <text key={lbl} x={toX(dataIdx)} y={H - 4} textAnchor="middle" fontSize="9" fill="#a8a29e">{lbl}</text>
                                                            );
                                                        })}
                                                    </svg>
                                                    <div className="flex items-center justify-between mt-2">
                                                        <p className="text-xs text-warm-500">Current avg: <strong className="text-driven-text"><Dhs className="text-xs" /> 79M</strong></p>
                                                        <p className="text-xs font-semibold flex items-center gap-1" style={{ color: '#4caf7d' }}>
                                                            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17" /><polyline points="16 7 22 7 22 13" /></svg>
                                                            9.3% YTD
                                                        </p>
                                                    </div>
                                                </div>
                                            );
                                        })()}

                                        {/* Unit Volume Card */}
                                        {(() => {
                                            const volPts = [
                                                { v: 57, label: 'Q1' },
                                                { v: 55, label: '' },
                                                { v: 64, label: 'Q2' },
                                                { v: 65, label: '' },
                                                { v: 76, label: 'Q3' },
                                                { v: 79, label: '' },
                                                { v: 70, label: '' },
                                                { v: 91, label: 'Q4' }
                                            ];
                                            const xLabels = ['Q1', 'Q2', 'Q3', 'Q4'];
                                            const yLabels = [100, 80, 60, 40, 20, 0];
                                            const W = 340, H = 200, padL = 32, padR = 16, padT = 12, padB = 28;
                                            const chartW = W - padL - padR;
                                            const chartH = H - padT - padB;
                                            const toX = (i) => padL + (i / (volPts.length - 1)) * chartW;
                                            const toY = (v) => padT + chartH - ((v / 100) * chartH);
                                            const lineD = volPts.map((p, i) => `${i === 0 ? 'M' : 'L'}${toX(i)},${toY(p.v)}`).join(' ');
                                            const areaD = lineD + ` L${toX(volPts.length - 1)},${padT + chartH} L${toX(0)},${padT + chartH} Z`;
                                            const labelledIndices = volPts.reduce((acc, p, i) => { if (p.label) acc.push(i); return acc; }, []);
                                            return (
                                                <div className="bg-warm-50 rounded-2xl p-5 border border-white/30 shadow-[0_0_0_1px_rgba(255,255,255,0.3),0_1px_8px_rgba(0,0,0,0.06)]">
                                                    <div className="flex items-center gap-2 mb-0.5">
                                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#a8a29e" strokeWidth="1.8"><rect x="2" y="7" width="4" height="14" /><rect x="10" y="3" width="4" height="18" /><rect x="18" y="10" width="4" height="11" /></svg>
                                                        <span className="text-base font-bold text-driven-text">Unit Volume</span>
                                                    </div>
                                                    <p className="text-xs text-warm-400 mb-3">Units sold per quarter in 2024</p>
                                                    <svg viewBox={`0 0 ${W} ${H}`} width="100%" style={{ display: 'block', overflow: 'visible' }}>
                                                        {/* Y-axis labels + dotted grid lines */}
                                                        {yLabels.map((lbl, i) => {
                                                            const y = padT + (i / (yLabels.length - 1)) * chartH;
                                                            return (
                                                                <g key={lbl}>
                                                                    <text x={padL - 6} y={y + 4} textAnchor="end" fontSize="9" fill="#a8a29e">{lbl}</text>
                                                                    <line x1={padL} y1={y} x2={W - padR} y2={y} stroke="#d6d3d1" strokeWidth="0.5" strokeDasharray="3,3" />
                                                                </g>
                                                            );
                                                        })}
                                                        {/* Vertical grid lines at quarter labels */}
                                                        {labelledIndices.map((dataIdx) => (
                                                            <line key={dataIdx} x1={toX(dataIdx)} y1={padT} x2={toX(dataIdx)} y2={padT + chartH} stroke="#d6d3d1" strokeWidth="0.5" strokeDasharray="3,3" />
                                                        ))}
                                                        {/* Area fill */}
                                                        <defs>
                                                            <linearGradient id="volGrad" x1="0" y1="0" x2="0" y2="1">
                                                                <stop offset="0%" stopColor="#c8c4be" stopOpacity="0.45" />
                                                                <stop offset="100%" stopColor="#c8c4be" stopOpacity="0.05" />
                                                            </linearGradient>
                                                        </defs>
                                                        <path d={areaD} fill="url(#volGrad)" />
                                                        {/* Line */}
                                                        <path d={lineD} fill="none" stroke="#3d3935" strokeWidth="1.8" strokeLinejoin="round" strokeLinecap="round" />
                                                        {/* Data points — only at labelled quarters */}
                                                        {volPts.map((p, i) => p.label ? (
                                                            <g key={i}>
                                                                <circle cx={toX(i)} cy={toY(p.v)} r="5.5" fill="#e8e4de" stroke="#e8e4de" strokeWidth="1" />
                                                                <circle cx={toX(i)} cy={toY(p.v)} r="3" fill="#3d3935" />
                                                            </g>
                                                        ) : null)}
                                                        {/* X-axis labels */}
                                                        {volPts.map((p, i) => p.label ? (
                                                            <text key={i} x={toX(i)} y={H - 4} textAnchor="middle" fontSize="9" fill="#a8a29e">{p.label}</text>
                                                        ) : null)}
                                                    </svg>
                                                    <div className="flex items-center justify-between mt-2">
                                                        <p className="text-xs text-warm-500">Total units sold: <strong className="text-driven-text">95 units</strong></p>
                                                        <p className="text-xs font-semibold flex items-center gap-1" style={{ color: '#4caf7d' }}>
                                                            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17" /><polyline points="16 7 22 7 22 13" /></svg>
                                                            19.4% YoY
                                                        </p>
                                                    </div>
                                                </div>
                                            );
                                        })()}
                                    </div>
                                </div>
                                {(() => {
                                    const items = [
                                        {
                                            id: 'neighborhood',
                                            title: 'Neighborhood Insights',
                                            body: 'Our RERA-certified brokers offer unparalleled insights into Palm Jumeirah and Dubai, ensuring you find a property that aligns with your aspirations.'
                                        },
                                        {
                                            id: 'portfolio',
                                            title: 'Extensive Property Portfolio',
                                            body: 'From luxurious waterfront apartments to high-end penthouses, discover a wide array of exclusive listings at AVA, tailored to meet diverse preferences.'
                                        },
                                        {
                                            id: 'privacy',
                                            title: 'Privacy Guaranteed',
                                            body: 'We ensure the highest standards of discretion and security, providing a safe and confidential environment for all your real estate transactions.'
                                        },
                                        {
                                            id: 'endorsed',
                                            title: 'Endorsed by Emaar and Discerning Clients',
                                            body: 'Join a community of satisfied homeowners and investors who trust our expertise in delivering exceptional properties and personalized service.'
                                        },
                                        {
                                            id: 'gateway',
                                            title: 'Your Gateway to Premier Properties with Driven Properties',
                                            body: 'Benefit from our extensive network and market knowledge to secure the best deals on off-plan and ready properties at AVA and beyond.'
                                        }
                                    ];
                                    const [openItems, setOpenItems] = React.useState(items.map(i => i.id));
                                    const allExpanded = openItems.length === items.length;
                                    const toggleItem = (id) => setOpenItems(prev => prev.includes(id) ? prev.filter(x => x !== id) : [...prev, id]);
                                    const expandAll = () => setOpenItems(items.map(i => i.id));
                                    const collapseAll = () => setOpenItems([]);
                                    return (
                                        <div className="bg-white rounded-2xl p-6 border border-white/30 shadow-[0_0_0_1.5px_rgba(255,255,255,0.35),0_2px_16px_rgba(0,0,0,0.07)]">
                                            {/* Header */}
                                            <div className="flex items-center justify-between mb-6">
                                                <h2 className="text-xl font-bold text-driven-text">What sets us apart</h2>
                                                <div className="flex items-center gap-2">
                                                    <button
                                                        onClick={collapseAll}
                                                        className="px-4 py-2 rounded-full border border-warm-200 text-sm font-semibold text-driven-text hover:bg-warm-50 transition-colors"
                                                    >
                                                        Collapse All
                                                    </button>
                                                    <button
                                                        onClick={expandAll}
                                                        className="px-4 py-2 rounded-full border border-warm-200 text-sm font-semibold text-driven-text hover:bg-warm-50 transition-colors"
                                                    >
                                                        Expand All
                                                    </button>
                                                </div>
                                            </div>
                                            <div className="space-y-3">
                                                {items.map((item) => {
                                                    const isOpen = openItems.includes(item.id);
                                                    return (
                                                        <div key={item.id} className="border border-white/30 shadow-[0_0_0_1px_rgba(255,255,255,0.3),0_1px_8px_rgba(0,0,0,0.06)] rounded-2xl overflow-hidden">
                                                            {/* Row */}
                                                            <button
                                                                onClick={() => toggleItem(item.id)}
                                                                className="w-full flex items-center gap-3 px-5 py-4 text-left hover:bg-warm-50/50 transition-colors"
                                                            >
                                                                {/* Chevron */}
                                                                <svg
                                                                    width="18" height="18" viewBox="0 0 24 24" fill="none"
                                                                    stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"
                                                                    className="flex-shrink-0 text-driven-text transition-transform duration-200"
                                                                    style={{ transform: isOpen ? 'rotate(0deg)' : 'rotate(180deg)' }}
                                                                >
                                                                    <polyline points="18 15 12 9 6 15" />
                                                                </svg>
                                                                <span className="text-base font-semibold text-driven-text">{item.title}</span>
                                                            </button>
                                                            {/* Body */}
                                                            {isOpen && (
                                                                <div className="px-5 pb-4">
                                                                    <div className="bg-warm-50 rounded-xl px-5 py-4">
                                                                        <p className="text-sm text-warm-700 leading-relaxed">{item.body}</p>
                                                                    </div>
                                                                </div>
                                                            )}
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    );
                                })()}

                                {/* Similar Properties */}
                                <div className="bg-white rounded-2xl p-6 border border-white/30 shadow-[0_0_0_1.5px_rgba(255,255,255,0.35),0_2px_16px_rgba(0,0,0,0.07)]">
                                    <div className="flex items-center justify-between mb-6">
                                        <h2 className="font-bold text-driven-text">Similar Properties in {project.area}</h2>
                                        <button className="text-accent-gold font-semibold text-sm hover:text-accent-gold-dark flex items-center gap-1">
                                            View All
                                            <Icon name="arrowRight" className="w-4 h-4" />
                                        </button>
                                    </div>
                                    <div className="grid md:grid-cols-3 gap-4">
                                        {mockProjects.filter(p => p.area === project.area && p.id !== project.id).slice(0, 3).map(similar => {
                                            const isInCompare = compareList && compareList.some(c => c.id === similar.id);
                                            const isHovered = hoveredSimilar === similar.id;

                                            return (
                                                <div
                                                    key={similar.id}
                                                    className="group cursor-pointer"
                                                    onMouseEnter={() => setHoveredSimilar(similar.id)}
                                                    onMouseLeave={() => setHoveredSimilar(null)}
                                                    onClick={() => onSelectProject && onSelectProject(similar)}
                                                >
                                                    <div className="relative aspect-video rounded-lg overflow-hidden mb-3">
                                                        <img src={similar.image} alt={similar.name} className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300" />
                                                        <div className="absolute top-2 right-2 bg-white/95 px-2 py-1 rounded-full text-xs font-semibold">
                                                            {similar.beds} BR
                                                        </div>
                                                        {((isHovered || isInCompare) && onAddToCompare) && (
                                                            <button
                                                                onClick={(e) => { e.stopPropagation(); onAddToCompare(similar); }}
                                                                className={`absolute top-2 left-2 p-2 rounded-full transition-all shadow-soft ${isInCompare ? 'bg-accent-gold text-white' : 'bg-white/95 hover:bg-white'}`}
                                                                title={isInCompare ? "Remove from comparison" : "Add to comparison"}
                                                            >
                                                                <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                                    {isInCompare ? (
                                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                                                    ) : (
                                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                                                                    )}
                                                                </svg>
                                                            </button>
                                                        )}
                                                    </div>
                                                    <p className="text-lg font-bold text-driven-text mb-1">{similar.price}</p>
                                                    <p className="text-sm text-warm-600 mb-1">{similar.name}</p>
                                                    <div className="flex items-center gap-3 text-xs text-warm-500">
                                                        <span className="flex items-center gap-1">
                                                            <Icon name="bed" className="w-3 h-3" />
                                                            {similar.beds}
                                                        </span>
                                                        <span className="flex items-center gap-1">
                                                            <Icon name="bath" className="w-3 h-3" />
                                                            {similar.baths}
                                                        </span>
                                                        <span className="flex items-center gap-1">
                                                            <Icon name="area" className="w-3 h-3" />
                                                            {similar.sqft} sqft
                                                        </span>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            </div>
                            <div className="hidden lg:block space-y-4 sticky top-24 self-start max-h-[calc(100vh-6rem)] overflow-y-auto pb-4 scrollbar-hide">

                                {/* Card 1: Price + CTAs + Agent */}
                                <div className="bg-white rounded-2xl p-5 border border-white/30 shadow-[0_0_0_1.5px_rgba(255,255,255,0.35),0_2px_16px_rgba(0,0,0,0.07)]">

                                    {/* EMI starts from + Price */}
                                    <div className="flex items-start justify-between mb-4">
                                        <div className="bg-cream-50 border border-warm-200 rounded-xl px-3 py-2">
                                            <p className="text-xs text-warm-500 mb-0.5">EMI starts from</p>
                                            <p className="text-base font-bold text-driven-text">
                                                <Dhs className="text-sm text-warm-400 mr-0.5" />
                                                {Math.round(monthlyPayment).toLocaleString()}*
                                            </p>
                                        </div>
                                        <div className="text-right flex-1 pl-4">
                                            <p className="text-3xl font-bold text-driven-text">
                                                <Dhs className="text-2xl text-warm-400 mr-0.5" />
                                                {project.price.replace('د.إ', '')}
                                            </p>
                                            <p className="text-warm-500 text-sm">
                                                <Dhs className="text-xs text-warm-400 mr-0.5" />
                                                {project.pricePerSqft}/sqft
                                            </p>
                                        </div>
                                    </div>

                                    <div className="border-t border-warm-100 my-4"></div>
                                    <div className="space-y-2.5">
                                        <button className="w-full py-3 rounded-full font-semibold flex items-center justify-center gap-2 transition-all" style={{ backgroundColor: '#D4B896', color: '#1a1a1a' }}>
                                            <Icon name="whatsapp" className="w-5 h-5" /> WhatsApp
                                        </button>
                                        <button className="w-full py-3 rounded-full font-semibold flex items-center justify-center gap-2 transition-all" style={{ backgroundColor: '#D4B896', color: '#1a1a1a' }}>
                                            <Icon name="phone" className="w-5 h-5" /> Call Agent
                                        </button>
                                        <button className="w-full py-3 rounded-full font-semibold flex items-center justify-center gap-2 bg-driven-text text-white hover:bg-warm-700 transition-all">
                                            <Icon name="calendar" className="w-5 h-5" /> Schedule Visit
                                        </button>
                                    </div>

                                    <div className="border-t border-warm-100 mt-4 pt-4">
                                        <p className="text-xs font-medium text-accent-gold mb-1">Listing By</p>
                                        <div className="flex items-center gap-3">
                                            <img src={project.agent.image} alt={project.agent.name} className="w-10 h-10 rounded-full object-cover" />
                                            <p className="font-semibold text-driven-text text-sm">{project.agent.name}</p>
                                        </div>
                                    </div>
                                </div>
                                <div className="bg-white rounded-2xl p-5 border border-white/30 shadow-[0_0_0_1.5px_rgba(255,255,255,0.35),0_2px_16px_rgba(0,0,0,0.07)]">

                                    {/* Calculator - Tab Design */}
                                    <div>
                                        <h3 className="text-lg font-bold text-driven-text mb-4">Check the numbers</h3>

                                        {/* Tab Switcher - Pill Style */}
                                        <div className="bg-cream-100 p-1 rounded-full flex mb-5">
                                            {['mortgage', 'roi', 'advanced'].map(tab => (
                                                <button
                                                    key={tab}
                                                    onClick={() => tab === 'advanced' ? setShowAdvancedModal(true) : setOpenCalculator(tab)}
                                                    className={`flex-1 py-2 px-3 rounded-full text-sm font-medium transition-all flex items-center justify-center gap-1.5 ${openCalculator === tab && tab !== 'advanced'
                                                        ? 'bg-white shadow text-driven-text'
                                                        : 'text-warm-500 hover:text-warm-700'
                                                        }`}
                                                >
                                                    {tab === 'advanced' && (
                                                        <svg className="w-3.5 h-3.5 text-accent-gold" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2">
                                                            <path d="M12 2l2.4 7.4H22l-6.2 4.5 2.4 7.4L12 17l-6.2 4.3 2.4-7.4L2 9.4h7.6z" />
                                                        </svg>
                                                    )}
                                                    {tab.charAt(0).toUpperCase() + tab.slice(1)}
                                                </button>
                                            ))}
                                        </div>
                                        {openCalculator === 'mortgage' && (
                                            <div className="space-y-5">
                                                {/* Loan Amount */}
                                                <div>
                                                    <label className="text-sm font-medium text-driven-text block mb-3">Loan Amount</label>
                                                    <div className="flex items-center gap-2 mb-2">
                                                        <button onClick={() => setDownPaymentPercent(Math.min(50, downPaymentPercent + 5))} className="w-9 h-9 rounded-full border border-warm-300 flex items-center justify-center text-warm-700 hover:border-warm-500 transition-all flex-shrink-0">
                                                            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M12 5v14M5 12h14" /></svg>
                                                        </button>
                                                        <button onClick={() => setDownPaymentPercent(Math.max(10, downPaymentPercent - 5))} className="w-9 h-9 rounded-full border border-warm-300 flex items-center justify-center text-warm-700 hover:border-warm-500 transition-all flex-shrink-0">
                                                            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M5 12h14" /></svg>
                                                        </button>
                                                        <div className="flex-1 px-4 py-2.5 border border-warm-200 rounded-full text-right font-semibold text-driven-text bg-cream-50">
                                                            {Math.round(loanAmount).toLocaleString()}
                                                        </div>
                                                    </div>
                                                    <input type="range" min="10" max="50" step="5" value={downPaymentPercent} onChange={(e) => setDownPaymentPercent(Number(e.target.value))} className="w-full accent-warm-800" />
                                                    <p className="text-xs text-warm-500 text-right mt-1">{numberToWords(Math.round(loanAmount))} Dirhams</p>
                                                </div>
                                                <div>
                                                    <label className="text-sm font-medium text-driven-text block mb-3">Duration</label>
                                                    <div className="flex items-center gap-2 mb-2">
                                                        <button onClick={() => setLoanYears(Math.min(30, loanYears + 5))} className="w-9 h-9 rounded-full border border-warm-300 flex items-center justify-center text-warm-700 hover:border-warm-500 transition-all flex-shrink-0">
                                                            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M12 5v14M5 12h14" /></svg>
                                                        </button>
                                                        <button onClick={() => setLoanYears(Math.max(5, loanYears - 5))} className="w-9 h-9 rounded-full border border-warm-300 flex items-center justify-center text-warm-700 hover:border-warm-500 transition-all flex-shrink-0">
                                                            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M5 12h14" /></svg>
                                                        </button>
                                                        <div className="flex-1 px-4 py-2.5 border border-warm-200 rounded-full text-right font-semibold text-driven-text bg-cream-50">
                                                            {loanYears}
                                                        </div>
                                                    </div>
                                                    <input type="range" min="5" max="30" step="5" value={loanYears} onChange={(e) => setLoanYears(Number(e.target.value))} className="w-full accent-warm-800" />
                                                    <p className="text-xs text-warm-500 text-right mt-1">{loanYears === 1 ? 'One year' : loanYears === 5 ? 'Five years' : loanYears === 10 ? 'Ten years' : loanYears === 15 ? 'Fifteen years' : loanYears === 20 ? 'Twenty years' : loanYears === 25 ? 'Twenty five years' : 'Thirty years'}</p>
                                                </div>
                                                <div>
                                                    <label className="text-sm font-medium text-driven-text block mb-3">Annual Interest Rate (%)</label>
                                                    <div className="flex items-center gap-2 mb-2">
                                                        <button onClick={() => setInterestRate(Math.min(10, parseFloat((interestRate + 0.25).toFixed(2))))} className="w-9 h-9 rounded-full border border-warm-300 flex items-center justify-center text-warm-700 hover:border-warm-500 transition-all flex-shrink-0">
                                                            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M12 5v14M5 12h14" /></svg>
                                                        </button>
                                                        <button onClick={() => setInterestRate(Math.max(1, parseFloat((interestRate - 0.25).toFixed(2))))} className="w-9 h-9 rounded-full border border-warm-300 flex items-center justify-center text-warm-700 hover:border-warm-500 transition-all flex-shrink-0">
                                                            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M5 12h14" /></svg>
                                                        </button>
                                                        <div className="flex-1 px-4 py-2.5 border border-warm-200 rounded-full text-right font-semibold text-driven-text bg-cream-50">
                                                            {interestRate}%
                                                        </div>
                                                    </div>
                                                    <input type="range" min="1" max="10" step="0.25" value={interestRate} onChange={(e) => setInterestRate(Number(e.target.value))} className="w-full accent-warm-800" />
                                                    <p className="text-xs text-warm-500 text-right mt-1">{interestRate === 4.5 ? 'Four point five percent' : interestRate === 3.75 ? 'Three point seventy five percent' : `${interestRate} percent`}</p>
                                                </div>
                                                <div className="bg-cream-50 rounded-2xl p-4 border border-white/30 shadow-[0_0_0_1px_rgba(255,255,255,0.3),0_1px_8px_rgba(0,0,0,0.06)]">
                                                    <div className="flex items-center justify-between mb-1">
                                                        <span className="text-sm text-warm-500">Convert to</span>
                                                        <div className="flex items-center gap-1 bg-white border border-warm-200 rounded-full px-3 py-1 text-sm font-medium">
                                                            <svg className="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M19 9l-7 7-7-7" /></svg> <Dhs className="text-sm" />
                                                        </div>
                                                    </div>
                                                    <p className="text-3xl font-bold text-driven-text mt-2">
                                                        <Dhs className="text-2xl text-warm-400 mr-1" />
                                                        {Math.round(monthlyPayment).toLocaleString()} <span className="text-lg font-medium text-warm-500">/month*</span>
                                                    </p>
                                                    <p className="text-xs text-warm-500 mt-1">{monthlyPaymentInWords(Math.round(monthlyPayment))}</p>
                                                </div>
                                                <button className="w-full bg-driven-text text-white py-3.5 rounded-full font-semibold flex items-center justify-center gap-2 hover:bg-warm-700 transition-all">
                                                    <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg>
                                                    Secure this rate
                                                </button>
                                                <p className="text-xs text-warm-400 text-center">* Additional fee and processing charges may apply</p>
                                            </div>
                                        )}

                                        {/* ROI Tab */}
                                        {openCalculator === 'roi' && (
                                            <div className="space-y-5">
                                                {/* Annual Rent */}
                                                <div>
                                                    <label className="text-sm font-medium text-driven-text block mb-3">Annual Rent (AED)</label>
                                                    <div className="flex items-center gap-2 mb-2">
                                                        <button onClick={() => setRentalIncome(Math.min(200000, rentalIncome + 5000))} className="w-9 h-9 rounded-full border border-warm-300 flex items-center justify-center text-warm-700 hover:border-warm-500 transition-all flex-shrink-0">
                                                            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M12 5v14M5 12h14" /></svg>
                                                        </button>
                                                        <button onClick={() => setRentalIncome(Math.max(80000, rentalIncome - 5000))} className="w-9 h-9 rounded-full border border-warm-300 flex items-center justify-center text-warm-700 hover:border-warm-500 transition-all flex-shrink-0">
                                                            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M5 12h14" /></svg>
                                                        </button>
                                                        <div className="flex-1 px-4 py-2.5 border border-warm-200 rounded-full text-right font-semibold text-driven-text bg-cream-50">
                                                            {rentalIncome.toLocaleString()}
                                                        </div>
                                                    </div>
                                                    <input type="range" min="80000" max="200000" step="5000" value={rentalIncome} onChange={(e) => setRentalIncome(Number(e.target.value))} className="w-full accent-warm-800" />
                                                </div>
                                                <div>
                                                    <label className="text-sm font-medium text-driven-text block mb-3">Holding Period</label>
                                                    <div className="flex gap-2">
                                                        {[3, 5, 7, 10].map(y => (
                                                            <button key={y} onClick={() => setHoldingPeriod(y)} className={`flex-1 py-2.5 rounded-full text-sm font-medium transition-all border ${holdingPeriod === y ? 'bg-driven-text text-white border-driven-text' : 'bg-cream-50 text-warm-600 border-warm-200 hover:border-warm-400'}`}>
                                                                {y}y
                                                            </button>
                                                        ))}
                                                    </div>
                                                </div>
                                                <div className="bg-cream-50 rounded-2xl p-4 border border-white/30 shadow-[0_0_0_1px_rgba(255,255,255,0.3),0_1px_8px_rgba(0,0,0,0.06)] space-y-3">
                                                    <div className="flex justify-between items-center">
                                                        <span className="text-sm text-warm-600">Annual Yield</span>
                                                        <span className="text-2xl font-bold text-accent-gold">{annualYield}%</span>
                                                    </div>
                                                    <div className="w-full bg-warm-100 rounded-full h-2">
                                                        <div className="bg-accent-gold h-2 rounded-full" style={{ width: `${Math.min(100, annualYield * 10)}%` }}></div>
                                                    </div>
                                                    <div className="flex justify-between items-center pt-1 border-t border-warm-200">
                                                        <span className="text-sm text-warm-600">{holdingPeriod}-Year Total Return</span>
                                                        <span className="text-2xl font-bold text-accent-gold">{totalReturn}%</span>
                                                    </div>
                                                </div>

                                                <button className="w-full bg-driven-text text-white py-3.5 rounded-full font-semibold flex items-center justify-center gap-2 hover:bg-warm-700 transition-all">
                                                    <Icon name="calculator" className="w-5 h-5" />
                                                    Get Full ROI Report
                                                </button>
                                                <p className="text-xs text-warm-400 text-center">* Estimates based on current market data</p>
                                            </div>
                                        )}
                                    </div>

                                    <div className="border-t border-warm-200 my-6"></div>

                                </div>
                            </div>
                        </div>

                        {/* ══════ Advanced Calculator Modal (visible on all screen sizes) ══════ */}
                        {showAdvancedModal && (
                            <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4" onClick={() => setShowAdvancedModal(false)}>
                                <div className="p-2 bg-white/15 backdrop-blur-md rounded-[2.25rem] border border-white/25 w-full max-w-md shadow-2xl animate-scale-in" onClick={e => e.stopPropagation()}>
                                    <div className="bg-[#F5F0E8] rounded-[1.75rem] w-full overflow-hidden relative">
                                        {/* Close button */}
                                        <button onClick={() => setShowAdvancedModal(false)} className="absolute top-4 right-4 z-10 w-8 h-8 flex items-center justify-center rounded-full border border-warm-300 bg-white/80 text-warm-500 hover:bg-white hover:text-driven-text transition-all">
                                            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M6 18L18 6M6 6l12 12" /></svg>
                                        </button>

                                        {/* Hero section — title + illustration */}
                                        <div className="px-7 pt-7 pb-0">
                                            <div className="flex items-start justify-between gap-4">
                                                <div className="flex-1 pt-2">
                                                    <h3 className="text-[1.75rem] leading-[1.15] font-bold text-driven-text">Get premium<br />investment<br />tools for Free!</h3>
                                                    <p className="text-warm-400 text-sm mt-2">Simply sign up to get complete access</p>
                                                </div>
                                                <div className="flex-shrink-0 w-40 h-36">
                                                    <img src="Modal Assets/calculaator.svg" alt="Calculator" className="w-full h-full object-contain" />
                                                </div>
                                            </div>
                                        </div>

                                        {/* Feature list */}
                                        <div className="px-7 pt-4 pb-3">
                                            <div className="space-y-0">
                                                {[
                                                    'Airbnb & short-term Yield Calculator',
                                                    'Cash flow & Net profit projections',
                                                    'Mortgage vs Cash comparison tool',
                                                    'Capital Appreciation Forecasting',
                                                    'Flip vs Hold Analysis',
                                                ].map((feature, i) => (
                                                    <div key={i} className="flex items-center gap-3 py-3 border-b border-warm-200/60 last:border-b-0">
                                                        <span className="text-sm text-warm-600">{feature}</span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        {/* Sign up buttons — 2x2 grid */}
                                        <div className="px-7 pt-4 pb-3">
                                            <div className="grid grid-cols-2 gap-2.5">
                                                <button className="flex items-center justify-center gap-2.5 px-4 py-3 bg-white rounded-full border border-warm-200 hover:border-warm-300 hover:shadow-sm transition-all">
                                                    <svg className="flex-shrink-0" viewBox="0 0 24 24" style={{ width: '18px', height: '18px' }}><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4" /><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853" /><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05" /><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335" /></svg>
                                                    <span className="text-sm font-semibold text-driven-text">Continue with Google</span>
                                                </button>
                                                <button className="flex items-center justify-center gap-2.5 px-4 py-3 bg-white rounded-full border border-warm-200 hover:border-warm-300 hover:shadow-sm transition-all">
                                                    <svg className="flex-shrink-0" viewBox="0 0 24 24" fill="#1877F2" style={{ width: '18px', height: '18px' }}><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z" /></svg>
                                                    <span className="text-sm font-semibold text-driven-text">Continue with Facebook</span>
                                                </button>
                                                <button className="flex items-center justify-center gap-2.5 px-4 py-3 bg-white rounded-full border border-warm-200 hover:border-warm-300 hover:shadow-sm transition-all">
                                                    <svg className="flex-shrink-0" viewBox="0 0 24 24" fill="currentColor" style={{ width: '18px', height: '18px' }}><path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.8-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z" /></svg>
                                                    <span className="text-sm font-semibold text-driven-text">Continue with Apple</span>
                                                </button>
                                                <button className="flex items-center justify-center gap-2.5 px-4 py-3 bg-white rounded-full border border-warm-200 hover:border-warm-300 hover:shadow-sm transition-all">
                                                    <svg className="flex-shrink-0 text-warm-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.5" style={{ width: '18px', height: '18px' }}><path d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" /></svg>
                                                    <span className="text-sm font-semibold text-driven-text">Continue with Email</span>
                                                </button>
                                            </div>
                                        </div>

                                        {/* Already have an account + Login */}
                                        <div className="px-7 pt-2 pb-6">
                                            <p className="text-warm-400 text-sm text-center mb-3">Already have an account?</p>
                                            <button className="w-full flex items-center justify-center gap-2 py-3.5 bg-driven-text text-white rounded-full font-semibold text-sm hover:bg-warm-700 transition-all">
                                                <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10" /><path d="M12 8l4 4m0 0l-4 4m4-4H8" /></svg>
                                                Login Now
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeModal && (
                            <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fade-in" onClick={() => setActiveModal(null)}>
                                <div className="p-2 bg-white/15 backdrop-blur-md rounded-[2.25rem] border border-white/25 max-w-4xl w-full shadow-2xl animate-scale-in" onClick={(e) => e.stopPropagation()}>
                                    <div className="bg-white rounded-3xl max-h-[90vh] overflow-hidden">

                                        {/* Description Modal */}
                                        {activeModal === 'description' && (
                                            <>
                                                {/* Header with Image */}
                                                <div className="relative h-64 overflow-hidden">
                                                    <img src={project.image} alt={project.name} className="w-full h-full object-cover" />
                                                    <div className="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent" />
                                                    <button
                                                        onClick={() => setActiveModal(null)}
                                                        className="absolute top-4 right-4 w-10 h-10 bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center hover:bg-white/30 transition-all"
                                                    >
                                                        <svg className="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                                        </svg>
                                                    </button>
                                                    <div className="absolute bottom-6 left-6 right-6">
                                                        <h2 className="text-3xl font-bold text-white mb-2">{project.name}</h2>
                                                        <p className="text-white/90">{project.location}</p>
                                                    </div>
                                                </div>
                                                <div className="p-8 overflow-y-auto max-h-[calc(90vh-16rem)]">
                                                    <div className="prose prose-lg max-w-none">
                                                        <h3 className="text-2xl font-bold text-driven-text mb-4">About This Property</h3>
                                                        <p className="text-warm-700 leading-relaxed mb-4">
                                                            Experience off-plan luxurious living at <strong>{project.name}</strong>, located in the heart of <strong>{project.location}</strong>.
                                                            This premium {project.beds}-bedroom apartment offers stunning views and world-class amenities.
                                                        </p>

                                                        <p className="text-warm-700 leading-relaxed mb-4">
                                                            Moody is a one-of-a-kind development featuring 70% hotel and 30% fully serviced apartments connected via a 6-star hotel.
                                                            The property is centrally positioned overlooking Dubai Marina, guaranteeing a stunning view of the waterfront and city skyline.
                                                        </p>

                                                        <h4 className="text-xl font-bold text-driven-text mt-6 mb-3">Property Highlights</h4>
                                                        <ul className="space-y-2 mb-6">
                                                            <li className="flex items-start gap-3">
                                                                <svg className="w-6 h-6 text-accent-gold mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                                                </svg>
                                                                <span className="text-warm-700">Prime waterfront location with unobstructed marina views</span>
                                                            </li>
                                                            <li className="flex items-start gap-3">
                                                                <svg className="w-6 h-6 text-accent-gold mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                                                </svg>
                                                                <span className="text-warm-700">Connected to 6-star hotel amenities and services</span>
                                                            </li>
                                                            <li className="flex items-start gap-3">
                                                                <svg className="w-6 h-6 text-accent-gold mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                                                </svg>
                                                                <span className="text-warm-700">High-end finishes and smart home technology throughout</span>
                                                            </li>
                                                            <li className="flex items-start gap-3">
                                                                <svg className="w-6 h-6 text-accent-gold mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                                                </svg>
                                                                <span className="text-warm-700">Flexible payment plans with attractive ROI potential</span>
                                                            </li>
                                                        </ul>

                                                        <div className="bg-cream-50 rounded-2xl p-6 border border-white/30 shadow-[0_0_0_1px_rgba(255,255,255,0.3),0_1px_8px_rgba(0,0,0,0.06)]">
                                                            <h4 className="font-bold text-driven-text mb-3">Investment Opportunity</h4>
                                                            <p className="text-warm-700 text-sm leading-relaxed">
                                                                This off-plan property represents an exceptional investment opportunity in one of Dubai's most sought-after locations.
                                                                With expected rental yields of {project.roi} and strong capital appreciation potential, this property is ideal for
                                                                both end-users and investors seeking premium returns.
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </>
                                        )}

                                        {/* Amenities Modal */}
                                        {activeModal === 'amenities' && (
                                            <>
                                                {/* Header */}
                                                <div className="relative p-6 pb-4 border-b border-warm-100">
                                                    <button
                                                        onClick={() => setActiveModal(null)}
                                                        className="absolute top-4 right-4 w-10 h-10 border border-warm-200 rounded-full flex items-center justify-center hover:bg-cream-50 transition-all text-warm-500"
                                                    >
                                                        <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2">
                                                            <path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" />
                                                        </svg>
                                                    </button>
                                                    <h2 className="text-2xl font-bold text-driven-text">What Comes With Your Home</h2>
                                                    <p className="text-warm-500 text-sm mt-1">Complete list of 50+ premium features & services</p>
                                                </div>
                                                <div className="p-6 overflow-y-auto max-h-[calc(90vh-10rem)]">
                                                    <div className="grid md:grid-cols-2 gap-4">
                                                        {/* Building Amenities */}
                                                        <div className="border border-warm-200 rounded-xl p-5">
                                                            <h3 className="font-bold text-driven-text mb-4">Building Amenities</h3>
                                                            <ul className="space-y-3">
                                                                {['Infinity Swimming Pool', 'State-of-the-Art Gym', 'Kids Play Area', '24/7 Security', 'Basement Parking', 'Concierge Service', 'Business Lounge', 'Conference Room', 'Yoga Studio', 'Spa & Wellness', 'Steam Room & Sauna', 'Jacuzzi', 'BBQ Area', 'Outdoor Lounge', 'Cinema Room', 'Games Room', 'Library', 'Rooftop Garden', 'Prayer Room', 'Retail Outlets'].map(amenity => (
                                                                    <li key={amenity} className="flex items-center gap-3 text-warm-700 text-sm">
                                                                        <svg className="w-5 h-5 text-warm-300 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.5">
                                                                            <path strokeLinecap="round" strokeLinejoin="round" d="M9 12l2 2 4-4" />
                                                                            <circle cx="12" cy="12" r="9" />
                                                                        </svg>
                                                                        <span>{amenity}</span>
                                                                    </li>
                                                                ))}
                                                            </ul>
                                                        </div>
                                                        {/* Unit Features */}
                                                        <div className="border border-warm-200 rounded-xl p-5">
                                                            <h3 className="font-bold text-driven-text mb-4">Unit Features</h3>
                                                            <ul className="space-y-3">
                                                                {['Panoramic Marina View', 'Fully Furnished', 'Spacious Balcony', 'Built-in Wardrobes', 'Central A/C', 'Smart Home System', 'Premium Kitchen Appliances', 'Italian Marble Flooring', 'Floor-to-Ceiling Windows', 'High-Speed Internet', 'Video Intercom', 'Walk-in Closet', 'Ensuite Bathroom', 'Guest Powder Room', 'Laundry Room', 'Maid\'s Room', 'Storage Space', 'Premium Fixtures', 'LED Lighting', 'Blackout Curtains'].map(feature => (
                                                                    <li key={feature} className="flex items-center gap-3 text-warm-700 text-sm">
                                                                        <svg className="w-5 h-5 text-warm-300 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.5">
                                                                            <path strokeLinecap="round" strokeLinejoin="round" d="M9 12l2 2 4-4" />
                                                                            <circle cx="12" cy="12" r="9" />
                                                                        </svg>
                                                                        <span>{feature}</span>
                                                                    </li>
                                                                ))}
                                                            </ul>
                                                        </div>
                                                    </div>
                                                    {/* Premium Services */}
                                                    <div className="mt-5 border border-warm-200 rounded-xl p-5">
                                                        <h3 className="font-bold text-driven-text mb-4">Premium Services Included</h3>
                                                        <div className="grid md:grid-cols-3 gap-3">
                                                            {['Room Service', 'Housekeeping', 'Valet Parking', 'Pet Care', 'Maintenance', 'Package Delivery'].map(service => (
                                                                <div key={service} className="flex items-center gap-3 text-warm-700 text-sm">
                                                                    <svg className="w-5 h-5 text-warm-300 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.5">
                                                                        <path strokeLinecap="round" strokeLinejoin="round" d="M9 12l2 2 4-4" />
                                                                        <circle cx="12" cy="12" r="9" />
                                                                    </svg>
                                                                    <span>{service}</span>
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>
                                                </div>
                                            </>
                                        )}

                                    </div>
                                </div>
                            </div>
                        )}

                        {/* 3D Tour Modal — Matterport Embed */}
                        {show3DTour && (
                            <div className="fixed inset-0 z-[9999] bg-black flex flex-col animate-fade-in">
                                {/* Minimal top bar */}
                                <div className="absolute top-4 right-4 z-10">
                                    <button
                                        onClick={() => setShow3DTour(false)}
                                        className="w-10 h-10 bg-black/50 backdrop-blur-md rounded-full flex items-center justify-center hover:bg-black/70 transition-all text-white"
                                    >
                                        <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2">
                                            <path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                                {/* Matterport Iframe — full screen */}
                                <iframe
                                    src="https://my.matterport.com/show?play=1&lang=en-US&m=oyaicKWaEQw"
                                    width="100%"
                                    height="100%"
                                    style={{ border: 'none', flex: 1 }}
                                    allow="xr-spatial-tracking; gyroscope; accelerometer; fullscreen"
                                    allowFullScreen
                                    frameBorder="0"
                                ></iframe>
                            </div>
                        )}

                        {/* ── Mobile Fixed Bottom CTA Bar + Compare Tray ── */}
                        <div className="fixed bottom-0 left-0 right-0 z-50 lg:hidden flex flex-col" style={{ boxShadow: '0 -4px 20px rgba(0,0,0,0.10)' }}>
                            {/* CTA section */}
                            <div className="bg-white border-t border-warm-200 px-5 pt-4 pb-3 flex flex-col gap-3">
                                {/* Price row — right aligned, clear hierarchy */}
                                <div className="flex items-end justify-end gap-3">
                                    <p className="text-[12px] text-warm-400 leading-none pb-[3px]">
                                        <Dhs className="text-[10px]" />
                                        {Math.round(monthlyPayment).toLocaleString()}/mo*
                                    </p>
                                    <p className="text-[22px] font-[800] text-driven-text leading-none tracking-tight">
                                        <Dhs className="text-[17px] text-warm-400 mr-0.5" />
                                        {project.price.replace('د.إ', '')}
                                    </p>
                                </div>
                                {/* Buttons row — generous spacing */}
                                <div className="flex items-center gap-2.5">
                                    <button className="flex-1 h-[44px] rounded-full font-semibold flex items-center justify-center gap-2 text-[13px] transition-all" style={{ backgroundColor: '#D4B896', color: '#1a1a1a' }}>
                                        <Icon name="whatsapp" className="w-[18px] h-[18px]" /> WhatsApp
                                    </button>
                                    <button className="flex-1 h-[44px] rounded-full font-semibold flex items-center justify-center gap-2 text-[13px] transition-all" style={{ backgroundColor: '#D4B896', color: '#1a1a1a' }}>
                                        <Icon name="phone" className="w-[18px] h-[18px]" /> Call
                                    </button>
                                    <button className="flex-1 h-[44px] rounded-full font-semibold flex items-center justify-center gap-2 text-[13px] bg-driven-text text-white transition-all">
                                        <Icon name="calendar" className="w-[18px] h-[18px]" /> Visit
                                    </button>
                                </div>
                            </div>

                            {/* Compare tray — appears below CTA, gold accent border on top */}
                            {compareList.length > 0 && (
                                <div className="bg-[#faf6f0] border-t-2 border-accent-gold px-5 py-3 flex items-center justify-between gap-4">
                                    <div className="flex items-center gap-3 flex-1 min-w-0">
                                        <div className="w-9 h-9 bg-accent-gold rounded-full flex items-center justify-center flex-shrink-0">
                                            <span className="text-white font-bold text-[13px]">{compareList.length}</span>
                                        </div>
                                        <div className="min-w-0">
                                            <p className="text-[13px] font-bold text-warm-800 truncate leading-tight">
                                                {compareList.map(p => p.name.split(' ').slice(0, 2).join(' ')).join(', ')}
                                            </p>
                                            <p className="text-[11px] text-warm-500 leading-tight mt-0.5">
                                                {compareList.length === 1 ? 'Add more to compare' : `${compareList.length} properties selected`}
                                            </p>
                                        </div>
                                    </div>
                                    <div className="flex items-center gap-3 flex-shrink-0">
                                        <button onClick={onClearCompare} className="text-[12px] text-warm-500 hover:text-warm-700 font-medium">
                                            Clear
                                        </button>
                                        <button onClick={onViewComparison} className="px-5 py-2.5 bg-warm-800 text-white rounded-full text-[12px] font-semibold">
                                            Compare
                                        </button>
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* Bottom spacer — grows when compare tray is visible */}
                        <div className="lg:hidden" style={{ height: compareList.length > 0 ? '165px' : '115px' }}></div>

                    </div>
                </div>
            );
        };

        // Search Results Screen (with List/Map View)
        const SearchResultsScreen = ({ onSelectProject, watchlist, onToggleWatchlist, onBack, compareList = [], onAddToCompare }) => {
            const [viewMode, setViewMode] = useState('map');
            const [selectedMapProject, setSelectedMapProject] = useState(null);
            const [isInvestorMode, setIsInvestorMode] = useState(false);
            const [showInvestorModal, setShowInvestorModal] = useState(false);
            const [splitPercentage, setSplitPercentage] = useState(55); // 55/45 split - more space for cards on wide screens
            const [isDragging, setIsDragging] = useState(false);
            const [currentPage, setCurrentPage] = useState(1);
            const itemsPerPage = 12;

            // Track desktop vs mobile for responsive layout
            const [isDesktop, setIsDesktop] = useState(window.innerWidth >= 1024);
            const [viewportHeight, setViewportHeight] = useState(window.innerHeight);
            React.useEffect(() => {
                const onResize = () => {
                    setIsDesktop(window.innerWidth >= 1024);
                    setViewportHeight(window.innerHeight);
                };
                window.addEventListener('resize', onResize);
                window.addEventListener('orientationchange', () => setTimeout(onResize, 150));
                return () => {
                    window.removeEventListener('resize', onResize);
                    window.removeEventListener('orientationchange', onResize);
                };
            }, []);

            // Calculate pagination
            const totalPages = Math.ceil(mockProjects.length / itemsPerPage);
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const currentProjects = mockProjects.slice(startIndex, endIndex);

            // Reset to page 1 when view mode changes
            React.useEffect(() => {
                setCurrentPage(1);
            }, [viewMode]);

            // Handle resize drag (desktop only)
            const handleMouseDown = () => setIsDragging(true);

            React.useEffect(() => {
                const handleMouseMove = (e) => {
                    if (!isDragging) return;
                    const percentage = (e.clientX / window.innerWidth) * 100;
                    // Constrain between 25% and 75%
                    const constrainedPercentage = Math.min(Math.max(percentage, 25), 75);
                    setSplitPercentage(constrainedPercentage);
                };

                const handleMouseUp = () => setIsDragging(false);

                if (isDragging) {
                    document.addEventListener('mousemove', handleMouseMove);
                    document.addEventListener('mouseup', handleMouseUp);
                    document.body.style.cursor = 'ew-resize';
                    document.body.style.userSelect = 'none';
                }

                return () => {
                    document.removeEventListener('mousemove', handleMouseMove);
                    document.removeEventListener('mouseup', handleMouseUp);
                    document.body.style.cursor = '';
                    document.body.style.userSelect = '';
                };
            }, [isDragging]);

            // Filter state
            const [activeMainTab, setActiveMainTab] = useState('buy');
            const [activeSubTab, setActiveSubTab] = useState('offplan');
            const [selectedHandover, setSelectedHandover] = useState('Q3 2028');
            const [selectedPaymentPlan, setSelectedPaymentPlan] = useState('70/30');
            const [selectedCompletion, setSelectedCompletion] = useState('80%');
            const [locationSearch, setLocationSearch] = useState('');
            const [showQuickPills, setShowQuickPills] = useState(false);
            const [showFilterDrawer, setShowFilterDrawer] = useState(false); // mobile bottom-sheet
            const [sortBy, setSortBy] = useState('relevance');
            const [showSortDropdown, setShowSortDropdown] = useState(false);
            const [currency, setCurrency] = useState('AED');
            // Advanced filter state
            const [selectedBedrooms, setSelectedBedrooms] = useState(null);
            const [selectedBathrooms, setSelectedBathrooms] = useState(null);
            const [minSize, setMinSize] = useState('');
            const [maxSize, setMaxSize] = useState('');

            // ── Mobile map drawer state ──
            const [showMobileFilterModal, setShowMobileFilterModal] = useState(false);
            const DRAWER_COLLAPSED_HEIGHT = 220; // peek height in px
            const [drawerHeight, setDrawerHeight] = useState(DRAWER_COLLAPSED_HEIGHT);
            const [drawerExpanded, setDrawerExpanded] = useState(false);
            const [isDraggingDrawer, setIsDraggingDrawer] = useState(false);
            const touchStartYRef = React.useRef(0);
            const touchStartHeightRef = React.useRef(DRAWER_COLLAPSED_HEIGHT);
            const floatingSearchRef = React.useRef(null);
            const mapContainerRef = React.useRef(null);

            // Compute expanded height: container height - (search bar bottom + 16px gap)
            const getExpandedHeight = () => {
                const container = mapContainerRef.current;
                const searchBar = floatingSearchRef.current;
                if (container && searchBar) {
                    const containerRect = container.getBoundingClientRect();
                    const searchRect = searchBar.getBoundingClientRect();
                    const ceiling = searchRect.bottom - containerRect.top + 16;
                    return containerRect.height - ceiling;
                }
                return window.innerHeight * 0.65; // fallback
            };

            // Drawer touch handlers
            const handleDrawerTouchStart = (e) => {
                setIsDraggingDrawer(true);
                touchStartYRef.current = e.touches[0].clientY;
                touchStartHeightRef.current = drawerHeight;
            };
            const handleDrawerTouchMove = (e) => {
                if (!isDraggingDrawer) return;
                e.preventDefault();
                const deltaY = touchStartYRef.current - e.touches[0].clientY; // positive = dragging up
                const expandedH = getExpandedHeight();
                const newHeight = Math.min(Math.max(touchStartHeightRef.current + deltaY, DRAWER_COLLAPSED_HEIGHT - 40), expandedH + 40);
                setDrawerHeight(newHeight);
            };
            const handleDrawerTouchEnd = (e) => {
                if (!isDraggingDrawer) return;
                setIsDraggingDrawer(false);
                const expandedH = getExpandedHeight();
                const midPoint = (DRAWER_COLLAPSED_HEIGHT + expandedH) / 2;
                // Snap based on velocity or position
                const endY = e.changedTouches[0].clientY;
                const velocity = touchStartYRef.current - endY; // positive = swipe up
                if (drawerExpanded) {
                    // Currently expanded → collapse if dragged down enough or fast swipe down
                    if (velocity < -50 || drawerHeight < midPoint) {
                        setDrawerHeight(DRAWER_COLLAPSED_HEIGHT);
                        setDrawerExpanded(false);
                    } else {
                        setDrawerHeight(expandedH);
                        setDrawerExpanded(true);
                    }
                } else {
                    // Currently collapsed → expand if dragged up enough or fast swipe up
                    if (velocity > 50 || drawerHeight > midPoint) {
                        setDrawerHeight(expandedH);
                        setDrawerExpanded(true);
                    } else {
                        setDrawerHeight(DRAWER_COLLAPSED_HEIGHT);
                        setDrawerExpanded(false);
                    }
                }
            };
            const handleDrawerTap = () => {
                const expandedH = getExpandedHeight();
                if (drawerExpanded) {
                    setDrawerHeight(DRAWER_COLLAPSED_HEIGHT);
                    setDrawerExpanded(false);
                } else {
                    setDrawerHeight(expandedH);
                    setDrawerExpanded(true);
                }
            };

            const mainTabs = [
                { id: 'buy', label: 'Buy' },
                { id: 'rent', label: 'Rent' },
                { id: 'commercial', label: 'Commercial' },
                { id: 'projects', label: 'Projects' }
            ];
            const subTabs = [
                { id: 'all', label: 'All' },
                { id: 'ready', label: 'Ready' },
                { id: 'offplan', label: 'Off Plan' },
                { id: 'luxury', label: 'Luxury' }
            ];
            const quickPills = [
                'Off Plan Apartments for Sale',
                'Off Plan Villas for Sale',
                'Luxury Off Plan Projects',
                'Upcoming Off Plan Properties in Dubai in 2025',
                'Upcoming Off Plan Properties in Dubai in 2026',
                'Upcoming Off Plan Properties in Dubai in 2027'
            ];

            return (
                <div className="min-h-screen bg-white">

                    {/* ── Advanced Search & Filter Bar — Figma Make Design ── */}
                    {/* Hidden on mobile when in map view (replaced by floating search bar) */}
                    <div className={`bg-[#f8f7f4] border-b border-[rgba(216,206,190,0.32)] ${!isDesktop && viewMode === 'map' ? 'hidden' : ''}`}>
                        <div className="max-w-7xl mx-auto px-6 pt-5 pb-4">
                            <div className="flex flex-col gap-[16px]">

                                {/* Main Search Container — rounded pill */}
                                <div
                                    className="bg-[rgba(255,255,255,0.8)] border border-[rgba(180,180,180,0.32)] rounded-[37px] p-[16px]"
                                    style={{ boxShadow: '-140px 111px 71px rgba(153,153,153,0.01), -79px 62px 60px rgba(153,153,153,0.05), -35px 28px 45px rgba(153,153,153,0.09), -9px 7px 25px rgba(153,153,153,0.1)' }}
                                >
                                    <div className="flex flex-col gap-[8px]">

                                        {/* ── Row 1: Property Type Tabs ONLY — full width pill ── */}
                                        <div className="bg-[#FFFBF6] border border-[#E7DCCC] rounded-[36px] p-[8px] flex gap-[4px] w-full">
                                            {mainTabs.map(tab => (
                                                <button
                                                    key={tab.id}
                                                    onClick={() => setActiveMainTab(tab.id)}
                                                    className="flex-1 h-[34px] rounded-[16px] flex items-center justify-center transition-all duration-200"
                                                    style={{
                                                        background: activeMainTab === tab.id ? '#161717' : 'transparent',
                                                        boxShadow: activeMainTab === tab.id ? '-16px 6px 7px rgba(0,0,0,0.03), -9px 3px 6px rgba(0,0,0,0.09), -4px 1px 4px rgba(0,0,0,0.15), -1px 0px 2px rgba(0,0,0,0.17)' : 'none',
                                                    }}
                                                >
                                                    <span className="text-[14px] leading-[18px] whitespace-nowrap" style={{ color: activeMainTab === tab.id ? '#FAFAF5' : '#1C1C1A' }}>
                                                        {tab.label}
                                                    </span>
                                                </button>
                                            ))}
                                        </div>

                                        {/* ── Row 2: Sub-tabs + all dropdowns — flex-wrap, wraps naturally ── */}
                                        <div className="flex gap-[8px] items-center flex-wrap">

                                            {/* Category Sub-Tab Pill — w-full so tabs spread evenly across the row */}
                                            <div className="bg-[#FFFBF6] border border-[#E7DCCC] rounded-[36px] p-[8px] flex gap-[4px] w-full">
                                                {subTabs.map(tab => (
                                                    <button
                                                        key={tab.id}
                                                        onClick={() => setActiveSubTab(tab.id)}
                                                        className="flex-1 min-h-[32px] rounded-[16px] flex items-center justify-center transition-all duration-200"
                                                        style={{
                                                            background: activeSubTab === tab.id ? '#EBEBE2' : 'transparent',
                                                            border: activeSubTab === tab.id ? '1px solid #333331' : '1px solid transparent',
                                                            boxShadow: activeSubTab === tab.id ? '-16px 6px 7px rgba(0,0,0,0.03), -9px 3px 6px rgba(0,0,0,0.09), -4px 1px 4px rgba(0,0,0,0.15), -1px 0px 2px rgba(0,0,0,0.17)' : 'none',
                                                        }}
                                                    >
                                                        <span className="text-[14px] leading-[17px] text-center whitespace-nowrap" style={{ fontWeight: activeSubTab === tab.id ? 600 : 400, color: activeSubTab === tab.id ? '#000000' : '#494946' }}>
                                                            {tab.label}
                                                        </span>
                                                    </button>
                                                ))}
                                            </div>

                                            {/* Handover By Dropdown */}
                                            <div className="flex-shrink-0 bg-[#FFFBF6] border border-[#E7DCCC] rounded-[33px] h-[50px] px-[16px] py-[8px] flex items-center cursor-pointer hover:border-[#C4AD8D] transition-colors" style={{ minWidth: '140px' }}>
                                                <div className="flex flex-col gap-[4px]">
                                                    <div className="flex gap-[4px] items-center">
                                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#242424" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 9l6 6 6-6" /></svg>
                                                        <span className="text-[12px] leading-[14px] text-[#696765]">Handover by</span>
                                                    </div>
                                                    <span className="text-[14px] leading-[17px] text-black font-semibold">{selectedHandover}</span>
                                                </div>
                                            </div>

                                            {/* Payment Plan Dropdown */}
                                            <div className="flex-shrink-0 bg-[#FFFBF6] border border-[#E7DCCC] rounded-[33px] h-[50px] px-[16px] py-[8px] flex items-center cursor-pointer hover:border-[#C4AD8D] transition-colors" style={{ minWidth: '150px' }}>
                                                <div className="flex flex-col gap-[4px]">
                                                    <div className="flex gap-[4px] items-center">
                                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#242424" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 9l6 6 6-6" /></svg>
                                                        <span className="text-[12px] leading-[14px] text-[#696765]">Payment Plan</span>
                                                    </div>
                                                    <span className="text-[14px] leading-[17px] text-black font-semibold">{selectedPaymentPlan}</span>
                                                </div>
                                            </div>

                                            {/* Completion Dropdown */}
                                            <div className="flex-shrink-0 bg-[#FFFBF6] border border-[#E7DCCC] rounded-[33px] h-[50px] px-[16px] py-[8px] flex items-center cursor-pointer hover:border-[#C4AD8D] transition-colors" style={{ minWidth: '130px' }}>
                                                <div className="flex flex-col gap-[4px]">
                                                    <div className="flex gap-[4px] items-center">
                                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#242424" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 9l6 6 6-6" /></svg>
                                                        <span className="text-[12px] leading-[14px] text-[#696765]">Completion</span>
                                                    </div>
                                                    <span className="text-[14px] leading-[17px] text-black font-semibold">{selectedCompletion}</span>
                                                </div>
                                            </div>

                                            {/* Amenities Dropdown */}
                                            <div className="flex-shrink-0 bg-[#FFFBF6] border border-[#E7DCCC] rounded-[33px] h-[50px] px-[16px] py-[8px] flex items-center cursor-pointer hover:border-[#C4AD8D] transition-colors" style={{ minWidth: '130px' }}>
                                                <div className="flex gap-[4px] items-center">
                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#242424" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 9l6 6 6-6" /></svg>
                                                    <span className="text-[14px] leading-[17px] text-[#696765]">Amenities</span>
                                                </div>
                                            </div>

                                            {/* Price Dropdown */}
                                            <div className="flex-shrink-0 bg-[#FFFBF6] border border-[#E7DCCC] rounded-[33px] h-[50px] px-[16px] py-[8px] flex items-center cursor-pointer hover:border-[#C4AD8D] transition-colors" style={{ minWidth: '100px' }}>
                                                <div className="flex gap-[4px] items-center">
                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#242424" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 9l6 6 6-6" /></svg>
                                                    <span className="text-[14px] leading-[17px] text-[#696765]">Price</span>
                                                </div>
                                            </div>

                                        </div>

                                        {/* ── Row 3: Search input — always its own full-width row ── */}
                                        <div className="flex gap-[8px] items-center">
                                            {/* Search Input */}
                                            <div className="flex-1 bg-[#FFFBF6] border border-[#E7DCCC] rounded-[33px] h-[50px] px-[24px] flex items-center gap-[8px] min-w-0">
                                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" style={{ flexShrink: 0 }}>
                                                    <circle cx="8" cy="8" r="6" stroke="#6C5F4C" strokeWidth="2" />
                                                    <path d="M12.5 12.5L17 17" stroke="#6C5F4C" strokeWidth="2" strokeLinecap="round" />
                                                </svg>
                                                <input
                                                    type="text"
                                                    placeholder="Search your preferred location"
                                                    value={locationSearch}
                                                    onChange={(e) => setLocationSearch(e.target.value)}
                                                    className="flex-1 bg-transparent outline-none text-[16px] leading-[19px] placeholder:text-[rgba(0,0,0,0.59)] text-[rgba(0,0,0,0.8)] min-w-0"
                                                    style={{ border: 'none' }}
                                                />
                                            </div>

                                            {/* Reset Link */}
                                            <button
                                                onClick={() => { setLocationSearch(''); setActiveMainTab('buy'); setActiveSubTab('offplan'); setSelectedBedrooms(null); setSelectedBathrooms(null); setMinSize(''); setMaxSize(''); }}
                                                className="text-[14px] leading-[17px] text-[#00276F] underline hover:opacity-80 transition-opacity whitespace-nowrap flex-shrink-0 font-medium"
                                            >
                                                Reset
                                            </button>

                                            {/* Search Button */}
                                            <button className="bg-black border border-[#C4AD8D] rounded-[27.586px] p-[4.12px] hover:opacity-90 transition-opacity flex-shrink-0">
                                                <div className="bg-black border border-black rounded-[28.842px] p-[11.526px]">
                                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                                        <circle cx="6.5" cy="6.5" r="5" stroke="white" strokeWidth="1.5" />
                                                        <path d="M10.5 10.5L14 14" stroke="white" strokeWidth="1.5" strokeLinecap="round" />
                                                    </svg>
                                                </div>
                                            </button>
                                        </div>

                                    </div>
                                </div>

                                {/* ── More Filters — accordion on desktop, bottom-sheet on mobile ── */}
                                <button
                                    onClick={() => isDesktop ? setShowQuickPills(!showQuickPills) : setShowFilterDrawer(true)}
                                    className="w-full rounded-[25px] px-[24px] py-[8px] hover:bg-[rgba(0,0,0,0.02)] transition-colors group"
                                >
                                    <div className="flex items-center gap-[8px]">
                                        <div className="flex-1 h-px bg-[#DCDCDC] rounded-[5px]" />
                                        <span className="text-[14px] leading-[17px] text-[#656565] font-medium">
                                            More Filters
                                        </span>
                                        <svg
                                            width="24" height="24" viewBox="0 0 24 24" fill="none"
                                            className="transition-transform duration-300"
                                            style={{ transform: showQuickPills ? 'rotate(180deg)' : 'rotate(0deg)' }}
                                        >
                                            <rect x="4" y="6" width="16" height="2" rx="1" fill="#242424" />
                                            <rect x="4" y="11" width="12" height="2" rx="1" fill="#242424" />
                                            <rect x="4" y="16" width="8" height="2" rx="1" fill="#242424" />
                                        </svg>
                                    </div>
                                </button>

                                {/* Desktop-only: expanded accordion panel */}
                                <div
                                    className="hidden lg:block overflow-hidden transition-all duration-300"
                                    style={{ maxHeight: showQuickPills ? '500px' : '0', opacity: showQuickPills ? 1 : 0 }}
                                >
                                    <div className="bg-[rgba(255,255,255,0.8)] border border-[rgba(180,180,180,0.32)] rounded-[24px] p-[24px]">
                                        <div className="grid grid-cols-3 gap-[16px]">
                                            {/* Bedrooms Filter */}
                                            <div>
                                                <label className="text-[14px] text-[#656565] mb-[8px] block font-medium">Bedrooms</label>
                                                <div className="flex gap-[8px]">
                                                    {['Studio', '1', '2', '3', '4', '5+'].map((bed) => (
                                                        <button
                                                            key={bed}
                                                            onClick={() => setSelectedBedrooms(selectedBedrooms === bed ? null : bed)}
                                                            className="flex-1 px-[8px] py-[8px] border rounded-[8px] transition-all text-[14px] text-center"
                                                            style={{
                                                                background: selectedBedrooms === bed ? '#161717' : '#FFFBF6',
                                                                borderColor: selectedBedrooms === bed ? '#161717' : '#E7DCCC',
                                                                color: selectedBedrooms === bed ? '#FAFAF5' : '#1C1C1A',
                                                            }}
                                                        >
                                                            {bed}
                                                        </button>
                                                    ))}
                                                </div>
                                            </div>

                                            {/* Bathrooms Filter */}
                                            <div>
                                                <label className="text-[14px] text-[#656565] mb-[8px] block font-medium">Bathrooms</label>
                                                <div className="flex gap-[8px]">
                                                    {['1', '2', '3', '4', '5+'].map((bath) => (
                                                        <button
                                                            key={bath}
                                                            onClick={() => setSelectedBathrooms(selectedBathrooms === bath ? null : bath)}
                                                            className="flex-1 px-[12px] py-[8px] border rounded-[8px] transition-all text-[14px] text-center"
                                                            style={{
                                                                background: selectedBathrooms === bath ? '#161717' : '#FFFBF6',
                                                                borderColor: selectedBathrooms === bath ? '#161717' : '#E7DCCC',
                                                                color: selectedBathrooms === bath ? '#FAFAF5' : '#1C1C1A',
                                                            }}
                                                        >
                                                            {bath}
                                                        </button>
                                                    ))}
                                                </div>
                                            </div>

                                            {/* Property Size Filter */}
                                            <div>
                                                <label className="text-[14px] text-[#656565] mb-[8px] block font-medium">Property Size (sqft)</label>
                                                <div className="flex gap-[8px] items-center">
                                                    <input
                                                        type="number"
                                                        placeholder="Min"
                                                        value={minSize}
                                                        onChange={(e) => setMinSize(e.target.value)}
                                                        className="flex-1 px-[12px] py-[8px] border border-[#E7DCCC] rounded-[8px] bg-[#FFFBF6] outline-none text-[14px] focus:border-[#C4AD8D] transition-colors"
                                                    />
                                                    <span className="text-[#656565]">-</span>
                                                    <input
                                                        type="number"
                                                        placeholder="Max"
                                                        value={maxSize}
                                                        onChange={(e) => setMaxSize(e.target.value)}
                                                        className="flex-1 px-[12px] py-[8px] border border-[#E7DCCC] rounded-[8px] bg-[#FFFBF6] outline-none text-[14px] focus:border-[#C4AD8D] transition-colors"
                                                    />
                                                </div>
                                            </div>
                                        </div>

                                        {/* Quick Pills */}
                                        <div className="flex flex-wrap gap-2 mt-[16px] pt-[16px] border-t border-[#E7DCCC]">
                                            {quickPills.map((pill, i) => (
                                                <button
                                                    key={i}
                                                    className="px-4 py-2 bg-[#FFFBF6] hover:bg-[#EBEBE2] border border-[#E7DCCC] rounded-full text-[12px] font-medium text-[#494946] hover:text-[#1C1C1A] transition-all"
                                                >
                                                    {pill}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>

                    {/* ── Title Bar: Heading + View/Sort controls ── */}
                    {/* Hidden on mobile when in map view */}
                    <div className={`bg-white border-b border-warm-100 ${!isDesktop && viewMode === 'map' ? 'hidden' : ''}`}>
                        <div className="max-w-7xl mx-auto px-6 py-4">
                            <div className="flex items-center justify-between">
                                <div>
                                    <h1 className="text-2xl font-bold text-driven-text">Popular Off-plan Properties in Dubai</h1>
                                </div>
                                <div className="flex items-center gap-3">
                                    {/* Investor Toggle */}
                                    <div className="flex items-center gap-2 mr-2">
                                        <span className={`text-sm font-semibold transition-colors ${!isInvestorMode ? 'text-driven-text' : 'text-warm-500'}`}>Resident</span>
                                        <button
                                            onClick={() => isInvestorMode ? setIsInvestorMode(false) : setShowInvestorModal(true)}
                                            className={`relative w-11 h-6 rounded-full transition-colors duration-300 ${isInvestorMode ? 'bg-warm-800' : 'bg-warm-300'}`}
                                        >
                                            <div className={`absolute top-0.5 left-0.5 bg-white w-5 h-5 rounded-full shadow-md transform transition-transform duration-300 ${isInvestorMode ? 'translate-x-5' : 'translate-x-0'}`}></div>
                                        </button>
                                        <span className={`text-sm font-semibold transition-colors ${isInvestorMode ? 'text-driven-text' : 'text-warm-500'}`}>Investor</span>
                                    </div>

                                    {/* List / Map View Toggle */}
                                    <div className="flex items-center bg-cream-50 rounded-xl p-1 border border-warm-200">
                                        <button
                                            onClick={() => setViewMode('list')}
                                            className={`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${viewMode === 'list' ? 'bg-white shadow-sm text-driven-text' : 'text-warm-500'}`}
                                        >
                                            <Icon name="list" className="w-4 h-4" /> List View
                                        </button>
                                        <button
                                            onClick={() => setViewMode('map')}
                                            className={`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${viewMode === 'map' ? 'bg-white shadow-sm text-driven-text' : 'text-warm-500'}`}
                                        >
                                            <Icon name="map" className="w-4 h-4" /> Map View
                                        </button>
                                    </div>

                                    {/* Sort */}
                                    <div className="relative">
                                        <button
                                            onClick={() => setShowSortDropdown(!showSortDropdown)}
                                            className="flex items-center gap-2 bg-white border border-warm-200 rounded-xl px-4 py-2.5 text-sm font-medium text-warm-700 hover:border-warm-400 transition-all"
                                        >
                                            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.5"><path d="M3 7h6m-6 5h10m-10 5h14M17 3l4 4-4 4m0 2l4 4-4 4" /></svg>
                                            Sort
                                        </button>
                                        {showSortDropdown && (
                                            <div className="absolute right-0 top-full mt-2 bg-white border border-warm-200 rounded-xl shadow-xl py-2 w-48 z-50">
                                                {['Relevance', 'Price: Low to High', 'Price: High to Low', 'Newest First', 'Completion %'].map(opt => (
                                                    <button
                                                        key={opt}
                                                        onClick={() => { setSortBy(opt); setShowSortDropdown(false); }}
                                                        className={`w-full text-left px-4 py-2.5 text-sm transition-all ${sortBy === opt ? 'bg-cream-100 font-semibold text-warm-900' : 'text-warm-600 hover:bg-cream-50'}`}
                                                    >
                                                        {opt}
                                                    </button>
                                                ))}
                                            </div>
                                        )}
                                    </div>

                                    {/* Currency */}
                                    <button className="flex items-center gap-1.5 bg-white border border-warm-200 rounded-xl px-4 py-2.5 text-sm font-medium text-warm-700 hover:border-warm-400 transition-all">
                                        <Icon name="chevronDown" className="w-3.5 h-3.5 text-warm-400" />
                                        {currency}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    {viewMode === 'list' ? (
                        /* List View Only - Constrained Width */
                        <div className="max-w-7xl mx-auto px-6 py-8">
                            <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                                {currentProjects.map(project => (
                                    <PropertyCard
                                        key={project.id}
                                        project={project}
                                        onSelect={onSelectProject}
                                        inWatchlist={watchlist.some(w => w.id === project.id)}
                                        onToggleWatchlist={onToggleWatchlist}
                                        isInvestorMode={isInvestorMode}
                                        onAddToCompare={onAddToCompare}
                                        inCompareList={compareList.some(c => c.id === project.id)}
                                    />
                                ))}
                            </div>
                            {totalPages > 1 && (
                                <div className="flex items-center justify-center gap-2 mt-12">
                                    <button
                                        onClick={() => setCurrentPage(prev => Math.max(1, prev - 1))}
                                        disabled={currentPage === 1}
                                        className="px-4 py-2 rounded-lg border border-eggshell-200 text-driven-text disabled:opacity-40 disabled:cursor-not-allowed hover:bg-cream-100 transition-all"
                                    >
                                        Previous
                                    </button>

                                    <div className="flex items-center gap-2">
                                        {[...Array(totalPages)].map((_, i) => {
                                            const pageNum = i + 1;
                                            // Show first, last, current, and adjacent pages
                                            if (pageNum === 1 || pageNum === totalPages || (pageNum >= currentPage - 1 && pageNum <= currentPage + 1)) {
                                                return (
                                                    <button
                                                        key={pageNum}
                                                        onClick={() => setCurrentPage(pageNum)}
                                                        className={`w-10 h-10 rounded-lg font-medium transition-all ${currentPage === pageNum
                                                            ? 'bg-driven-green text-white'
                                                            : 'border border-eggshell-200 text-driven-text hover:bg-cream-100'
                                                            }`}
                                                    >
                                                        {pageNum}
                                                    </button>
                                                );
                                            } else if (pageNum === currentPage - 2 || pageNum === currentPage + 2) {
                                                return <span key={pageNum} className="text-warm-500">...</span>;
                                            }
                                            return null;
                                        })}
                                    </div>

                                    <button
                                        onClick={() => setCurrentPage(prev => Math.min(totalPages, prev + 1))}
                                        disabled={currentPage === totalPages}
                                        className="px-4 py-2 rounded-lg border border-eggshell-200 text-driven-text disabled:opacity-40 disabled:cursor-not-allowed hover:bg-cream-100 transition-all"
                                    >
                                        Next
                                    </button>
                                </div>
                            )}
                        </div>
                    ) : isDesktop ? (
                        /* ══ DESKTOP: Side-by-side split (unchanged) ══ */
                        <div className="flex flex-row h-[calc(100vh-200px)]">
                            {/* List Panel — left */}
                            <div
                                className="overflow-y-auto bg-white flex flex-col flex-shrink-0"
                                style={{ width: `${splitPercentage}%`, minWidth: '260px', height: '100%' }}
                            >
                                <div className="sticky top-0 bg-white/95 backdrop-blur-sm border-b border-warm-100 px-4 py-3 z-10 flex-shrink-0">
                                    <p className="text-sm font-semibold text-[#222]">{mockProjects.length} properties</p>
                                </div>
                                <div className="p-3 grid gap-3" style={{ gridTemplateColumns: 'repeat(auto-fill, minmax(240px, 1fr))' }}>
                                    {currentProjects.map(project => (
                                        <div
                                            key={project.id}
                                            className="map-list-card"
                                            onMouseEnter={() => setSelectedMapProject(project)}
                                            onMouseLeave={() => setSelectedMapProject(null)}
                                        >
                                            <PropertyCard
                                                project={project}
                                                onSelect={onSelectProject}
                                                inWatchlist={watchlist.some(w => w.id === project.id)}
                                                onToggleWatchlist={onToggleWatchlist}
                                                isHovered={selectedMapProject?.id === project.id}
                                                isInvestorMode={isInvestorMode}
                                                onAddToCompare={onAddToCompare}
                                                inCompareList={compareList.some(c => c.id === project.id)}
                                            />
                                        </div>
                                    ))}
                                </div>
                                {totalPages > 1 && (
                                    <div className="flex items-center justify-center gap-3 py-4 px-4 border-t border-warm-100 flex-shrink-0">
                                        <button onClick={() => setCurrentPage(p => Math.max(1, p - 1))} disabled={currentPage === 1} className="px-3 py-1.5 rounded-lg border border-warm-200 text-sm text-driven-text disabled:opacity-40 hover:bg-cream-100 transition-all">Prev</button>
                                        <span className="text-sm text-warm-500 font-medium">{currentPage} / {totalPages}</span>
                                        <button onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))} disabled={currentPage === totalPages} className="px-3 py-1.5 rounded-lg border border-warm-200 text-sm text-driven-text disabled:opacity-40 hover:bg-cream-100 transition-all">Next</button>
                                    </div>
                                )}
                            </div>
                            {/* Resizable divider */}
                            <div onMouseDown={handleMouseDown} className="flex w-1 bg-warm-100 hover:bg-warm-300 cursor-ew-resize transition-colors flex-shrink-0 items-center justify-center group">
                                <div className="w-1 h-10 rounded-full bg-warm-300 group-hover:bg-warm-500 group-hover:h-14 transition-all opacity-0 group-hover:opacity-100" />
                            </div>
                            {/* Map Panel — right */}
                            <div style={{ width: `${100 - splitPercentage}%`, height: '100%', position: 'sticky', top: 0 }}>
                                <MapView projects={mockProjects} onSelectProject={onSelectProject} hoveredProject={selectedMapProject} onHoverProject={setSelectedMapProject} />
                            </div>
                        </div>
                    ) : (
                        /* ══ MOBILE: Full-screen map + floating search bar + bottom drawer ══ */
                        <div ref={mapContainerRef} className="relative" style={{ height: `${viewportHeight - 66}px`, overflow: 'hidden' }}>

                            {/* ── Full-screen Map ── */}
                            <div className="absolute inset-0 z-0">
                                <MapView projects={mockProjects} onSelectProject={onSelectProject} hoveredProject={selectedMapProject} onHoverProject={setSelectedMapProject} />
                            </div>

                            {/* ── Floating Search Bar (fixed below nav, 12px gap) ── */}
                            <div
                                ref={floatingSearchRef}
                                className="fixed left-[16px] right-[16px] z-40"
                                style={{ top: '78px' }}
                            >
                                <div
                                    className="flex items-center gap-[8px] px-[16px] py-[8px] rounded-[37px]"
                                    style={{
                                        background: 'rgba(255,255,255,0.88)',
                                        backdropFilter: 'blur(12px)',
                                        WebkitBackdropFilter: 'blur(12px)',
                                        border: '1px solid rgba(180,180,180,0.32)',
                                        boxShadow: '-9px 7px 25px rgba(153,153,153,0.1), -35px 28px 45px rgba(153,153,153,0.09)',
                                    }}
                                >
                                    {/* Back to Home */}
                                    <button
                                        onClick={onBack}
                                        className="flex-shrink-0 w-[24px] h-[24px] flex items-center justify-center"
                                        title="Back to Home"
                                    >
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#0A0A0A" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                            <path d="M19 12H5M12 19l-7-7 7-7" />
                                        </svg>
                                    </button>

                                    {/* Search Input */}
                                    <div className="flex-1 bg-[#FFFBF6] border border-[#E7DCCC] rounded-[33px] h-[50px] px-[20px] flex items-center gap-[8px] min-w-0">
                                        <svg width="18" height="18" viewBox="0 0 20 20" fill="none" style={{ flexShrink: 0 }}>
                                            <circle cx="8" cy="8" r="6" stroke="#6C5F4C" strokeWidth="2" />
                                            <path d="M12.5 12.5L17 17" stroke="#6C5F4C" strokeWidth="2" strokeLinecap="round" />
                                        </svg>
                                        <input
                                            type="text"
                                            placeholder="Search location"
                                            value={locationSearch}
                                            onChange={(e) => setLocationSearch(e.target.value)}
                                            className="flex-1 bg-transparent outline-none text-[16px] placeholder:text-[rgba(0,0,0,0.59)] text-[rgba(0,0,0,0.8)] min-w-0"
                                            style={{ border: 'none' }}
                                        />
                                    </div>

                                    {/* Search Button */}
                                    <button className="bg-black border border-[#C4AD8D] rounded-full p-[4px] hover:opacity-90 transition-opacity flex-shrink-0">
                                        <div className="bg-black rounded-full p-[11px]">
                                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                                <circle cx="6.5" cy="6.5" r="5" stroke="white" strokeWidth="1.5" />
                                                <path d="M10.5 10.5L14 14" stroke="white" strokeWidth="1.5" strokeLinecap="round" />
                                            </svg>
                                        </div>
                                    </button>

                                    {/* Filter Button */}
                                    <button
                                        onClick={() => setShowMobileFilterModal(true)}
                                        className="flex-shrink-0 w-[24px] h-[24px] flex items-center justify-center"
                                    >
                                        <svg width="20" height="16" viewBox="0 0 20 16" fill="none">
                                            <rect x="0" y="1" width="20" height="2" rx="1" fill="#0A0A0A" />
                                            <rect x="0" y="7" width="14" height="2" rx="1" fill="#0A0A0A" />
                                            <rect x="0" y="13" width="8" height="2" rx="1" fill="#0A0A0A" />
                                        </svg>
                                    </button>
                                </div>
                            </div>

                            {/* ── Bottom Drawer ── */}
                            <div
                                className="absolute left-0 right-0 bottom-0 z-10 flex flex-col"
                                style={{
                                    height: `${drawerHeight}px`,
                                    transition: isDraggingDrawer ? 'none' : 'height 0.4s cubic-bezier(0.25, 1.0, 0.5, 1.0)',
                                    background: '#f7f6f3',
                                    borderRadius: '24px 24px 0 0',
                                    boxShadow: '0 -9px 21px rgba(0,0,0,0.1), 0 -34px 38px rgba(0,0,0,0.09)',
                                }}
                            >
                                {/* Grab Handle */}
                                <div
                                    className="flex items-center justify-center flex-shrink-0 cursor-grab active:cursor-grabbing"
                                    style={{ height: '32px', touchAction: 'none' }}
                                    onTouchStart={handleDrawerTouchStart}
                                    onTouchMove={handleDrawerTouchMove}
                                    onTouchEnd={handleDrawerTouchEnd}
                                    onClick={handleDrawerTap}
                                >
                                    <div className="w-[81px] h-[4px] bg-[#eeede6] rounded-[12px]" />
                                </div>

                                {/* Result count */}
                                <div className="px-4 pb-2 flex-shrink-0">
                                    <p className="text-sm font-semibold text-[#222]">{mockProjects.length} properties</p>
                                </div>

                                {/* Scrollable card grid */}
                                <div className="flex-1 overflow-y-auto overflow-x-hidden min-h-0">
                                    <div className="p-3 grid gap-3" style={{ gridTemplateColumns: 'repeat(auto-fill, minmax(240px, 1fr))' }}>
                                        {currentProjects.map(project => (
                                            <div key={project.id} className="map-list-card">
                                                <PropertyCard
                                                    project={project}
                                                    onSelect={onSelectProject}
                                                    inWatchlist={watchlist.some(w => w.id === project.id)}
                                                    onToggleWatchlist={onToggleWatchlist}
                                                    isHovered={selectedMapProject?.id === project.id}
                                                    isInvestorMode={isInvestorMode}
                                                    onAddToCompare={onAddToCompare}
                                                    inCompareList={compareList.some(c => c.id === project.id)}
                                                />
                                            </div>
                                        ))}
                                    </div>
                                    {totalPages > 1 && (
                                        <div className="flex items-center justify-center gap-3 py-4 px-4 border-t border-warm-100 flex-shrink-0">
                                            <button onClick={() => setCurrentPage(p => Math.max(1, p - 1))} disabled={currentPage === 1} className="px-3 py-1.5 rounded-lg border border-warm-200 text-sm text-driven-text disabled:opacity-40 hover:bg-cream-100 transition-all">Prev</button>
                                            <span className="text-sm text-warm-500 font-medium">{currentPage} / {totalPages}</span>
                                            <button onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))} disabled={currentPage === totalPages} className="px-3 py-1.5 rounded-lg border border-warm-200 text-sm text-driven-text disabled:opacity-40 hover:bg-cream-100 transition-all">Next</button>
                                        </div>
                                    )}
                                </div>
                            </div>

                            {/* ── Advanced Filter Modal ── */}
                            {showMobileFilterModal && (
                                <>
                                    {/* Backdrop */}
                                    <div
                                        className="absolute inset-0 z-30"
                                        style={{ background: 'rgba(0,0,0,0.11)' }}
                                        onClick={() => setShowMobileFilterModal(false)}
                                    />

                                    {/* Modal */}
                                    <div
                                        className="absolute z-40 bg-white flex flex-col"
                                        style={{
                                            top: '50%',
                                            left: '50%',
                                            transform: 'translate(-50%, -50%)',
                                            width: 'min(364px, calc(100% - 32px))',
                                            maxHeight: 'calc(100% - 64px)',
                                            borderRadius: '31px',
                                            padding: '16px',
                                            boxShadow: '-82px 26px 34px rgba(0,0,0,0.01), -46px 15px 29px rgba(0,0,0,0.05), -21px 7px 22px rgba(0,0,0,0.09), -5px 2px 12px rgba(0,0,0,0.1)',
                                            border: '1px solid #e4e4e5',
                                            animation: 'filterModalIn 0.3s cubic-bezier(0.25, 1.0, 0.5, 1.0)',
                                        }}
                                    >
                                        {/* Header: Tabs + Close */}
                                        <div className="flex items-start justify-between mb-[16px] flex-shrink-0">
                                            <div className="flex gap-[16px] items-center">
                                                <span className="text-[16px] font-semibold text-[rgba(0,0,0,0.8)] underline">Search location</span>
                                                <span className="text-[16px] text-[rgba(0,0,0,0.38)]">Sort</span>
                                            </div>
                                            <button onClick={() => setShowMobileFilterModal(false)} className="w-[24px] h-[24px] flex items-center justify-center flex-shrink-0">
                                                <svg width="15.5" height="15.5" viewBox="0 0 15.5 15.5" fill="none">
                                                    <path d="M15.5 1.55L13.95 0L7.75 6.2L1.55 0L0 1.55L6.2 7.75L0 13.95L1.55 15.5L7.75 9.3L13.95 15.5L15.5 13.95L9.3 7.75L15.5 1.55Z" fill="#0A0A0A" />
                                                </svg>
                                            </button>
                                        </div>

                                        {/* Scrollable filter content */}
                                        <div className="flex-1 overflow-y-auto flex flex-col gap-[16px] min-h-0">

                                            {/* Buy/Rent/Commercial/Projects tabs */}
                                            <div className="bg-[#FFFBF6] border border-[#E7DCCC] rounded-[36px] p-[8px] flex gap-[4px] w-full">
                                                {mainTabs.map(tab => (
                                                    <button
                                                        key={tab.id}
                                                        onClick={() => setActiveMainTab(tab.id)}
                                                        className="flex-1 h-[34px] rounded-[16px] flex items-center justify-center transition-all duration-200"
                                                        style={{
                                                            background: activeMainTab === tab.id ? '#161717' : 'transparent',
                                                            boxShadow: activeMainTab === tab.id ? '-16px 6px 7px rgba(0,0,0,0.03), -9px 3px 6px rgba(0,0,0,0.09), -4px 1px 4px rgba(0,0,0,0.15), -1px 0px 2px rgba(0,0,0,0.17)' : 'none',
                                                        }}
                                                    >
                                                        <span className="text-[14px] leading-[18px] whitespace-nowrap" style={{ color: activeMainTab === tab.id ? '#FAFAF5' : '#1C1C1A' }}>{tab.label}</span>
                                                    </button>
                                                ))}
                                            </div>

                                            {/* All/Ready/Off Plan/Luxury sub-tabs */}
                                            <div className="bg-[#FFFBF6] border border-[#E7DCCC] rounded-[36px] p-[8px] flex gap-[4px] w-full">
                                                {subTabs.map(tab => (
                                                    <button
                                                        key={tab.id}
                                                        onClick={() => setActiveSubTab(tab.id)}
                                                        className="flex-1 min-h-[32px] rounded-[16px] flex items-center justify-center transition-all duration-200"
                                                        style={{
                                                            background: activeSubTab === tab.id ? '#EBEBE2' : 'transparent',
                                                            border: activeSubTab === tab.id ? '1px solid #333331' : '1px solid transparent',
                                                            boxShadow: activeSubTab === tab.id ? '-16px 6px 7px rgba(0,0,0,0.03), -9px 3px 6px rgba(0,0,0,0.09), -4px 1px 4px rgba(0,0,0,0.15), -1px 0px 2px rgba(0,0,0,0.17)' : 'none',
                                                        }}
                                                    >
                                                        <span className="text-[14px] text-center whitespace-nowrap" style={{ fontWeight: activeSubTab === tab.id ? 600 : 400, color: activeSubTab === tab.id ? '#000000' : '#494946' }}>{tab.label}</span>
                                                    </button>
                                                ))}
                                            </div>

                                            {/* Investor / Normal Mode toggle */}
                                            <div className="bg-[#FFFBF6] border border-[#E7DCCC] rounded-[36px] p-[8px] flex gap-[4px] w-full">
                                                <button
                                                    onClick={() => isInvestorMode ? null : setShowInvestorModal(true)}
                                                    className="flex-1 min-h-[32px] rounded-[16px] flex items-center justify-center transition-all duration-200"
                                                    style={{
                                                        background: isInvestorMode ? '#EBEBE2' : 'transparent',
                                                        border: isInvestorMode ? '1px solid #333331' : '1px solid transparent',
                                                        boxShadow: isInvestorMode ? '-16px 6px 7px rgba(0,0,0,0.03), -9px 3px 6px rgba(0,0,0,0.09), -4px 1px 4px rgba(0,0,0,0.15), -1px 0px 2px rgba(0,0,0,0.17)' : 'none',
                                                    }}
                                                >
                                                    <span className="text-[14px] text-center" style={{ fontWeight: isInvestorMode ? 600 : 400, color: isInvestorMode ? '#000000' : '#494946' }}>Investor Mode</span>
                                                </button>
                                                <button
                                                    onClick={() => setIsInvestorMode(false)}
                                                    className="flex-1 min-h-[32px] rounded-[16px] flex items-center justify-center transition-all duration-200"
                                                    style={{
                                                        background: !isInvestorMode ? '#EBEBE2' : 'transparent',
                                                        border: !isInvestorMode ? '1px solid #333331' : '1px solid transparent',
                                                        boxShadow: !isInvestorMode ? '-16px 6px 7px rgba(0,0,0,0.03), -9px 3px 6px rgba(0,0,0,0.09), -4px 1px 4px rgba(0,0,0,0.15), -1px 0px 2px rgba(0,0,0,0.17)' : 'none',
                                                    }}
                                                >
                                                    <span className="text-[14px] text-center" style={{ fontWeight: !isInvestorMode ? 600 : 400, color: !isInvestorMode ? '#000000' : '#494946' }}>Normal Mode</span>
                                                </button>
                                            </div>

                                            {/* Handover by dropdown pill */}
                                            <div className="bg-[#FFFBF6] border border-[#E7DCCC] rounded-[33px] h-[50px] px-[16px] flex items-center">
                                                <div className="flex flex-col gap-[4px]">
                                                    <div className="flex gap-[4px] items-center">
                                                        <svg width="16" height="16" viewBox="0 0 10 5.5" fill="none"><path d="M5 5.5L0 0H10L5 5.5Z" fill="#242424" /></svg>
                                                        <span className="text-[12px] text-[#696765]">Handover by</span>
                                                    </div>
                                                    <span className="text-[14px] font-semibold text-black">{selectedHandover}</span>
                                                </div>
                                            </div>

                                            {/* Payment Plan dropdown pill */}
                                            <div className="bg-[#FFFBF6] border border-[#E7DCCC] rounded-[33px] h-[50px] px-[16px] flex items-center">
                                                <div className="flex flex-col gap-[4px]">
                                                    <div className="flex gap-[4px] items-center">
                                                        <svg width="16" height="16" viewBox="0 0 10 5.5" fill="none"><path d="M5 5.5L0 0H10L5 5.5Z" fill="#242424" /></svg>
                                                        <span className="text-[12px] text-[#696765]">Payment Plan</span>
                                                    </div>
                                                    <span className="text-[14px] font-semibold text-black">{selectedPaymentPlan}</span>
                                                </div>
                                            </div>

                                            {/* Completion dropdown pill */}
                                            <div className="bg-[#FFFBF6] border border-[#E7DCCC] rounded-[33px] h-[50px] px-[16px] flex items-center">
                                                <div className="flex flex-col gap-[4px]">
                                                    <div className="flex gap-[4px] items-center">
                                                        <svg width="16" height="16" viewBox="0 0 10 5.5" fill="none"><path d="M5 5.5L0 0H10L5 5.5Z" fill="#242424" /></svg>
                                                        <span className="text-[12px] text-[#696765]">Completion</span>
                                                    </div>
                                                    <span className="text-[14px] font-semibold text-black">{selectedCompletion}</span>
                                                </div>
                                            </div>

                                            {/* Amenities dropdown pill */}
                                            <div className="bg-[#FFFBF6] border border-[#E7DCCC] rounded-[33px] h-[50px] px-[16px] flex items-center">
                                                <div className="flex gap-[4px] items-center">
                                                    <svg width="16" height="16" viewBox="0 0 10 5.5" fill="none"><path d="M5 5.5L0 0H10L5 5.5Z" fill="#242424" /></svg>
                                                    <span className="text-[14px] text-[#696765]">Amenities</span>
                                                </div>
                                            </div>

                                            {/* Price dropdown pill */}
                                            <div className="bg-[#FFFBF6] border border-[#E7DCCC] rounded-[33px] h-[50px] px-[16px] flex items-center">
                                                <div className="flex gap-[4px] items-center">
                                                    <svg width="16" height="16" viewBox="0 0 10 5.5" fill="none"><path d="M5 5.5L0 0H10L5 5.5Z" fill="#242424" /></svg>
                                                    <span className="text-[14px] text-[#696765]">Price</span>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Bottom: Reset + Search */}
                                        <div className="flex flex-col gap-[18px] items-center mt-[24px] flex-shrink-0">
                                            <button
                                                onClick={() => { setLocationSearch(''); setActiveMainTab('buy'); setActiveSubTab('offplan'); setIsInvestorMode(false); }}
                                                className="text-[14px] text-[#00276F] underline"
                                            >Reset</button>
                                            <div className="flex gap-[8px] items-center w-full">
                                                {/* Search input inside modal */}
                                                <div className="flex-1 bg-[#FFFBF6] border border-[#E7DCCC] rounded-[33px] h-[50px] px-[20px] flex items-center gap-[8px] min-w-0">
                                                    <svg width="18" height="18" viewBox="0 0 20 20" fill="none" style={{ flexShrink: 0 }}>
                                                        <circle cx="8" cy="8" r="6" stroke="#6C5F4C" strokeWidth="2" />
                                                        <path d="M12.5 12.5L17 17" stroke="#6C5F4C" strokeWidth="2" strokeLinecap="round" />
                                                    </svg>
                                                    <input
                                                        type="text"
                                                        placeholder="Search location"
                                                        value={locationSearch}
                                                        onChange={(e) => setLocationSearch(e.target.value)}
                                                        className="flex-1 bg-transparent outline-none text-[16px] placeholder:text-[rgba(0,0,0,0.59)] text-[rgba(0,0,0,0.8)] min-w-0"
                                                        style={{ border: 'none' }}
                                                    />
                                                </div>
                                                {/* Search button */}
                                                <button
                                                    onClick={() => setShowMobileFilterModal(false)}
                                                    className="bg-black border border-[#C4AD8D] rounded-full p-[4px] hover:opacity-90 transition-opacity flex-shrink-0"
                                                >
                                                    <div className="bg-black rounded-full p-[11px]">
                                                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                                            <circle cx="6.5" cy="6.5" r="5" stroke="white" strokeWidth="1.5" />
                                                            <path d="M10.5 10.5L14 14" stroke="white" strokeWidth="1.5" strokeLinecap="round" />
                                                        </svg>
                                                    </div>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </>
                            )}
                        </div>
                    )}

                    {/* ══ Mobile Filter Bottom-Sheet Drawer ══ */}
                    {showFilterDrawer && (
                        <>
                            {/* Backdrop */}
                            <div
                                className="filter-drawer-backdrop fixed inset-0 bg-black/40 z-[9998] lg:hidden"
                                onClick={() => setShowFilterDrawer(false)}
                            />

                            {/* Sheet */}
                            <div
                                className="filter-drawer-sheet fixed bottom-0 left-0 right-0 bg-white z-[9999] lg:hidden flex flex-col"
                                style={{ borderRadius: '24px 24px 0 0', maxHeight: '88vh' }}
                            >
                                {/* Drag handle */}
                                <div className="flex justify-center pt-3 pb-1 flex-shrink-0">
                                    <div className="w-10 h-1 bg-[#D8D0C8] rounded-full" />
                                </div>

                                {/* Header */}
                                <div className="flex items-center justify-between px-5 py-3 border-b border-[#F0EDE8] flex-shrink-0">
                                    <h3 className="text-[17px] font-bold text-[#1C1C1A]">More Filters</h3>
                                    <button
                                        onClick={() => setShowFilterDrawer(false)}
                                        className="w-8 h-8 flex items-center justify-center rounded-full bg-[#F5F0EA] text-[#1C1C1A] hover:bg-[#EDE5D8] transition-colors"
                                    >
                                        <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                                            <path d="M1 1l12 12M13 1L1 13" stroke="#1C1C1A" strokeWidth="1.8" strokeLinecap="round"/>
                                        </svg>
                                    </button>
                                </div>

                                {/* Scrollable filter content */}
                                <div className="overflow-y-auto flex-1 px-5 py-5 flex flex-col gap-6">

                                    {/* Bedrooms */}
                                    <div>
                                        <label className="text-[13px] font-semibold text-[#656565] uppercase tracking-wide mb-3 block">Bedrooms</label>
                                        <div className="flex gap-2 flex-wrap">
                                            {['Studio', '1', '2', '3', '4', '5+'].map(bed => (
                                                <button
                                                    key={bed}
                                                    onClick={() => setSelectedBedrooms(selectedBedrooms === bed ? null : bed)}
                                                    className="flex-1 min-w-[48px] py-3 border rounded-xl text-sm font-medium transition-all"
                                                    style={{
                                                        background: selectedBedrooms === bed ? '#161717' : '#FFFBF6',
                                                        borderColor: selectedBedrooms === bed ? '#161717' : '#E7DCCC',
                                                        color: selectedBedrooms === bed ? '#FAFAF5' : '#1C1C1A',
                                                    }}
                                                >{bed}</button>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Bathrooms */}
                                    <div>
                                        <label className="text-[13px] font-semibold text-[#656565] uppercase tracking-wide mb-3 block">Bathrooms</label>
                                        <div className="flex gap-2 flex-wrap">
                                            {['1', '2', '3', '4', '5+'].map(bath => (
                                                <button
                                                    key={bath}
                                                    onClick={() => setSelectedBathrooms(selectedBathrooms === bath ? null : bath)}
                                                    className="flex-1 min-w-[48px] py-3 border rounded-xl text-sm font-medium transition-all"
                                                    style={{
                                                        background: selectedBathrooms === bath ? '#161717' : '#FFFBF6',
                                                        borderColor: selectedBathrooms === bath ? '#161717' : '#E7DCCC',
                                                        color: selectedBathrooms === bath ? '#FAFAF5' : '#1C1C1A',
                                                    }}
                                                >{bath}</button>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Property Size */}
                                    <div>
                                        <label className="text-[13px] font-semibold text-[#656565] uppercase tracking-wide mb-3 block">Property Size (sqft)</label>
                                        <div className="flex gap-3 items-center">
                                            <input
                                                type="number" placeholder="Min" value={minSize}
                                                onChange={e => setMinSize(e.target.value)}
                                                className="flex-1 px-4 py-3 border border-[#E7DCCC] rounded-xl bg-[#FFFBF6] outline-none text-sm focus:border-[#C4AD8D] transition-colors"
                                            />
                                            <div className="w-4 h-px bg-[#D0C8BC] flex-shrink-0" />
                                            <input
                                                type="number" placeholder="Max" value={maxSize}
                                                onChange={e => setMaxSize(e.target.value)}
                                                className="flex-1 px-4 py-3 border border-[#E7DCCC] rounded-xl bg-[#FFFBF6] outline-none text-sm focus:border-[#C4AD8D] transition-colors"
                                            />
                                        </div>
                                    </div>

                                    {/* Quick Amenity Pills */}
                                    <div>
                                        <label className="text-[13px] font-semibold text-[#656565] uppercase tracking-wide mb-3 block">Amenities</label>
                                        <div className="flex flex-wrap gap-2">
                                            {quickPills.map((pill, i) => (
                                                <button key={i} className="px-4 py-2.5 bg-[#FFFBF6] border border-[#E7DCCC] rounded-full text-sm font-medium text-[#494946] hover:bg-[#EBEBE2] hover:text-[#1C1C1A] transition-all">
                                                    {pill}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                </div>

                                {/* Sticky footer actions */}
                                <div className="flex-shrink-0 px-5 py-4 border-t border-[#F0EDE8] flex gap-3">
                                    <button
                                        onClick={() => { setSelectedBedrooms(null); setSelectedBathrooms(null); setMinSize(''); setMaxSize(''); }}
                                        className="flex-1 py-3.5 rounded-full border border-[#E7DCCC] text-[#1C1C1A] text-sm font-semibold bg-white hover:bg-[#F5F0EA] transition-colors"
                                    >Reset</button>
                                    <button
                                        onClick={() => setShowFilterDrawer(false)}
                                        className="flex-2 py-3.5 px-8 rounded-full bg-[#1C1C1A] text-white text-sm font-semibold hover:bg-black transition-colors"
                                    >Show Results</button>
                                </div>
                            </div>
                        </>
                    )}

                    {/* ══════ Investor Mode Modal ══════ */}
                    {showInvestorModal && (
                        <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[10000] p-4" onClick={() => setShowInvestorModal(false)}>
                            <div className="p-2 bg-white/15 backdrop-blur-md rounded-[2.25rem] border border-white/25 w-full max-w-md shadow-2xl animate-scale-in" onClick={e => e.stopPropagation()}>
                                <div className="bg-[#F5F0E8] rounded-[1.75rem] w-full overflow-hidden relative">
                                    {/* Subtle bottom gradient */}
                                    <div className="absolute bottom-0 left-0 right-0 h-[200px] pointer-events-none" style={{ background: 'linear-gradient(to top, #f1ebe1, transparent)' }}></div>

                                    {/* Close button */}
                                    <button onClick={() => setShowInvestorModal(false)} className="absolute top-4 right-4 z-10 w-8 h-8 flex items-center justify-center rounded-full bg-white/70 text-warm-500 hover:bg-white hover:text-driven-text transition-all">
                                        <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path d="M6 18L18 6M6 6l12 12" /></svg>
                                    </button>

                                    {/* Hero section — title + illustration */}
                                    <div className="px-7 pt-7 pb-0 relative">
                                        <div className="flex items-start justify-between gap-4">
                                            <div className="flex-1 pt-2">
                                                <h3 className="text-[1.75rem] leading-[1.15] font-bold text-driven-text">Enable investor<br />mode</h3>
                                                <p className="text-[#717171] text-sm mt-3">Sign in to see advanced investment metrics and analytics</p>
                                            </div>
                                            <div className="flex-shrink-0 w-40 h-36">
                                                <img src="Modal Assets/investor mode.svg" alt="Investor Mode" className="w-full h-full object-contain" />
                                            </div>
                                        </div>
                                    </div>

                                    {/* Separator */}
                                    <div className="mx-7 mt-4 mb-0">
                                        <div className="h-px bg-[#f3e7d8] rounded-full"></div>
                                    </div>

                                    {/* Sign up buttons — 2x2 grid */}
                                    <div className="px-7 pt-4 pb-3 relative">
                                        <div className="grid grid-cols-2 gap-3">
                                            <button className="flex items-center justify-center gap-2.5 px-4 py-3 bg-white rounded-full border border-warm-200 hover:border-warm-300 hover:shadow-sm transition-all">
                                                <svg className="flex-shrink-0" viewBox="0 0 24 24" style={{ width: '18px', height: '18px' }}><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4" /><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853" /><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05" /><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335" /></svg>
                                                <span className="text-sm font-semibold text-driven-text">Continue with Google</span>
                                            </button>
                                            <button className="flex items-center justify-center gap-2.5 px-4 py-3 bg-white rounded-full border border-warm-200 hover:border-warm-300 hover:shadow-sm transition-all">
                                                <svg className="flex-shrink-0" viewBox="0 0 24 24" fill="#1877F2" style={{ width: '18px', height: '18px' }}><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z" /></svg>
                                                <span className="text-sm font-semibold text-driven-text">Continue with Facebook</span>
                                            </button>
                                            <button className="flex items-center justify-center gap-2.5 px-4 py-3 bg-white rounded-full border border-warm-200 hover:border-warm-300 hover:shadow-sm transition-all">
                                                <svg className="flex-shrink-0" viewBox="0 0 24 24" fill="currentColor" style={{ width: '18px', height: '18px' }}><path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.8-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z" /></svg>
                                                <span className="text-sm font-semibold text-driven-text">Continue with Apple</span>
                                            </button>
                                            <button className="flex items-center justify-center gap-2.5 px-4 py-3 bg-white rounded-full border border-warm-200 hover:border-warm-300 hover:shadow-sm transition-all">
                                                <svg className="flex-shrink-0 text-warm-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.5" style={{ width: '18px', height: '18px' }}><path d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" /></svg>
                                                <span className="text-sm font-semibold text-driven-text">Continue with Email</span>
                                            </button>
                                        </div>
                                    </div>

                                    {/* Separator */}
                                    <div className="mx-7">
                                        <div className="h-px bg-[#f3e7d8] rounded-full"></div>
                                    </div>

                                    {/* Already have an account + Login */}
                                    <div className="px-7 pt-3 pb-2 relative">
                                        <p className="text-[#717171] text-base text-center py-2">Already have an account?</p>
                                    </div>
                                    <div className="px-7 pb-4 relative">
                                        <div className="p-2 bg-white border border-[#f3e7d8] rounded-full">
                                            <button className="w-full flex items-center justify-center gap-2 py-2.5 bg-[#161717] text-white rounded-full font-semibold text-sm hover:bg-warm-700 transition-all shadow-[0_1px_4px_2px_rgba(0,0,0,0.25)]">
                                                <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10" /><path d="M12 8l4 4m0 0l-4 4m4-4H8" /></svg>
                                                Login Now
                                            </button>
                                        </div>
                                    </div>

                                    {/* Separator */}
                                    <div className="mx-7">
                                        <div className="h-px bg-[#f3e7d8] rounded-full"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Comparison Screen Component
        const ComparisonScreen = ({ compareList, onBack, onRemove, onViewProperty }) => {
            if (compareList.length === 0) {
                return (
                    <div className="min-h-screen bg-cream-50 py-12">
                        <div className="max-w-7xl mx-auto px-6">
                            <button onClick={onBack} className="flex items-center gap-2 text-warm-600 hover:text-warm-900 mb-6">
                                <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                                </svg>
                                Back to Search
                            </button>
                            <div className="text-center py-12">
                                <p className="text-warm-500 text-lg">No properties to compare. Add properties from search results.</p>
                            </div>
                        </div>
                    </div>
                );
            }

            const metrics = [
                { key: 'price', label: 'Price', format: (v) => v },
                { key: 'pricePerSqft', label: 'Price per sqft', format: (v) => `AED ${v}/sqft` },
                { key: 'beds', label: 'Bedrooms', format: (v) => v },
                { key: 'baths', label: 'Bathrooms', format: (v) => v },
                { key: 'sqft', label: 'Area', format: (v) => `${v} ft²` },
                { key: 'completionDate', label: 'Completion', format: (v) => v },
                { key: 'roi', label: 'Expected ROI', format: (v) => v },
                { key: 'paymentPlan', label: 'Payment Plan', format: (v) => v },
                { key: 'location', label: 'Location', format: (v) => v },
                { key: 'area', label: 'Area', format: (v) => v }
            ];

            const getBestValue = (key) => {
                if (key === 'price' || key === 'pricePerSqft') {
                    return Math.min(...compareList.map(p => parseInt(p[key].replace(/[^0-9]/g, ''))));
                }
                if (key === 'roi') {
                    return Math.max(...compareList.map(p => parseInt(p[key].replace(/[^0-9]/g, ''))));
                }
                if (key === 'beds' || key === 'baths' || key === 'sqft') {
                    return Math.max(...compareList.map(p => p[key]));
                }
                return null;
            };

            return (
                <div className="min-h-screen bg-cream-50 py-12">
                    <div className="max-w-7xl mx-auto px-4 md:px-6">
                        {/* Header - Responsive */}
                        <div className="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6 md:mb-8">
                            <div className="flex items-center gap-3 md:gap-4">
                                <button onClick={onBack} className="flex items-center gap-2 text-warm-600 hover:text-warm-900 touch-manipulation">
                                    <svg className="w-4 h-4 md:w-5 md:h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                                    </svg>
                                    <span className="text-sm md:text-base">Back</span>
                                </button>
                                <div>
                                    <h1 className="text-xl md:text-3xl font-bold text-driven-text">Compare Properties</h1>
                                    <span className="text-xs md:text-sm text-warm-500">({compareList.length} properties)</span>
                                </div>
                            </div>
                            <button className="px-4 py-2 border border-warm-300 rounded-lg hover:bg-white text-xs md:text-sm font-medium touch-manipulation self-start md:self-auto">
                                Export as PDF
                            </button>
                        </div>
                        <div className="hidden md:block bg-white rounded-2xl shadow-soft overflow-x-auto">
                            <table className="w-full">
                                <thead>
                                    <tr className="border-b border-warm-200">
                                        <th className="text-left p-6 font-bold text-driven-text sticky left-0 bg-white z-10">Feature</th>
                                        {compareList.map((project) => (
                                            <th key={project.id} className="p-6 min-w-[280px]">
                                                <div className="text-left">
                                                    <img src={project.image} alt={project.name} className="w-full h-40 object-cover rounded-lg mb-4" />
                                                    <h3 className="font-bold text-driven-text mb-2">{project.name}</h3>
                                                    <div className="flex items-center gap-3 text-sm text-warm-500 mb-3">
                                                        <span className="flex items-center gap-1"><Icon name="bed" className="w-3 h-3" /> {project.beds}</span>
                                                        <span className="flex items-center gap-1"><Icon name="bath" className="w-3 h-3" /> {project.baths}</span>
                                                        <span className="flex items-center gap-1"><Icon name="area" className="w-3 h-3" /> {project.sqft} ft²</span>
                                                    </div>
                                                    <div className="flex gap-2">
                                                        <button
                                                            onClick={() => onViewProperty(project)}
                                                            className="flex-1 px-3 py-2 bg-driven-green text-white rounded-lg text-sm font-medium hover:bg-opacity-90"
                                                        >
                                                            View Details
                                                        </button>
                                                        <button
                                                            onClick={() => onRemove(project)}
                                                            className="px-3 py-2 border border-warm-300 rounded-lg text-sm hover:bg-cream-50"
                                                        >
                                                            Remove
                                                        </button>
                                                    </div>
                                                </div>
                                            </th>
                                        ))}
                                    </tr>
                                </thead>
                                <tbody>
                                    {metrics.map((metric) => {
                                        const bestValue = getBestValue(metric.key);
                                        return (
                                            <tr key={metric.key} className="border-b border-warm-100">
                                                <td className="p-6 font-semibold text-warm-700 sticky left-0 bg-white">{metric.label}</td>
                                                {compareList.map((project) => {
                                                    const value = project[metric.key];
                                                    const numericValue = typeof value === 'string' ? parseInt(value.replace(/[^0-9]/g, '')) : value;
                                                    const isBest = bestValue !== null && numericValue === bestValue;

                                                    return (
                                                        <td key={project.id} className={`p-6 ${isBest ? 'bg-accent-gold/10 border-l-2 border-accent-gold' : ''}`}>
                                                            <div className={`text-sm ${isBest ? 'font-bold text-accent-gold' : 'text-warm-700'}`}>
                                                                {metric.format(value)}
                                                                {isBest && <span className="ml-2">⭐</span>}
                                                            </div>
                                                        </td>
                                                    );
                                                })}
                                            </tr>
                                        );
                                    })}
                                </tbody>
                            </table>
                        </div>
                        <div className="md:hidden space-y-6">
                            {/* Process properties in pairs */}
                            {Array.from({ length: Math.ceil(compareList.length / 2) }, (_, pairIndex) => {
                                const property1 = compareList[pairIndex * 2];
                                const property2 = compareList[pairIndex * 2 + 1];

                                return (
                                    <div key={pairIndex} className="bg-white rounded-xl shadow-soft overflow-hidden">
                                        {/* Property Images Header */}
                                        <div className="grid grid-cols-2 gap-0 border-b border-warm-200">
                                            {/* Property 1 Image */}
                                            <div className="relative border-r border-warm-200">
                                                <img src={property1.image} alt={property1.name} className="w-full h-32 object-cover" />
                                            </div>
                                            {property2 && (
                                                <div className="relative">
                                                    <img src={property2.image} alt={property2.name} className="w-full h-32 object-cover" />
                                                </div>
                                            )}
                                        </div>
                                        <div className="grid grid-cols-2 gap-0 border-b border-warm-200">
                                            {/* Property 1 Name */}
                                            <div className="p-3 border-r border-warm-200">
                                                <h3 className="font-bold text-sm text-driven-text mb-2 line-clamp-2">{property1.name}</h3>
                                                <div className="flex flex-col gap-1 text-xs text-warm-500">
                                                    <span className="flex items-center gap-1">
                                                        <Icon name="bed" className="w-3 h-3" /> {property1.beds} · <Icon name="bath" className="w-3 h-3 ml-1" /> {property1.baths}
                                                    </span>
                                                    <span className="flex items-center gap-1">
                                                        <Icon name="area" className="w-3 h-3" /> {property1.sqft} ft²
                                                    </span>
                                                </div>
                                            </div>
                                            {property2 && (
                                                <div className="p-3">
                                                    <h3 className="font-bold text-sm text-driven-text mb-2 line-clamp-2">{property2.name}</h3>
                                                    <div className="flex flex-col gap-1 text-xs text-warm-500">
                                                        <span className="flex items-center gap-1">
                                                            <Icon name="bed" className="w-3 h-3" /> {property2.beds} · <Icon name="bath" className="w-3 h-3 ml-1" /> {property2.baths}
                                                        </span>
                                                        <span className="flex items-center gap-1">
                                                            <Icon name="area" className="w-3 h-3" /> {property2.sqft} ft²
                                                        </span>
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                        {metrics.map((metric, metricIndex) => {
                                            const value1 = property1[metric.key];
                                            const value2 = property2 ? property2[metric.key] : null;
                                            const numericValue1 = typeof value1 === 'string' ? parseInt(value1.replace(/[^0-9]/g, '')) : value1;
                                            const numericValue2 = value2 && typeof value2 === 'string' ? parseInt(value2.replace(/[^0-9]/g, '')) : value2;
                                            const bestValue = getBestValue(metric.key);
                                            const isBest1 = bestValue !== null && numericValue1 === bestValue;
                                            const isBest2 = property2 && bestValue !== null && numericValue2 === bestValue;

                                            return (
                                                <div key={metric.key} className="grid grid-cols-2 border-b border-warm-100">
                                                    {/* Property 1 Value */}
                                                    <div className={`p-3 border-r border-warm-100 ${isBest1 ? 'bg-accent-gold/10' : ''}`}>
                                                        {metricIndex === 0 && (
                                                            <div className="text-xs font-semibold text-warm-600 mb-2">{metric.label}</div>
                                                        )}
                                                        {metricIndex > 0 && (
                                                            <div className="text-xs text-warm-500 mb-1">{metric.label}</div>
                                                        )}
                                                        <div className={`text-sm font-bold ${isBest1 ? 'text-accent-gold' : 'text-warm-700'}`}>
                                                            {metric.format(value1)}
                                                            {isBest1 && <span className="ml-1 text-xs">⭐</span>}
                                                        </div>
                                                    </div>
                                                    {property2 ? (
                                                        <div className={`p-3 ${isBest2 ? 'bg-accent-gold/10' : ''}`}>
                                                            {metricIndex === 0 && (
                                                                <div className="text-xs font-semibold text-warm-600 mb-2 invisible">{metric.label}</div>
                                                            )}
                                                            {metricIndex > 0 && (
                                                                <div className="text-xs text-warm-500 mb-1 invisible">{metric.label}</div>
                                                            )}
                                                            <div className={`text-sm font-bold ${isBest2 ? 'text-accent-gold' : 'text-warm-700'}`}>
                                                                {metric.format(value2)}
                                                                {isBest2 && <span className="ml-1 text-xs">⭐</span>}
                                                            </div>
                                                        </div>
                                                    ) : (
                                                        <div className="p-3"></div>
                                                    )}
                                                </div>
                                            );
                                        })}

                                        {/* Action Buttons */}
                                        <div className="grid grid-cols-2 gap-0 p-3">
                                            {/* Property 1 Buttons */}
                                            <div className="pr-1.5 space-y-2">
                                                <button
                                                    onClick={() => onViewProperty(property1)}
                                                    className="w-full px-3 py-2 bg-driven-green text-white rounded-lg text-xs font-medium active:bg-opacity-90 touch-manipulation"
                                                >
                                                    View Details
                                                </button>
                                                <button
                                                    onClick={() => onRemove(property1)}
                                                    className="w-full px-3 py-2 border border-warm-300 rounded-lg text-xs active:bg-cream-50 touch-manipulation"
                                                >
                                                    Remove
                                                </button>
                                            </div>
                                            {property2 && (
                                                <div className="pl-1.5 space-y-2">
                                                    <button
                                                        onClick={() => onViewProperty(property2)}
                                                        className="w-full px-3 py-2 bg-driven-green text-white rounded-lg text-xs font-medium active:bg-opacity-90 touch-manipulation"
                                                    >
                                                        View Details
                                                    </button>
                                                    <button
                                                        onClick={() => onRemove(property2)}
                                                        className="w-full px-3 py-2 border border-warm-300 rounded-lg text-xs active:bg-cream-50 touch-manipulation"
                                                    >
                                                        Remove
                                                    </button>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                        <div className="mt-6 text-center text-xs md:text-sm text-warm-500">
                            <span className="inline-flex items-center gap-2">
                                <span className="w-4 h-4 bg-accent-gold/10 border-l-2 border-accent-gold"></span>
                                Best value highlighted in gold
                            </span>
                        </div>
                    </div>
                </div>
            );
        };

        // Main App
        // Auth Gate Modal Component
        const AuthGateModal = ({ isOpen, onClose, propertyName, onShare, onSignUp }) => {
            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" onClick={onClose}>
                    <div className="p-2 bg-white/15 backdrop-blur-md rounded-[2rem] border border-white/25 max-w-md w-full shadow-2xl" onClick={(e) => e.stopPropagation()}>
                        <div className="bg-white rounded-2xl p-8 w-full">
                            <div className="text-center mb-6">
                                <div className="w-16 h-16 bg-accent-gold/10 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <Icon name="heartFilled" className="w-8 h-8 text-accent-gold" />
                                </div>
                                <h3 className="text-2xl font-bold text-warm-800 mb-2">Save to Favorites</h3>
                                <p className="text-warm-600">Sign in to save <strong>{propertyName}</strong> and access it anytime</p>
                            </div>

                            <div className="space-y-3 mb-6">
                                <button onClick={onSignUp} className="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg font-semibold flex items-center justify-center gap-2">
                                    <svg className="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" />
                                        <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" />
                                        <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" />
                                        <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" />
                                    </svg>
                                    Continue with Google
                                </button>
                                <button className="w-full bg-warm-800 hover:bg-warm-700 text-white py-3 px-6 rounded-lg font-semibold">
                                    Continue with Email
                                </button>
                            </div>

                            <div className="relative my-6">
                                <div className="absolute inset-0 flex items-center">
                                    <div className="w-full border-t border-warm-200"></div>
                                </div>
                                <div className="relative flex justify-center text-sm">
                                    <span className="px-4 bg-white text-warm-500">or</span>
                                </div>
                            </div>

                            <div className="mb-6">
                                <p className="text-sm text-warm-600 mb-3 text-center">Don't feel like signing up yet?</p>
                                <p className="text-sm font-semibold text-warm-800 mb-3 text-center">📤 Share this property:</p>
                                <div className="grid grid-cols-2 gap-2">
                                    <button onClick={() => onShare('whatsapp')} className="flex items-center justify-center gap-2 py-3 px-4 border-2 border-warm-200 rounded-lg hover:border-green-500 hover:bg-green-50 transition-all">
                                        <Icon name="whatsapp" className="w-5 h-5 text-green-600" />
                                        <span className="font-medium text-warm-800">WhatsApp</span>
                                    </button>
                                    <button onClick={() => onShare('email')} className="flex items-center justify-center gap-2 py-3 px-4 border-2 border-warm-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all">
                                        <svg className="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                        </svg>
                                        <span className="font-medium text-warm-800">Email</span>
                                    </button>
                                    <button onClick={() => onShare('copy')} className="flex items-center justify-center gap-2 py-3 px-4 border-2 border-warm-200 rounded-lg hover:border-accent-gold hover:bg-accent-gold/5 transition-all">
                                        <svg className="w-5 h-5 text-accent-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                        </svg>
                                        <span className="font-medium text-warm-800">Copy Link</span>
                                    </button>
                                    <button onClick={() => onShare('bookmark')} className="flex items-center justify-center gap-2 py-3 px-4 border-2 border-warm-200 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition-all">
                                        <svg className="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z" />
                                        </svg>
                                        <span className="font-medium text-warm-800">Bookmark</span>
                                    </button>
                                </div>
                            </div>

                            <button onClick={onClose} className="w-full text-warm-500 hover:text-warm-800 font-medium">
                                Maybe Later
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // Comparison Floating Bar Component
        const ComparisonBar = ({ compareList, onViewComparison, onClear }) => {
            if (compareList.length === 0) return null;

            return (
                <div className="fixed bottom-0 left-0 right-0 bg-white border-t-2 border-accent-gold shadow-2xl z-40 p-4">
                    <div className="max-w-7xl mx-auto flex items-center justify-between">
                        <div className="flex items-center gap-4">
                            <div className="flex items-center gap-2">
                                <div className="w-10 h-10 bg-accent-gold rounded-full flex items-center justify-center">
                                    <span className="text-white font-bold">{compareList.length}</span>
                                </div>
                                <div>
                                    <p className="font-bold text-warm-800">⚖️ Comparing {compareList.length} Properties</p>
                                    <p className="text-sm text-warm-500">
                                        {compareList.map(p => p.name.split(' ').slice(0, 2).join(' ')).join(', ')}
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div className="flex items-center gap-3">
                            <button onClick={onClear} className="px-4 py-2 text-warm-600 hover:text-warm-800 font-medium">
                                Clear All
                            </button>
                            <button onClick={onViewComparison} className="px-6 py-3 bg-warm-800 text-white rounded-lg font-semibold hover:bg-warm-700 flex items-center gap-2">
                                View Comparison
                                <Icon name="arrowRight" className="w-5 h-5" />
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // User Dashboard Component
        const UserDashboard = ({ user, favorites, onViewProperty, onRemoveFavorite, onLogout }) => {
            return (
                <div className="min-h-screen bg-cream-50">
                    <div className="bg-white border-b border-warm-200">
                        <div className="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
                            <h1 className="text-2xl font-bold text-warm-800">My Dashboard</h1>
                            <div className="flex items-center gap-4">
                                <div className="flex items-center gap-3">
                                    <div className="w-10 h-10 bg-accent-gold rounded-full flex items-center justify-center">
                                        <span className="text-white font-bold">{user?.name?.[0] || 'U'}</span>
                                    </div>
                                    <div>
                                        <p className="font-semibold text-warm-800">{user?.name || 'User'}</p>
                                        <p className="text-xs text-warm-500">{user?.email || 'user@example.com'}</p>
                                    </div>
                                </div>
                                <button onClick={onLogout} className="text-warm-600 hover:text-warm-800 font-medium">
                                    Log Out
                                </button>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-7xl mx-auto px-6 py-8">
                        <div className="grid md:grid-cols-4 gap-8">
                            {/* Sidebar */}
                            <div className="space-y-2">
                                <button className="w-full text-left px-4 py-3 bg-accent-gold text-white rounded-lg font-semibold">
                                    ❤️ Favorites ({favorites.length})
                                </button>
                                <button className="w-full text-left px-4 py-3 text-warm-600 hover:bg-white rounded-lg font-medium">
                                    ⚖️ Compared
                                </button>
                                <button className="w-full text-left px-4 py-3 text-warm-600 hover:bg-white rounded-lg font-medium">
                                    🔍 Saved Searches
                                </button>
                                <button className="w-full text-left px-4 py-3 text-warm-600 hover:bg-white rounded-lg font-medium">
                                    🔔 Alerts
                                </button>
                                <button className="w-full text-left px-4 py-3 text-warm-600 hover:bg-white rounded-lg font-medium">
                                    ⚙️ Account Settings
                                </button>
                            </div>
                            <div className="md:col-span-3">
                                <h2 className="text-2xl font-bold text-warm-800 mb-6">My Favorites ({favorites.length})</h2>

                                {favorites.length === 0 ? (
                                    <div className="bg-white rounded-2xl p-12 text-center border border-warm-200">
                                        <div className="w-24 h-24 bg-cream-100 rounded-full flex items-center justify-center mx-auto mb-6">
                                            <Icon name="heart" className="w-12 h-12 text-warm-400" />
                                        </div>
                                        <h3 className="text-xl font-bold text-warm-800 mb-2">No Favorites Yet</h3>
                                        <p className="text-warm-500 mb-6">Start exploring properties and save your favorites here</p>
                                        <button className="bg-warm-800 text-white px-6 py-3 rounded-lg font-semibold hover:bg-warm-700">
                                            Browse Properties
                                        </button>
                                    </div>
                                ) : (
                                    <div className="space-y-4">
                                        {favorites.map(project => (
                                            <div key={project.id} className="bg-white rounded-xl border border-warm-200 overflow-hidden hover:shadow-lg transition-all">
                                                <div className="flex gap-4 p-4">
                                                    <img src={project.image} alt={project.name} className="w-48 h-32 object-cover rounded-lg" />
                                                    <div className="flex-1">
                                                        <h3 className="text-xl font-bold text-warm-800 mb-2">{project.name}</h3>
                                                        <p className="text-warm-600 mb-2">{project.location} · by {project.developer}</p>
                                                        <div className="flex items-center gap-4 text-sm text-warm-600 mb-3">
                                                            <span className="flex items-center gap-1">
                                                                <Icon name="bed" className="w-4 h-4" /> {project.beds} BR
                                                            </span>
                                                            <span className="flex items-center gap-1">
                                                                <Icon name="bath" className="w-4 h-4" /> {project.baths}
                                                            </span>
                                                            <span className="flex items-center gap-1">
                                                                <Icon name="area" className="w-4 h-4" /> {project.sqft} sqft
                                                            </span>
                                                        </div>
                                                        <p className="text-2xl font-bold text-accent-gold">{project.price}</p>
                                                    </div>
                                                    <div className="flex flex-col gap-2">
                                                        <button onClick={() => onViewProperty(project)} className="px-4 py-2 bg-warm-800 text-white rounded-lg font-medium hover:bg-warm-700">
                                                            View Details
                                                        </button>
                                                        <button className="px-4 py-2 border-2 border-warm-200 rounded-lg font-medium hover:border-accent-gold">
                                                            Compare
                                                        </button>
                                                        <button onClick={() => onRemoveFavorite(project)} className="px-4 py-2 text-red-600 hover:bg-red-50 rounded-lg font-medium">
                                                            Remove
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        function App() {
            // Core State
            const [screen, setScreen] = useState('search');
            const [selectedProject, setSelectedProject] = useState(null);
            const [watchlist, setWatchlist] = useState([]);

            // Golden Path State
            const [user, setUser] = useState(null);
            const [compareList, setCompareList] = useState([]);
            const [showAuthModal, setShowAuthModal] = useState(false);
            const [pendingSaveProject, setPendingSaveProject] = useState(null);
            const [shareSuccess, setShareSuccess] = useState('');

            const selectProject = (p) => { setSelectedProject(p); setScreen('detail'); };

            // Enhanced toggle watchlist with auth gate
            const toggleWatchlist = (p) => {
                if (!user) {
                    // Show auth gate
                    setPendingSaveProject(p);
                    setShowAuthModal(true);
                } else {
                    // User is logged in, toggle normally
                    setWatchlist(prev => prev.some(x => x.id === p.id) ? prev.filter(x => x.id !== p.id) : [...prev, p]);
                }
            };

            // Comparison functions
            const addToCompare = (project) => {
                if (compareList.length < 3 && !compareList.some(p => p.id === project.id)) {
                    setCompareList(prev => [...prev, project]);
                }
            };

            const removeFromCompare = (project) => {
                const id = typeof project === 'object' ? project.id : project;
                setCompareList(prev => prev.filter(p => p.id !== id));
            };

            const clearCompareList = () => setCompareList([]);

            const viewComparison = () => {
                setScreen('compare');
            };

            // Share functions
            const handleShare = (method) => {
                const project = pendingSaveProject;
                const url = `${window.location.origin}${window.location.pathname}?property=${project.id}`;
                const text = `Check out this property: ${project.name}\n${project.price} | ${project.beds}BR | ${project.location}\n\n`;

                if (method === 'whatsapp') {
                    window.open(`https://wa.me/?text=${encodeURIComponent(text + url)}`, '_blank');
                    setShareSuccess('Shared to WhatsApp! ✅');
                } else if (method === 'email') {
                    window.location.href = `mailto:?subject=${encodeURIComponent(project.name)}&body=${encodeURIComponent(text + url)}`;
                    setShareSuccess('Opening email client... ✅');
                } else if (method === 'copy') {
                    navigator.clipboard.writeText(url);
                    setShareSuccess('Link copied to clipboard! ✅');
                } else if (method === 'bookmark') {
                    setShareSuccess('Press Ctrl+D (Cmd+D on Mac) to bookmark ✅');
                }

                setTimeout(() => {
                    setShowAuthModal(false);
                    setShareSuccess('');
                    setPendingSaveProject(null);
                }, 2000);
            };

            // Sign up function
            const handleSignUp = () => {
                // Simulate Google OAuth
                const mockUser = {
                    name: 'HNI Investor',
                    email: 'investor@gmail.com',
                    id: '12345'
                };
                setUser(mockUser);

                // Auto-save pending project
                if (pendingSaveProject) {
                    setWatchlist(prev => [...prev, pendingSaveProject]);
                }

                // Auto-save all compared properties
                if (compareList.length > 0) {
                    setWatchlist(prev => {
                        const newItems = compareList.filter(cp => !prev.some(p => p.id === cp.id));
                        return [...prev, ...newItems];
                    });
                }

                setShowAuthModal(false);
                setPendingSaveProject(null);

                // Navigate to dashboard
                setTimeout(() => setScreen('dashboard'), 500);
            };

            // Logout function
            const handleLogout = () => {
                if (confirm('Log out? Your favorites are saved and will be here when you return.')) {
                    setUser(null);
                    setScreen('search');
                }
            };

            // Handle hash navigation
            React.useEffect(() => {
                const handleHashChange = () => {
                    const hash = window.location.hash.slice(1);
                    if (hash === 'results') setScreen('results');
                    else if (hash === 'home') setScreen('search');
                };
                window.addEventListener('hashchange', handleHashChange);
                handleHashChange();
                return () => window.removeEventListener('hashchange', handleHashChange);
            }, []);

            // Check for shared property URL
            React.useEffect(() => {
                const urlParams = new URLSearchParams(window.location.search);
                const propertyId = urlParams.get('property');
                if (propertyId) {
                    const project = mockProjects.find(p => p.id === parseInt(propertyId));
                    if (project) {
                        selectProject(project);
                    }
                }
            }, []);

            return (
                <div className="min-h-screen bg-white font-lato">
                    {shareSuccess && (
                        <div className="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-fade-in">
                            {shareSuccess}
                        </div>
                    )}

                    <Header
                        onNavigate={setScreen}
                        watchlistCount={watchlist.length}
                        user={user}
                        onDashboard={() => setScreen('dashboard')}
                    />

                    {screen === 'search' && <SearchScreen onSelectProject={selectProject} watchlist={watchlist} onToggleWatchlist={toggleWatchlist} onViewAll={() => setScreen('results')} compareList={compareList} onAddToCompare={addToCompare} />}
                    {screen === 'results' && <SearchResultsScreen onSelectProject={selectProject} watchlist={watchlist} onToggleWatchlist={toggleWatchlist} onBack={() => { setScreen('search'); window.location.hash = '#home'; }} compareList={compareList} onAddToCompare={addToCompare} />}
                    {screen === 'detail' && selectedProject && <DetailScreen project={selectedProject} onBack={() => setScreen('search')} onAddToWatchlist={toggleWatchlist} inWatchlist={watchlist.some(p => p.id === selectedProject.id)} user={user} compareList={compareList} onAddToCompare={addToCompare} onSelectProject={selectProject} onViewComparison={viewComparison} onClearCompare={clearCompareList} />}
                    {screen === 'dashboard' && user && <UserDashboard user={user} favorites={watchlist} onViewProperty={selectProject} onRemoveFavorite={(p) => setWatchlist(prev => prev.filter(x => x.id !== p.id))} onLogout={handleLogout} />}
                    {screen === 'compare' && <ComparisonScreen compareList={compareList} onBack={() => setScreen('results')} onRemove={removeFromCompare} onViewProperty={selectProject} />}

                    <AuthGateModal
                        isOpen={showAuthModal}
                        onClose={() => { setShowAuthModal(false); setPendingSaveProject(null); }}
                        propertyName={pendingSaveProject?.name || ''}
                        onShare={handleShare}
                        onSignUp={handleSignUp}
                    />

                    <ComparisonBar
                        compareList={compareList}
                        onViewComparison={viewComparison}
                        onClear={clearCompareList}
                    />
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>

</html>